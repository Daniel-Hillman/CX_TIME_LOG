(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1483:(e,t,a)=>{"use strict";a.d(t,{ThemeProvider:()=>l});var s=a(5155);a(2115);var r=a(1362);function l(e){let{children:t,...a}=e;return(0,s.jsx)(r.N,{...a,children:t})}},2119:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ab});var s=a(5155),r=a(2115),l=a(3004),n=a(6104),i=a(5317),o=a(704),d=a(9434);let c=o.bL,m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(o.B8,{ref:t,className:(0,d.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r})});m.displayName=o.B8.displayName;let u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(o.l9,{ref:t,className:(0,d.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-lg px-4 py-2 text-base font-semibold ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-lg data-[state=active]:z-10",a),...r})});u.displayName=o.l9.displayName;let h=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(o.UC,{ref:t,className:(0,d.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})});h.displayName=o.UC.displayName;var x=a(1483),p=a(6936),f=a(8027),v=a(1362),g=a(285),y=a(8698),j=a(3158),b=a(518),N=a(154);let w=y.bL,C=y.l9;y.YJ,y.ZL,y.Pb,y.z6,r.forwardRef((e,t)=>{let{className:a,inset:r,children:l,...n}=e;return(0,s.jsxs)(y.ZP,{ref:t,className:(0,d.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...n,children:[l,(0,s.jsx)(j.A,{className:"ml-auto"})]})}).displayName=y.ZP.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(y.G5,{ref:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}).displayName=y.G5.displayName;let k=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...l}=e;return(0,s.jsx)(y.ZL,{children:(0,s.jsx)(y.UC,{ref:t,sideOffset:r,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});k.displayName=y.UC.displayName;let T=r.forwardRef((e,t)=>{let{className:a,inset:r,...l}=e;return(0,s.jsx)(y.q7,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...l})});function A(){let{setTheme:e}=(0,v.D)();return(0,s.jsxs)(w,{children:[(0,s.jsx)(C,{asChild:!0,children:(0,s.jsxs)(g.$,{variant:"outline",size:"icon",children:[(0,s.jsx)(p.A,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,s.jsx)(f.A,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,s.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}),(0,s.jsxs)(k,{align:"end",children:[(0,s.jsx)(T,{onClick:()=>e("light"),children:"Light"}),(0,s.jsx)(T,{onClick:()=>e("dark"),children:"Dark"}),(0,s.jsx)(T,{onClick:()=>e("system"),children:"System"})]})]})}T.displayName=y.q7.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,checked:l,...n}=e;return(0,s.jsxs)(y.H_,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:l,...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(y.VF,{children:(0,s.jsx)(b.A,{className:"h-4 w-4"})})}),r]})}).displayName=y.H_.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(y.hN,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...l,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(y.VF,{children:(0,s.jsx)(N.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=y.hN.displayName,r.forwardRef((e,t)=>{let{className:a,inset:r,...l}=e;return(0,s.jsx)(y.JU,{ref:t,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...l})}).displayName=y.JU.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(y.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=y.wv.displayName;let D=r.forwardRef((e,t)=>{let{className:a,type:r,...l}=e;return(0,s.jsx)("input",{type:r,className:(0,d.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...l})});D.displayName="Input";var P=a(6695),E=a(7655);let S=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(E.bL,{ref:t,className:(0,d.cn)("relative overflow-hidden",a),...l,children:[(0,s.jsx)(E.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,s.jsx)(R,{}),(0,s.jsx)(E.OK,{})]})});S.displayName=E.bL.displayName;let R=r.forwardRef((e,t)=>{let{className:a,orientation:r="vertical",...l}=e;return(0,s.jsx)(E.VM,{ref:t,orientation:r,className:(0,d.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...l,children:(0,s.jsx)(E.lr,{className:"relative flex-1 rounded-full bg-border"})})});R.displayName=E.VM.displayName;var L=a(172),I=a(3896),O=a(5943),M=a(7223),F=a(7481),U=a(4520);let _=U.bL,B=U.l9,Y=U.ZL,z=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(U.hJ,{className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:t})});z.displayName=U.hJ.displayName;let V=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsxs)(Y,{children:[(0,s.jsx)(z,{}),(0,s.jsx)(U.UC,{ref:t,className:(0,d.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...r})]})});V.displayName=U.UC.displayName;let G=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};G.displayName="AlertDialogHeader";let W=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};W.displayName="AlertDialogFooter";let Z=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(U.hE,{ref:t,className:(0,d.cn)("text-lg font-semibold",a),...r})});Z.displayName=U.hE.displayName;let $=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(U.VY,{ref:t,className:(0,d.cn)("text-sm text-muted-foreground",a),...r})});$.displayName=U.VY.displayName;let q=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(U.rc,{ref:t,className:(0,d.cn)((0,g.r)(),a),...r})});q.displayName=U.rc.displayName;let H=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(U.ZD,{ref:t,className:(0,d.cn)((0,g.r)({variant:"outline"}),"mt-2 sm:mt-0",a),...r})});H.displayName=U.ZD.displayName;var J=a(2085);let K=(0,J.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function X(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("span",{className:(0,d.cn)(K({variant:a}),t),...r})}var Q=a(4884);let ee=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(Q.bL,{"aria-label":r["aria-label"],className:(0,d.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-green-500","data-[state=checked]:border-green-600","data-[state=unchecked]:bg-slate-200","data-[state=unchecked]:border-slate-300","dark:data-[state=unchecked]:bg-slate-700","dark:data-[state=unchecked]:border-slate-600",a),...r,ref:t,children:(0,s.jsx)(Q.zi,{className:(0,d.cn)("pointer-events-none block h-5 w-5 rounded-full shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0","bg-slate-600 dark:bg-white")})})});ee.displayName=Q.bL.displayName;var et=a(968);let ea=(0,J.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),es=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(et.b,{ref:t,className:(0,d.cn)(ea(),a),...r})});es.displayName=et.b.displayName;var er=a(9613);let el=er.Kq,en=er.bL,ei=er.l9,eo=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...l}=e;return(0,s.jsx)(er.UC,{ref:t,sideOffset:r,className:(0,d.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})});eo.displayName=er.UC.displayName;var ed=a(9409);let ec={canAccessTimeLog:"Time Log",canAccessPolicySearch:"Policy Search",canAccessNextClearedBatch:"Next Cleared Batch",canAccessWholeOfMarket:"Whole of Market",canAccessAgentTools:"Agent Tools",canAccessVisualisations:"Visualisations",canAccessSummary:"Summary",canAccessReports:"Reports",canManageAdvisors:"Manage Advisors",hasTopAccess:"Top Access (Grants All)",canViewAllEvents:"View all logged events"};function em(e){let{advisors:t,onAddAdvisor:a,onRemoveAdvisor:l,onEditAdvisor:n,onUpdateAdvisorPermissions:i,onUpdateAdvisorRole:o,onDismissAdminDayFlag:d,currentUser:c,isAdmin:m,hasTopAccess:u}=e,[h,x]=(0,r.useState)(""),[p,f]=(0,r.useState)(""),[v,y]=(0,r.useState)(null),[j,b]=(0,r.useState)(""),[N,w]=(0,r.useState)(""),[C,k]=(0,r.useState)(!1),[T,A]=(0,r.useState)(null),{toast:E}=(0,F.dj)(),R=(0,r.useRef)(null),U=(0,r.useRef)(null),Y=(0,r.useRef)(null),z=(0,r.useRef)(null),[J,K]=(0,r.useState)(null);null==c||c.uid,(0,r.useEffect)(()=>{C||v||!R.current||setTimeout(()=>{var e;return null===(e=R.current)||void 0===e?void 0:e.focus()},0)},[C,v]),(0,r.useEffect)(()=>{v&&Y.current&&setTimeout(()=>{var e;return null===(e=Y.current)||void 0===e?void 0:e.focus()},0)},[v]);let Q=async(e,t,a)=>{k(!0);try{await i(e,{[t]:a}),E({title:"Permissions Updated",description:"Permission '".concat(ec[t]||t,"' for advisor has been ").concat(a?"enabled":"disabled",".")})}catch(e){console.error("Error updating permissions:",e),E({title:"Error",description:e.message||"Failed to update permissions.",variant:"destructive"})}finally{k(!1)}},et=async()=>{var e,s,r,l,n,i;if(C||v)return;let o=h.trim(),d=p.trim().toLowerCase();if(""===o){E({title:"Error",description:"Advisor name cannot be empty.",variant:"destructive"}),null===(e=R.current)||void 0===e||e.focus();return}if(""===d){E({title:"Error",description:"Advisor email cannot be empty.",variant:"destructive"}),null===(s=U.current)||void 0===s||s.focus();return}if(!d.endsWith("@clark.io")){E({title:"Error",description:"Advisor email must end with @clark.io.",variant:"destructive"}),null===(r=U.current)||void 0===r||r.focus();return}if(t.some(e=>e.name.toLowerCase()===o.toLowerCase())){E({title:"Error",description:"Advisor with this name already exists.",variant:"destructive"}),null===(l=R.current)||void 0===l||l.focus();return}if(t.some(e=>e.email.toLowerCase()===d.toLowerCase())){E({title:"Error",description:"Advisor with this email already exists.",variant:"destructive"}),null===(n=U.current)||void 0===n||n.focus();return}k(!0);try{await a(o,d),x(""),f("")}catch(e){console.error("Error adding advisor:",e),e.message?E({title:"Error",description:e.message,variant:"destructive"}):E({title:"Error",description:"Failed to add advisor.",variant:"destructive"}),null===(i=R.current)||void 0===i||i.focus()}finally{k(!1)}},ea=async e=>{if(!C&&!v){A(e),k(!0);try{await l(e)}catch(e){console.error("Error removing advisor:",e),E({title:"Error",description:e.message||"Failed to remove advisor.",variant:"destructive"})}finally{k(!1),A(null)}}},er=e=>{C||(y(e.id),b(e.name),w(e.email))},em=()=>{y(null),b(""),w(""),setTimeout(()=>{var e;return null===(e=R.current)||void 0===e?void 0:e.focus()},0)},eu=async()=>{var e,a,s,r,l,i;if(!v||C)return;let o=j.trim(),d=N.trim().toLowerCase(),c=t.find(e=>e.id===v);if(!c)return;if(""===o){E({title:"Error",description:"Advisor name cannot be empty.",variant:"destructive"}),null===(e=Y.current)||void 0===e||e.focus();return}if(""===d){E({title:"Error",description:"Advisor email cannot be empty.",variant:"destructive"}),null===(a=z.current)||void 0===a||a.focus();return}if(!d.endsWith("@clark.io")){E({title:"Error",description:"Advisor email must end with @clark.io.",variant:"destructive"}),null===(s=z.current)||void 0===s||s.focus();return}let m=c.name!==o,u=c.email.toLowerCase()!==d;if(!m&&!u){em();return}if(t.some(e=>e.id!==v&&e.name.toLowerCase()===o.toLowerCase())){E({title:"Error",description:"Advisor name '".concat(o,"' already exists."),variant:"destructive"}),null===(r=Y.current)||void 0===r||r.focus();return}if(t.some(e=>e.id!==v&&e.email.toLowerCase()===d.toLowerCase())){E({title:"Error",description:"Advisor email '".concat(d,"' already exists."),variant:"destructive"}),null===(l=z.current)||void 0===l||l.focus();return}k(!0);try{await n(v,o,d),em()}catch(e){console.error("Error editing advisor:",e),E({title:"Error",description:e.message||"Failed to save changes.",variant:"destructive"}),null===(i=Y.current)||void 0===i||i.focus()}finally{k(!1)}};return(0,s.jsx)(el,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-8 w-full",children:[(0,s.jsxs)(P.Zp,{className:"w-full max-w-2xl mx-auto shadow-lg",children:[(0,s.jsxs)(P.aR,{children:[(0,s.jsx)(P.ZB,{className:"text-xl font-semibold text-primary",children:"Add New Advisor"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm mt-1",children:"Fill in the details to add a new advisor to your team."})]}),(0,s.jsx)(P.Wu,{children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 items-center",children:[(0,s.jsx)(D,{ref:R,type:"text",placeholder:"Name",value:h,onChange:e=>x(e.target.value),"aria-label":"New advisor name",disabled:C||!!v,className:"sm:w-48"}),(0,s.jsx)(D,{ref:U,type:"email",placeholder:"Email (@clark.io)",value:p,onChange:e=>f(e.target.value),"aria-label":"New advisor email",disabled:C||!!v,onKeyDown:e=>!C&&!v&&"Enter"===e.key&&et(),className:"sm:w-64"}),(0,s.jsxs)(g.$,{onClick:et,"aria-label":"Add Advisor",variant:"default",className:"w-full sm:w-auto",disabled:C||!!v,children:[!C||T||v?(0,s.jsx)(I.A,{className:"mr-2 h-4 w-4"}):(0,s.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}),!C||T||v?"Add Advisor":"Adding..."]})]})})]}),(0,s.jsxs)(P.Zp,{className:"w-full shadow-lg",children:[(0,s.jsxs)(P.aR,{children:[(0,s.jsx)(P.ZB,{className:"text-xl font-semibold text-primary",children:"Manage Advisors"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm mt-1",children:"View, edit, and manage permissions for all advisors."})]}),(0,s.jsx)(P.Wu,{children:(0,s.jsx)(S,{className:"h-[calc(100vh-450px)] min-h-[280px] border rounded-md p-2 bg-secondary/30",children:0===t.length?(0,s.jsx)("p",{className:"text-center text-muted-foreground p-4",children:"No advisors added yet."}):(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,s.jsxs)("div",{className:"hidden md:grid grid-cols-12 gap-2 px-2 py-1 text-xs font-semibold text-muted-foreground border-b",children:[(0,s.jsx)("div",{className:"col-span-2",children:"Advisor"}),(0,s.jsx)("div",{className:"col-span-2",children:"Email"}),(0,s.jsx)("div",{className:"col-span-1",children:"Status"}),(0,s.jsx)("div",{className:"col-span-2",children:"Role"}),(0,s.jsx)("div",{className:"col-span-3",children:"Permissions"}),(0,s.jsx)("div",{className:"col-span-2 text-right",children:"Actions"})]}),t.map(e=>{let t=T===e.id,a=v===e.id,r=e.permissions||{},l=e.name.split(" ").map(e=>e[0]).join("").toUpperCase();return(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-2 items-center bg-card rounded-lg p-3 group border hover:shadow-md transition-all",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 col-span-2",children:[(0,s.jsx)("div",{className:"w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-lg",children:l}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-sm text-primary",children:e.name}),(0,s.jsx)("div",{className:"md:hidden text-xs text-muted-foreground",children:e.email})]})]}),(0,s.jsx)("div",{className:"hidden md:block col-span-2 text-xs text-muted-foreground",children:e.email}),(0,s.jsx)("div",{className:"col-span-1",children:"active"===e.status?(0,s.jsx)(X,{variant:"default",children:"Active"}):(0,s.jsx)(X,{variant:"destructive",children:"Pending"})}),(0,s.jsxs)("div",{className:"col-span-2 flex items-center gap-2",children:[(0,s.jsx)(X,{variant:"Captain"===e.role?"default":"Senior"===e.role?"secondary":"outline",className:"capitalize",children:e.role||"Standard"}),m&&(0,s.jsxs)(ed.l6,{value:e.role||"Standard",onValueChange:async t=>{await o(e.id,t)},children:[(0,s.jsx)(ed.bq,{className:"w-24 h-7 text-xs",children:(0,s.jsx)(ed.yv,{})}),(0,s.jsxs)(ed.gC,{children:[(0,s.jsx)(ed.eb,{value:"Standard",children:"Standard"}),(0,s.jsx)(ed.eb,{value:"Senior",children:"Senior"}),(0,s.jsx)(ed.eb,{value:"Captain",children:"Captain"})]})]})]}),(0,s.jsx)("div",{className:"col-span-3 grid grid-cols-1 sm:grid-cols-2 gap-2",children:Object.entries(r).map(t=>{let[a,r]=t;return(0,s.jsxs)(en,{children:[(0,s.jsx)(ei,{asChild:!0,children:(0,s.jsxs)("div",{className:"flex items-center gap-2 p-1 min-w-0",children:[(0,s.jsx)(ee,{checked:r,onCheckedChange:t=>Q(e.id,a,t),disabled:C||!m,className:"scale-90"}),(0,s.jsx)(es,{className:"text-xs cursor-pointer break-words truncate max-w-[120px]",title:ec[a]||a,children:ec[a]||a})]})}),(0,s.jsx)(eo,{children:ec[a]||a})]},a)})}),(0,s.jsx)("div",{className:"col-span-2 flex justify-end gap-1",children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.$,{variant:"ghost",size:"sm",onClick:eu,disabled:C&&!a,children:"Save"}),(0,s.jsx)(g.$,{variant:"ghost",size:"sm",onClick:em,disabled:C&&!a,children:"Cancel"})]}):(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(g.$,{variant:"ghost",size:"icon",onClick:()=>er(e),"aria-label":"Edit ".concat(e.name),className:"text-primary hover:bg-primary/10 h-7 w-7",disabled:C||!!v,children:(0,s.jsx)(O.A,{className:"h-4 w-4"})}),(0,s.jsxs)(_,{children:[(0,s.jsx)(B,{asChild:!0,children:(0,s.jsx)(g.$,{variant:"ghost",size:"icon","aria-label":"Remove ".concat(e.name),className:"text-destructive hover:bg-destructive/10 h-7 w-7",disabled:C||!!v,children:t?(0,s.jsx)(L.A,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(M.A,{className:"h-4 w-4"})})}),(0,s.jsxs)(V,{children:[(0,s.jsxs)(G,{children:[(0,s.jsx)(Z,{children:"Confirm Deletion"}),(0,s.jsxs)($,{children:["Are you sure you want to remove advisor '",e.name,"' (",e.email,")?","active"===e.status&&" This advisor has an active account.","This action cannot be undone."]})]}),(0,s.jsxs)(W,{children:[(0,s.jsx)(H,{disabled:C,children:"Cancel"}),(0,s.jsxs)(q,{onClick:()=>ea(e.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:C,children:[t?(0,s.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete"]})]})]})]})]})})]},e.id)})]})})}),(0,s.jsxs)(P.wL,{className:"text-sm text-muted-foreground pt-4",children:["Total Advisors: ",t.length]})]})]})})}var eu=a(3013),eh=a(3343),ex=a(644),ep=a(2873),ef=a(5339);let ev=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,d.cn)("w-full caption-bottom text-sm",a),...r})})});ev.displayName="Table";let eg=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsx)("thead",{ref:t,className:(0,d.cn)("[&_tr]:border-b",a),...l,children:r})});eg.displayName="TableHeader";let ey=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tbody",{ref:t,className:(0,d.cn)("[&_tr:last-child]:border-0",a),...r})});ey.displayName="TableBody",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tfoot",{ref:t,className:(0,d.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...r})}).displayName="TableFooter";let ej=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tr",{ref:t,className:(0,d.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...r})});ej.displayName="TableRow";let eb=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("th",{ref:t,className:(0,d.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...r})});eb.displayName="TableHead";let eN=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("td",{ref:t,className:(0,d.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...r})});eN.displayName="TableCell",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("caption",{ref:t,className:(0,d.cn)("mt-4 text-sm text-muted-foreground",a),...r})}).displayName="TableCaption";var ew=a(5074),eC=a(7150),ek=a(4214),eT=a(9545),eA=a(7381),eD=a(9556),eP=a(4607),eE=a(4548),eS=a(9164),eR=a(3941),eL=a(5119),eI=a(4641);function eO(e){let{loggedEvents:t,advisors:a}=e,l=r.useMemo(()=>{let e={};return a.forEach(t=>{e[t.id]={name:t.name,day:0,week:0,month:0}}),t.forEach(t=>{try{let a=new Date(t.date);if(isNaN(a.getTime())){console.warn("Skipping event with invalid date:",t);return}let s=t.loggedTime||0,r=new Date,l=(0,ex.o)(r),n=(0,eE.k)(r,{weekStartsOn:1}),i=(0,eS.w)(r),o=(0,eR.D)(r),d=(0,eL.$)(r,{weekStartsOn:1}),c=(0,eI.p)(r);if(!e[t.advisorId]){console.warn("Event found for unknown advisor:",t.advisorId);return}(0,ep.v)(a,{start:l,end:o})&&(e[t.advisorId].day+=s),(0,ep.v)(a,{start:n,end:d})&&(e[t.advisorId].week+=s),(0,ep.v)(a,{start:i,end:c})&&(e[t.advisorId].month+=s)}catch(e){console.error("Error processing event date in summary:",t.date,e)}}),e},[t,a]);return(0,s.jsxs)(P.Zp,{className:"w-full shadow-lg",children:[(0,s.jsx)(P.aR,{children:(0,s.jsx)(P.ZB,{className:"text-xl font-semibold text-primary",children:"Time Log Summary"})}),(0,s.jsx)(P.Wu,{children:(0,s.jsx)(S,{className:"h-[300px] border rounded-md",children:(0,s.jsxs)(ev,{children:[(0,s.jsx)(eg,{children:(0,s.jsxs)(ej,{children:[(0,s.jsx)(eb,{className:"w-[200px]",children:"Advisor"}),(0,s.jsx)(eb,{className:"w-[100px] text-right",children:"Today"}),(0,s.jsx)(eb,{className:"w-[100px] text-right",children:"This Week"}),(0,s.jsx)(eb,{className:"w-[100px] text-right",children:"This Month"})]})}),(0,s.jsx)(ey,{children:0===a.length?(0,s.jsx)(ej,{children:(0,s.jsx)(eN,{colSpan:4,className:"h-24 text-center text-muted-foreground",children:"No advisor data to summarize."})}):0===Object.entries(l).length?(0,s.jsx)(ej,{children:(0,s.jsx)(eN,{colSpan:4,className:"h-24 text-center text-muted-foreground",children:"No time logged for the current periods."})}):Object.entries(l).map(e=>{let[t,a]=e;return(0,s.jsxs)(ej,{children:[(0,s.jsx)(eN,{children:a.name}),(0,s.jsxs)(eN,{className:"text-right",children:[a.day," min"]}),(0,s.jsxs)(eN,{className:"text-right",children:[a.week," min"]}),(0,s.jsxs)(eN,{className:"text-right",children:[a.month," min"]})]},t)})})]})})})]})}var eM=a(1920),eF=a(965),eU=a(1011);function e_(e){let{className:t,classNames:a,showOutsideDays:r=!0,...l}=e;return(0,s.jsx)(eU.hv,{showOutsideDays:r,className:(0,d.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,d.cn)((0,g.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,d.cn)((0,g.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,s.jsx)(eF.A,{className:(0,d.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,s.jsx)(j.A,{className:(0,d.cn)("h-4 w-4",t),...a})}},...l})}e_.displayName="Calendar";var eB=a(547);let eY=eB.bL,ez=eB.l9,eV=r.forwardRef((e,t)=>{let{className:a,align:r="center",sideOffset:l=4,...n}=e;return(0,s.jsx)(eB.ZL,{children:(0,s.jsx)(eB.UC,{ref:t,align:r,sideOffset:l,className:(0,d.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});function eG(e){let{className:t,date:a,onDateChange:r}=e;return(0,s.jsx)("div",{className:(0,d.cn)("grid gap-2",t),children:(0,s.jsxs)(eY,{children:[(0,s.jsx)(ez,{asChild:!0,children:(0,s.jsxs)(g.$,{id:"date",variant:"outline",className:(0,d.cn)("w-[300px] justify-start text-left font-normal",!a&&"text-muted-foreground"),children:[(0,s.jsx)(eM.A,{className:"mr-2 h-4 w-4"}),(null==a?void 0:a.from)?a.to?(0,s.jsxs)(s.Fragment,{children:[(0,eu.GP)(a.from,"LLL dd, y")," - ",(0,eu.GP)(a.to,"LLL dd, y")]}):(0,eu.GP)(a.from,"LLL dd, y"):(0,s.jsx)("span",{children:"Pick a date range"})]})}),(0,s.jsx)(eV,{className:"w-auto p-0",align:"end",children:(0,s.jsx)(e_,{initialFocus:!0,mode:"range",selected:a,onSelect:r,numberOfMonths:2})})]})})}eV.displayName=eB.UC.displayName;let eW=()=>(0,eu.GP)(new Date,"yyyy-MM-dd"),eZ={Meeting:"bg-blue-500 hover:bg-blue-600",Training:"bg-green-500 hover:bg-green-600",Doctor:"bg-red-500 hover:bg-red-600",Dentist:"bg-purple-500 hover:bg-purple-600","Family care":"bg-yellow-500 hover:bg-yellow-600 text-black",Learning:"bg-indigo-500 hover:bg-indigo-600","Exam/Study":"bg-pink-500 hover:bg-pink-600","Task work":"bg-teal-500 hover:bg-teal-600",Charity:"bg-orange-500 hover:bg-orange-600",Other:"bg-gray-500 hover:bg-gray-600",default:"bg-gray-400 hover:bg-gray-500"},e$=e=>eZ[e]||eZ.default;function eq(e){let{events:t,advisors:a,onDeleteEvent:l,onEditEvent:n,deletingId:i,currentUser:o,currentUserIsAdmin:c}=e,[m,u]=(0,r.useState)(""),[h,x]=(0,r.useState)(void 0),[p,f]=(0,r.useState)("all"),[v,y]=(0,r.useState)("date"),[j,b]=(0,r.useState)("desc"),[N,w]=(0,r.useState)(!1),[C,k]=(0,r.useState)(null),T=(0,r.useMemo)(()=>a.reduce((e,t)=>(e[t.id]=t.name,e),{}),[a]),A=(0,r.useMemo)(()=>{let e=t,a=eW();if(N)e=t.filter(e=>e.date===a);else if((null==h?void 0:h.from)&&(e=e.filter(e=>{try{let t=(0,eh.H)(String(e.date)),a=(0,ex.o)(h.from),s=h.to?(0,ex.o)(h.to):(0,ex.o)(h.from);return s.setHours(23,59,59,999),(0,ep.v)(t,{start:a,end:s})}catch(t){return console.error("Error parsing date or filtering:",e.date,t),!1}})),"all"!==p&&(e=e.filter(e=>e.advisorId===p)),""!==m.trim()){let t=m.toLowerCase();e=e.filter(e=>{var a,s,r;let l=(null===(a=T[e.advisorId])||void 0===a?void 0:a.toLowerCase())||"",n=(null===(s=e.eventType)||void 0===s?void 0:s.toLowerCase())||"",i=(null===(r=e.eventDetails)||void 0===r?void 0:r.toLowerCase())||"",d=c||e.userId===(null==o?void 0:o.uid);return l.includes(t)||n.includes(t)||"Other"===e.eventType&&(d?i:"").includes(t)||"Other"!==e.eventType&&n.includes(t)})}return e},[t,h,p,m,T,N,o,c]),E=(0,r.useMemo)(()=>Array.isArray(A)?[...A].sort((e,t)=>{let a=0;try{switch(v){case"date":let s=(0,eh.H)(String(e.date||"")).getTime(),r=(0,eh.H)(String(t.date||"")).getTime();a=(0,ef.z)(isNaN(s)?0:s,isNaN(r)?0:r);break;case"advisor":let l=T[e.advisorId]||"",n=T[t.advisorId]||"";a=l.localeCompare(n);break;case"eventType":a=String(e.eventType||"").localeCompare(String(t.eventType||""));break;case"loggedTime":a=(e.loggedTime||0)-(t.loggedTime||0)}}catch(a){console.error("Error during sorting:",a,e,t)}return"asc"===j?a:-a}):[],[A,v,j,T]),R=e=>"Other"===e.eventType&&e.eventDetails?c||e.userId===(null==o?void 0:o.uid)?"Other (".concat(e.eventDetails.substring(0,30)).concat(e.eventDetails.length>30?"...":"",")"):"Other [comment hidden]":"string"==typeof e.eventType?e.eventType:"Unknown Event",I=async e=>{if(!i)try{await l(e.id)}catch(e){console.error("Error calling onDeleteEvent from EventList:",e)}},F=e=>{i||n(e)},U=(null==h?void 0:h.from)||"all"!==p||""!==m;return(0,s.jsx)(el,{children:(0,s.jsxs)(P.Zp,{className:"w-full shadow-lg",children:[(0,s.jsxs)(P.aR,{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0 pb-2",children:[(0,s.jsx)(P.ZB,{className:"text-xl font-semibold text-primary",children:"Logged Events"}),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-2 flex-wrap",children:[(0,s.jsxs)("div",{className:"relative w-full md:w-auto",children:[(0,s.jsx)(ew.A,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(D,{type:"search",placeholder:"Search events...",className:"pl-8 w-full md:w-[180px]",value:m,onChange:e=>u(e.target.value),disabled:N})]}),(0,s.jsx)(eG,{date:h,onDateChange:x}),(0,s.jsxs)(ed.l6,{onValueChange:f,value:p,disabled:N,children:[(0,s.jsx)(ed.bq,{className:"w-full md:w-[160px]",children:(0,s.jsx)(ed.yv,{placeholder:"Filter Advisor"})}),(0,s.jsxs)(ed.gC,{children:[(0,s.jsx)(ed.eb,{value:"all",children:"All Advisors"}),a.map(e=>(0,s.jsx)(ed.eb,{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(ed.l6,{onValueChange:e=>y(e),value:v,children:[(0,s.jsxs)(ed.bq,{className:"w-auto",children:[" ",(0,s.jsx)(ed.yv,{placeholder:"Sort by..."})," "]}),(0,s.jsxs)(ed.gC,{children:[(0,s.jsx)(ed.eb,{value:"date",children:"Date"}),(0,s.jsx)(ed.eb,{value:"advisor",children:"Advisor"}),(0,s.jsx)(ed.eb,{value:"eventType",children:"Event Type"}),(0,s.jsx)(ed.eb,{value:"loggedTime",children:"Time Logged"})]})]}),(0,s.jsxs)(g.$,{variant:"outline",size:"icon",onClick:()=>{b(e=>"asc"===e?"desc":"asc")},"aria-label":"Toggle sort direction",children:[" ",(0,s.jsx)(eC.A,{className:"h-4 w-4"})," "]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[N?(0,s.jsxs)(g.$,{variant:"secondary",size:"sm",onClick:()=>{w(!1)},children:[" ",(0,s.jsx)(ek.A,{className:"mr-2 h-4 w-4"})," Show All Logs "]}):(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:()=>{w(!0),x(void 0),f("all"),u("")},children:[" ",(0,s.jsx)(eT.A,{className:"mr-2 h-4 w-4"})," View Today's Logs "]}),U&&!N&&(0,s.jsx)(g.$,{variant:"ghost",size:"sm",onClick:()=>{x(void 0),f("all"),u(""),w(!1)},children:"Clear Filters"})]})]})]}),(0,s.jsxs)(P.Wu,{children:[N&&(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mb-4 italic",children:["Showing all logs for today (",(0,eu.GP)(new Date,"MMM dd, yyyy"),"). Sorting is still applied."]}),(0,s.jsx)(S,{className:"h-[400px] border rounded-md",children:(0,s.jsxs)(ev,{children:[(0,s.jsx)(eg,{className:"sticky top-0 bg-secondary z-10",children:(0,s.jsxs)(ej,{children:[(0,s.jsx)(eb,{className:"w-[110px]",children:"Date"}),(0,s.jsx)(eb,{children:"Advisor"}),(0,s.jsx)(eb,{children:"Event Type / Details"}),(0,s.jsx)(eb,{className:"w-[160px] text-right",children:"Time (24h)"}),(0,s.jsx)(eb,{className:"w-[100px] text-right",children:"Actions"})]})}),(0,s.jsx)(ey,{children:0===E.length?(0,s.jsx)(ej,{children:(0,s.jsx)(eN,{colSpan:5,className:"h-24 text-center text-muted-foreground",children:N?"No events logged today yet.":U?"No events found for the selected filters.":"No events logged yet."})}):E.map(e=>{let t=i===e.id,a=R(e),r=C===e.id,l=e.eventDetails||"",n="Other"===e.eventType&&l.length>70,m=c||o&&e.userId===o.uid;return(0,s.jsxs)(ej,{className:(0,d.cn)(t&&"opacity-50"),children:[(0,s.jsxs)(eN,{children:[" ",e.date?(0,eu.GP)((0,eh.H)(String(e.date)),"MMM dd, yyyy"):"Invalid Date"," "]}),(0,s.jsx)(eN,{children:T[e.advisorId]||"Unknown Advisor"}),(0,s.jsx)(eN,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)(X,{className:(0,d.cn)("text-white",e$(e.eventType)),children:"string"==typeof e.eventType?e.eventType:"N/A"}),"Other"===e.eventType&&e.eventDetails&&(0,s.jsx)("div",{className:"mt-1 text-xs text-muted-foreground",children:m?(0,s.jsxs)(s.Fragment,{children:[r?e.eventDetails:"".concat(e.eventDetails.substring(0,70)).concat(n?"...":""),n&&(0,s.jsxs)(g.$,{variant:"link",size:"sm",className:"p-0 h-auto ml-1 text-blue-500",onClick:()=>k(r?null:e.id),children:[r?"Read less":"Read more",r?(0,s.jsx)(eA.A,{className:"h-3 w-3 ml-1"}):(0,s.jsx)(eD.A,{className:"h-3 w-3 ml-1"})]})]}):(0,s.jsxs)("span",{className:"italic flex items-center",children:[(0,s.jsx)(eP.A,{className:"h-3 w-3 mr-1 text-gray-400"})," Comment hidden"]})})]})}),(0,s.jsx)(eN,{className:"text-right",children:e.startTime&&e.endTime?"".concat(e.startTime," - ").concat(e.endTime):"".concat(e.loggedTime," min")}),(0,s.jsxs)(eN,{className:"text-right space-x-1",children:[(0,s.jsxs)(en,{children:[(0,s.jsx)(ei,{asChild:!0,children:(0,s.jsx)(g.$,{variant:"ghost",size:"icon",className:"text-primary hover:bg-primary/10 h-8 w-8",onClick:()=>F(e),disabled:!!i,"aria-label":"Edit Event",children:(0,s.jsx)(O.A,{className:"h-4 w-4"})})}),(0,s.jsx)(eo,{children:(0,s.jsx)("p",{children:"Edit Event"})})]}),(0,s.jsxs)(_,{children:[(0,s.jsx)(B,{asChild:!0,children:(0,s.jsx)(g.$,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10 h-8 w-8",disabled:!!i,"aria-label":"Delete Event",children:t?(0,s.jsx)(L.A,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(M.A,{className:"h-4 w-4"})})}),(0,s.jsxs)(V,{children:[(0,s.jsxs)(G,{children:[(0,s.jsx)(Z,{children:"Are you absolutely sure?"}),(0,s.jsxs)($,{children:[' This action cannot be undone. This will permanently delete the event: "',(0,s.jsx)("span",{className:"font-semibold",children:a}),'". ']})]}),(0,s.jsxs)(W,{children:[(0,s.jsx)(H,{disabled:t,children:"Cancel"}),(0,s.jsxs)(q,{onClick:()=>I(e),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:t,children:[t?(0,s.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):null," Delete"]})]})]})]})]})]},e.id)})})]})}),(0,s.jsx)("div",{className:"mt-8",children:(0,s.jsx)(eO,{loggedEvents:E,advisors:a})})]})]})})}let eH=["Meeting","Training","Doctor","Dentist","Family care","Learning","Exam/Study","Task work","Charity","Other"];var eJ=a(2177),eK=a(221),eX=a(5594),eQ=a(3915),e0=a(8539),e2=a(9708);let e1=eJ.Op,e4=r.createContext({}),e5=e=>{let{...t}=e;return(0,s.jsx)(e4.Provider,{value:{name:t.name},children:(0,s.jsx)(eJ.xI,{...t})})},e3=()=>{let e=r.useContext(e4),t=r.useContext(e6),{getFieldState:a,formState:s}=(0,eJ.xW)(),l=a(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:n}=t;return{id:n,name:e.name,formItemId:"".concat(n,"-form-item"),formDescriptionId:"".concat(n,"-form-item-description"),formMessageId:"".concat(n,"-form-item-message"),...l}},e6=r.createContext({}),e9=r.forwardRef((e,t)=>{let{className:a,...l}=e,n=r.useId();return(0,s.jsx)(e6.Provider,{value:{id:n},children:(0,s.jsx)("div",{ref:t,className:(0,d.cn)("space-y-2",a),...l})})});e9.displayName="FormItem";let e8=r.forwardRef((e,t)=>{let{className:a,...r}=e,{error:l,formItemId:n}=e3();return(0,s.jsx)(es,{ref:t,className:(0,d.cn)(l&&"text-destructive",a),htmlFor:n,...r})});e8.displayName="FormLabel";let e7=r.forwardRef((e,t)=>{let{...a}=e,{error:r,formItemId:l,formDescriptionId:n,formMessageId:i}=e3();return(0,s.jsx)(e2.DX,{ref:t,id:l,"aria-describedby":r?"".concat(n," ").concat(i):"".concat(n),"aria-invalid":!!r,...a})});e7.displayName="FormControl",r.forwardRef((e,t)=>{let{className:a,...r}=e,{formDescriptionId:l}=e3();return(0,s.jsx)("p",{ref:t,id:l,className:(0,d.cn)("text-sm text-muted-foreground",a),...r})}).displayName="FormDescription";let te=r.forwardRef((e,t)=>{var a;let{className:r,children:l,...n}=e,{error:i,formMessageId:o}=e3(),c=i?String(null!==(a=null==i?void 0:i.message)&&void 0!==a?a:""):l;return c?(0,s.jsx)("p",{ref:t,id:o,className:(0,d.cn)("text-sm font-medium text-destructive",r),...n,children:c}):null});te.displayName="FormMessage";var tt=a(960),ta=a(5318),ts=a(9119),tr=a(4301);let tl=eX.Ik({date:eX.p6({required_error:"A date is required."}),advisorId:eX.Yj({required_error:"Please select an advisor."}).min(1,"Please select an advisor."),eventType:eX.k5(eH,{required_error:"Please select an event type."}),eventDetails:eX.Yj().optional(),startTime:eX.Yj({required_error:"Start time is required."}).regex(/^\d{2}:\d{2}$/,"Invalid start time"),endTime:eX.Yj({required_error:"End time is required."}).regex(/^\d{2}:\d{2}$/,"Invalid end time")}).refine(e=>"Other"!==e.eventType||!!e.eventDetails&&"string"==typeof e.eventDetails&&e.eventDetails.trim().length>0,{message:"Please provide details for the 'Other' event type.",path:["eventDetails"]}).refine(e=>{let[t,a]=e.startTime.split(":").map(Number),[s,r]=e.endTime.split(":").map(Number);return 60*s+r>60*t+a},{message:"End time must be after start time.",path:["endTime"]}),tn={date:void 0,advisorId:"",eventType:eH[0],eventDetails:"",startTime:"09:00",endTime:"09:30"};function ti(e){let{advisors:t,onLogEvent:a,onUpdateEvent:l,onCancelEdit:n,eventToEdit:i,isSubmitting:o}=e,{toast:c}=(0,F.dj)(),m=!!i,u=e=>"string"==typeof e&&eH.includes(e)?e:(m&&e&&!eH.includes(e)&&console.warn("Invalid event type '".concat(e,"' provided for editing. Defaulting to 'Other'.")),"Other"),h=(0,eJ.mN)({resolver:(0,eK.u)(tl),defaultValues:i?{date:(0,eh.H)(i.date),advisorId:i.advisorId,eventType:u(i.eventType),eventDetails:i.eventDetails||"",startTime:i.startTime||"09:00",endTime:i.endTime||"09:30"}:{...tn,date:new Date},mode:"onChange"}),x=h.watch("eventType");async function p(e){if(!(e.date instanceof Date)||isNaN(e.date.getTime())){c({title:"Invalid Date",description:"Please select a valid date.",variant:"destructive"});return}let[t,s]=e.startTime.split(":").map(Number),[r,n]=e.endTime.split(":").map(Number),o={date:(0,eu.GP)(e.date,"yyyy-MM-dd"),advisorId:e.advisorId,eventType:e.eventType,eventDetails:"Other"===e.eventType?(e.eventDetails||"").trim():null,loggedTime:60*r+n-(60*t+s),startTime:e.startTime,endTime:e.endTime};try{m&&i?(await l(i.id,o),c({title:"Success",description:"Event updated successfully."})):(await a(o),c({title:"Success",description:"Time logged successfully."}),h.reset({...tn,date:new Date}))}catch(t){console.error("Error ".concat(m?"updating":"submitting"," time log from form:"),t);let e="Failed to ".concat(m?"update":"log"," event. Please try again.");t instanceof eQ.g?e=t.message:t instanceof Error&&(e=t.message),c({title:"Error",description:e,variant:"destructive"})}}return(0,r.useEffect)(()=>{i?h.reset({date:(0,eh.H)(i.date),advisorId:i.advisorId,eventType:u(i.eventType),eventDetails:i.eventDetails||"",startTime:i.startTime||"09:00",endTime:i.endTime||"09:30"}):h.reset({...tn,date:new Date})},[i,h]),(0,s.jsxs)(P.Zp,{id:"time-log-form-card",className:"w-full shadow-lg mb-6",children:[(0,s.jsx)(P.aR,{children:(0,s.jsx)(P.ZB,{className:"text-xl font-semibold text-primary",children:m?"Edit Time Entry":"Log New Time Entry"})}),(0,s.jsx)(P.Wu,{children:(0,s.jsx)(e1,{...h,children:(0,s.jsxs)("form",{onSubmit:h.handleSubmit(p),className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(e5,{control:h.control,name:"date",render:e=>{let{field:t}=e;return(0,s.jsxs)(e9,{className:"flex flex-col",children:[(0,s.jsx)(e8,{children:"Date"}),(0,s.jsxs)(eY,{children:[(0,s.jsx)(ez,{asChild:!0,children:(0,s.jsx)(e7,{children:(0,s.jsxs)(g.$,{variant:"outline",disabled:o,className:(0,d.cn)("w-full justify-start text-left font-normal",!(t.value instanceof Date)&&"text-muted-foreground"),children:[(0,s.jsx)(eM.A,{className:"mr-2 h-4 w-4"}),t.value instanceof Date&&!isNaN(t.value.getTime())?(0,eu.GP)(t.value,"PPP"):(0,s.jsx)("span",{children:"Pick a date"})]})})}),(0,s.jsx)(eV,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(e_,{mode:"single",selected:t.value instanceof Date?t.value:void 0,onSelect:t.onChange,disabled:e=>e<new Date("1900-01-01")||o,initialFocus:!0})})]}),(0,s.jsx)(te,{})]})}}),(0,s.jsx)(e5,{control:h.control,name:"advisorId",render:e=>{let{field:a}=e;return(0,s.jsxs)(e9,{children:[(0,s.jsx)(e8,{children:"Advisor"}),(0,s.jsxs)(ed.l6,{onValueChange:a.onChange,value:a.value||"",disabled:o,children:[(0,s.jsx)(e7,{children:(0,s.jsx)(ed.bq,{children:(0,s.jsx)(ed.yv,{placeholder:"Select an advisor"})})}),(0,s.jsx)(ed.gC,{children:0===t.length?(0,s.jsx)(ed.eb,{value:"-",disabled:!0,children:"No advisors available"}):t.map(e=>(0,s.jsx)(ed.eb,{value:e.id,children:e.name},e.id))})]}),(0,s.jsx)(te,{})]})}})]}),(0,s.jsxs)("div",{className:(0,d.cn)("grid grid-cols-1 gap-4","Other"===x?"":"md:grid-cols-2"),children:[(0,s.jsx)(e5,{control:h.control,name:"eventType",render:e=>{let{field:t}=e;return(0,s.jsxs)(e9,{children:[(0,s.jsx)(e8,{children:"Event Type"}),(0,s.jsxs)(ed.l6,{onValueChange:t.onChange,value:t.value,disabled:o,children:[(0,s.jsx)(e7,{children:(0,s.jsxs)(ed.bq,{children:[(0,s.jsx)(tt.A,{className:"mr-2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(ed.yv,{placeholder:"Select event type"})]})}),(0,s.jsx)(ed.gC,{children:eH.map(e=>(0,s.jsx)(ed.eb,{value:e,children:e},e))})]}),(0,s.jsx)(te,{})]})}}),(0,s.jsx)(e5,{control:h.control,name:"startTime",render:e=>{let{field:t}=e;return(0,s.jsxs)(e9,{children:[(0,s.jsx)(e8,{children:"Start Time"}),(0,s.jsx)(e7,{children:(0,s.jsx)("input",{type:"time",step:"60",...t,className:"w-full border rounded px-2 py-1",disabled:o})}),(0,s.jsx)(te,{})]})}}),(0,s.jsx)(e5,{control:h.control,name:"endTime",render:e=>{let{field:t}=e;return(0,s.jsxs)(e9,{children:[(0,s.jsx)(e8,{children:"End Time"}),(0,s.jsx)(e7,{children:(0,s.jsx)("input",{type:"time",step:"60",...t,className:"w-full border rounded px-2 py-1",disabled:o})}),(0,s.jsx)(te,{})]})}})]}),"Other"===x&&(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,s.jsx)(e5,{control:h.control,name:"eventDetails",render:e=>{let{field:t}=e;return(0,s.jsxs)(e9,{className:"md:col-span-1",children:[(0,s.jsx)(e8,{children:'Details for "Other"'}),(0,s.jsx)(e7,{children:(0,s.jsx)(e0.T,{placeholder:"Please specify the details for the 'Other' event...",...t,value:t.value||"",disabled:o,rows:3})}),(0,s.jsx)(te,{})]})}})}),(0,s.jsxs)(P.wL,{className:(0,d.cn)("p-0 pt-4 flex gap-2",m?"justify-between":"justify-end"),children:[m&&(0,s.jsxs)(g.$,{type:"button",variant:"outline",onClick:n,disabled:o,children:[(0,s.jsx)(ta.A,{className:"mr-2 h-4 w-4"})," Cancel"]}),(0,s.jsxs)(g.$,{type:"submit",className:(0,d.cn)("bg-accent text-accent-foreground hover:bg-accent/90",m?"":"w-full"),disabled:0===t.length&&!m||o,children:[o?(0,s.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):m?(0,s.jsx)(ts.A,{className:"mr-2 h-4 w-4"}):(0,s.jsx)(tr.A,{className:"mr-2 h-4 w-4"}),o?m?"Saving...":"Logging...":m?"Save Changes":"Log Time"]})]}),0===t.length&&!m&&(0,s.jsx)("p",{className:"text-sm text-destructive text-center mt-2",children:"Please add an advisor before logging time."})]})})})]})}var to=a(8816),td=a(1407),tc=a(4376),tm=a(408),tu=a.n(tm),th=a(2699),tx=a.n(th),tp=a(7489);let tf=r.forwardRef((e,t)=>{let{className:a,orientation:r="horizontal",decorative:l=!0,...n}=e;return(0,s.jsx)(tp.b,{ref:t,decorative:l,orientation:r,className:(0,d.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",a),...n})});tf.displayName=tp.b.displayName;var tv=a(6861),tg=a(8718),ty=a(4065),tj=a(2502);tj.t1.register(tj.PP,tj.kc,tj.E8,tj.hE,tj.m_,tj.s$,tj.Bs,tj.FN,tj.No,tj.dN);let tb=r.forwardRef((e,t)=>{let{advisorTimeData:a,advisorTimeBreakdownData:r,timeTrendData:l,currentFiltersText:n}=e,i={responsive:!0,maintainAspectRatio:!1,animation:{duration:0},plugins:{legend:{position:"top"},title:{display:!1}}};return(0,s.jsxs)("div",{ref:t,className:"bg-white text-black p-6 shadow-lg grid grid-cols-2 grid-rows-[auto_1fr_1fr] gap-6",style:{width:"".concat(1200,"px"),height:"".concat(750,"px")},children:[(0,s.jsxs)("div",{className:"col-span-2 border-b pb-4 mb-2",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-center mb-2",children:"Time Log Visualization"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 text-center",children:n})]}),(0,s.jsxs)("div",{className:"border rounded-lg p-4 flex flex-col",style:{height:"300px"},children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-center mb-2",children:"Time Logged Per Advisor"}),(0,s.jsx)("div",{className:"flex-grow relative",children:a&&a.datasets.length>0?(0,s.jsx)(ty.yP,{data:a,options:i}):(0,s.jsx)("p",{className:"text-center text-gray-500",children:"No data"})})]}),(0,s.jsxs)("div",{className:"border rounded-lg p-4 flex flex-col",style:{height:"300px"},children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-center mb-2",children:"Time Breakdown by Advisor"}),(0,s.jsx)("div",{className:"flex-grow relative flex justify-center items-center",children:r&&r.datasets.length>0?(0,s.jsx)("div",{className:"relative w-full h-full max-w-[250px] max-h-[250px]",children:(0,s.jsx)(ty.nu,{data:r,options:{...i,maintainAspectRatio:!0}})}):(0,s.jsx)("p",{className:"text-center text-gray-500",children:"No data"})})]}),(0,s.jsxs)("div",{className:"col-span-2 border rounded-lg p-4 flex flex-col",style:{height:"300px"},children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-center mb-2",children:"Daily Time Log Trend"}),(0,s.jsx)("div",{className:"flex-grow relative",children:l&&l.datasets.length>0?(0,s.jsx)(ty.N1,{data:l,options:i}):(0,s.jsx)("p",{className:"text-center text-gray-500",children:"No data"})})]})]})});tb.displayName="ExportVisualizationLayout";var tN=a(2834);tj.t1.register(tj.PP,tj.kc,tj.E8,tj.hE,tj.m_,tj.s$,tj.Bs,tj.FN,tj.No,tj.dN,tN.A);let tw=[{label:"Today",value:"day"},{label:"This Week",value:"week"},{label:"Last 7 Days",value:"last7"},{label:"Last 30 Days",value:"last30"},{label:"This Month",value:"month"},{label:"This Year",value:"year"},{label:"Custom",value:"custom"}],tC=e=>{let t=tw.find(t=>t.value===e);return t?t.label:"Unknown"},tk=e=>{if(!e||!e.from)return"Not Set";let t=(0,eu.GP)(e.from,"dd/MM/yyyy"),a=e.to?(0,eu.GP)(e.to,"dd/MM/yyyy"):t;return t===a?t:"".concat(t," - ").concat(a)},tT=e=>{if(e<0)return"0 min";let t=Math.floor(e/60),a=e%60,s="";return t>0?(s+="".concat(t,"h"),a>0&&(s+=" ".concat(a,"m"))):s+="".concat(a,"m"),"".concat(e," min").concat(t>0?" (".concat(s,")"):"")};function tA(e){let{loggedEvents:t,advisors:a}=e,l=(0,r.useRef)(null),[n,i]=(0,r.useState)("week"),[o,c]=(0,r.useState)(void 0),[m,u]=(0,r.useState)("all"),[h,x]=(0,r.useState)("all"),[p,f]=(0,r.useState)(!1),[y,j]=(0,r.useState)(!1),{resolvedTheme:b}=(0,v.D)(),N=(0,r.useMemo)(()=>a.reduce((e,t)=>(e[t.id]=t.name,e),{}),[a]),w=(0,r.useMemo)(()=>{let e=new Set;return t.forEach(t=>{t.eventType&&"string"==typeof t.eventType&&""!==t.eventType.trim()&&e.add(t.eventType.trim())}),Array.from(e).sort()},[t]),C=(0,r.useMemo)(()=>{let e,a=t,s=new Date,r=(0,eR.D)(s);return"day"===n?e=(0,ex.o)(s):"week"===n?(e=(0,eE.k)(s,{weekStartsOn:1}),r=(0,eL.$)(s,{weekStartsOn:1})):"last7"===n?e=(0,ex.o)((0,to.e)(s,6)):"last30"===n?e=(0,ex.o)((0,to.e)(s,29)):"month"===n?(e=(0,eS.w)(s),r=(0,eI.p)(s)):"year"===n?(e=(0,td.D)(s),r=(0,tc.Q)(s)):"custom"===n&&(null==o?void 0:o.from)&&(e=(0,ex.o)(o.from),r=o.to?(0,eR.D)(o.to):(0,eR.D)(o.from)),e&&r&&(a=a.filter(t=>{try{let a=(0,eh.H)(t.date);if(isNaN(a.getTime()))return!1;return(0,ep.v)(a,{start:e,end:r})}catch(e){return console.error("Error parsing event date or checking interval:",t.date,e),!1}})),"all"!==m&&(a=a.filter(e=>e.advisorId===m)),"all"!==h&&(a=a.filter(e=>e.eventType===h)),a},[t,n,o,m,h]),k=(0,r.useMemo)(()=>{if(0===C.length)return{labels:[],datasets:[]};let e={};return C.forEach(t=>{e[t.advisorId]||(e[t.advisorId]=0),e[t.advisorId]+=t.loggedTime}),{labels:Object.keys(e).map(e=>N[e]||"Unknown Advisor"),datasets:[{label:"Time Logged (minutes)",data:Object.values(e),backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]}},[C,N]),T=(0,r.useMemo)(()=>{if(0===C.length)return{labels:[],datasets:[]};let e={};C.forEach(t=>{e[t.advisorId]||(e[t.advisorId]=0),e[t.advisorId]+=t.loggedTime});let t=Object.keys(e).map(e=>N[e]||"Unknown Advisor"),a=Object.values(e),s=["#a1c9f4","#ffb482","#8de5a1","#ff9f9b","#d0bbff","#fcfcd4","#c7ceff","#f9c0c0","#b5e8d8"],r=t.map((e,t)=>s[t%s.length]);return{labels:t,datasets:[{label:"Time Logged (minutes)",data:a,backgroundColor:r,borderColor:"transparent",borderWidth:2}]}},[C,N]),A=(0,r.useMemo)(()=>{if(0===C.length)return{labels:[],datasets:[]};let e={};[...C].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()).forEach(t=>{let a=t.date;e[a]||(e[a]=0),e[a]+=t.loggedTime});let t=Object.keys(e).sort((e,t)=>new Date(e).getTime()-new Date(t).getTime()),a=t.map(e=>(0,eu.GP)((0,eh.H)(e),"dd MMM"));return{labels:a,datasets:[{label:"Time Logged Daily (minutes)",data:t.map(t=>e[t]),borderColor:"dark"===b?"rgba(54, 162, 235, 0.8)":"rgba(54, 162, 235, 1)",backgroundColor:"dark"===b?"rgba(54, 162, 235, 0.3)":"rgba(54, 162, 235, 0.2)",fill:!0,tension:.1}]}},[C,b]),D=(0,r.useMemo)(()=>{let e=tC(n),t="custom"===n?tk(o):e,a="all"===m?"All Advisors":N[m]||"Unknown",s="all"===h?"All Event Types":h;return"Filters Active: Date Range: ".concat(t," | Advisor: ").concat(a," | Event Type: ").concat(s)},[n,o,m,h,N]),E="week"!==n||"all"!==m||"all"!==h,S=async()=>{p||(f(!0),j(!0),setTimeout(async()=>{if(l.current)try{let e=(await tx()(l.current,{scale:2,logging:!1,useCORS:!0,backgroundColor:"dark"===b?"#1a1a1a":"#ffffff",onclone:e=>{e.querySelectorAll("canvas").forEach(e=>{let t=tj.t1.getChart(e);if(t){var a;"bar"===t.config.type&&(null===(a=t.options.plugins)||void 0===a?void 0:a.datalabels)&&(t.options.plugins.datalabels.display=!1,t.update("none"))}})}})).toDataURL("image/png"),t=document.createElement("a");t.href=e;let a="all"===m?"all_advisors":(N[m]||"unknown").replace(/\s+/g,"_").toLowerCase(),s="all"===h?"all_events":"string"==typeof h?h.replace(/[^a-z0-9]/gi,"_").toLowerCase():"unknown_event",r=("custom"===n?tk(o).replace(/\s*-\s*/g,"_"):tC(n)).replace(/[^a-z0-9_]/gi,"_").toLowerCase();t.download="viz_".concat(a,"_").concat(s,"_").concat(r,"_").concat((0,eu.GP)(new Date,"yyyyMMddHHmm"),".png"),document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(e){console.error("Error exporting visualization:",e)}finally{j(!1),f(!1)}else console.error("Export layout ref not found."),j(!1),f(!1)},200))},R=(0,r.useMemo)(()=>{var e;return{responsive:!0,maintainAspectRatio:!0,animation:{duration:300},scales:{x:{ticks:{color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)"},grid:{color:"dark"===b?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}},y:{beginAtZero:!0,suggestedMax:1.25*Math.max(...(null===(e=k.datasets[0])||void 0===e?void 0:e.data)||[0]),ticks:{color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)"},grid:{color:"dark"===b?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}}},plugins:{legend:{display:!0,position:"top",labels:{color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)"}},tooltip:{enabled:!0},datalabels:{display:!0,anchor:"end",align:"top",color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)",font:{weight:"bold",size:12},formatter:e=>e<=0?null:tT(e),offset:4,padding:0}}}},[b,k]),I=(0,r.useMemo)(()=>({responsive:!0,maintainAspectRatio:!1,animation:{duration:300},plugins:{legend:{position:"top",labels:{color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)"}},tooltip:{enabled:!0}}}),[b]),O=(0,r.useMemo)(()=>({responsive:!0,maintainAspectRatio:!0,animation:{duration:300},scales:{x:{ticks:{color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)"},grid:{color:"dark"===b?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}},y:{ticks:{color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)"},grid:{color:"dark"===b?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}}},plugins:{legend:{display:!1},tooltip:{enabled:!0}}}),[b]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(P.Zp,{className:"w-full shadow-lg",children:[(0,s.jsxs)(P.aR,{className:"pb-4",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4",children:[(0,s.jsx)(P.ZB,{className:"text-xl font-semibold text-primary mb-2 sm:mb-0",children:"Visualizations"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 self-end sm:self-center",children:[(0,s.jsxs)(g.$,{variant:"ghost",size:"sm",onClick:()=>{i("week"),c(void 0),u("all"),x("all")},disabled:!E||p,"aria-label":"Clear Filters",className:(0,d.cn)(!E&&"text-muted-foreground"),children:[(0,s.jsx)(tv.A,{className:"mr-2 h-4 w-4"})," Clear"]}),(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:S,disabled:p||0===C.length,"aria-label":"Export Visualizations as PNG",children:[p?(0,s.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(tg.A,{className:"mr-2 h-4 w-4"})," Export PNG"]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Date Range"}),(0,s.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:tw.map(e=>(0,s.jsx)(g.$,{variant:n===e.value?"secondary":"outline",size:"sm",onClick:()=>i(e.value),className:(0,d.cn)("h-8","custom"===n&&"custom"===e.value&&"ring-2 ring-primary"),children:e.label},e.value))}),"custom"===n&&(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)(eG,{date:o,onDateChange:c})})]}),(0,s.jsx)("div",{className:"flex flex-col md:flex-row md:items-end gap-3",children:(0,s.jsxs)("div",{className:"flex-grow flex flex-col sm:flex-row gap-3",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-[160px]",children:[(0,s.jsx)("label",{htmlFor:"event-type-filter",className:"text-sm font-medium block mb-1.5",children:"Event Type"}),(0,s.jsxs)(ed.l6,{onValueChange:x,value:h,children:[(0,s.jsx)(ed.bq,{id:"event-type-filter",className:"w-full",children:(0,s.jsx)(ed.yv,{placeholder:"Filter by Event Type"})}),(0,s.jsxs)(ed.gC,{children:[(0,s.jsx)(ed.eb,{value:"all",children:"All Event Types"}),w.map(e=>(0,s.jsx)(ed.eb,{value:e,children:e},e))]})]})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-[160px]",children:[(0,s.jsx)("label",{htmlFor:"advisor-filter",className:"text-sm font-medium block mb-1.5",children:"Advisor"}),(0,s.jsxs)(ed.l6,{onValueChange:u,value:m,children:[(0,s.jsx)(ed.bq,{id:"advisor-filter",className:"w-full",children:(0,s.jsx)(ed.yv,{placeholder:"Filter by Advisor"})}),(0,s.jsxs)(ed.gC,{children:[(0,s.jsx)(ed.eb,{value:"all",children:"All Advisors"}),a.map(e=>(0,s.jsx)(ed.eb,{value:e.id,children:e.name},e.id))]})]})]})]})})]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground pt-3 mt-4 border-t border-dashed",children:D})]}),(0,s.jsx)(P.Wu,{className:"space-y-8 pt-6",children:0===C.length?(0,s.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"No data available for the selected filters."}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{id:"advisor-time-bar-chart",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-center mb-4",children:"Time Logged Per Advisor"}),(0,s.jsx)(ty.yP,{id:"advisor-time-bar-chart-canvas",data:k,options:R})]}),(0,s.jsx)(tf,{}),(0,s.jsxs)("div",{id:"advisor-time-doughnut-chart",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-center mb-4",children:"Advisor Time Distribution"}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("div",{className:"relative h-64 w-64 md:h-80 md:w-80",children:(0,s.jsx)(ty.nu,{data:T,options:I})})})]}),(0,s.jsx)(tf,{}),(0,s.jsxs)("div",{id:"daily-time-trend-line-chart",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-center mb-4",children:"Daily Time Log Trend"}),(0,s.jsx)(ty.N1,{data:A,options:O})]})]})})]}),y&&(0,s.jsx)("div",{style:{position:"absolute",top:"-9999px",left:"-9999px",zIndex:-10},children:(0,s.jsx)(tb,{ref:l,advisorTimeData:k,advisorTimeBreakdownData:T,timeTrendData:A,currentFiltersText:D})})]})}let tD=[{label:"Today",value:"day"},{label:"This Week",value:"week"},{label:"Last 7 Days",value:"last7"},{label:"Last 30 Days",value:"last30"},{label:"This Month",value:"month"},{label:"This Year",value:"year"},{label:"All Time",value:"all"},{label:"Custom",value:"custom"}],tP=e=>{let t=tD.find(t=>t.value===e);return t?t.label:"Unknown"},tE=e=>{if(!e||!e.from)return"Not Set";let t=(0,eu.GP)(e.from,"dd/MM/yyyy"),a=e.to?(0,eu.GP)(e.to,"dd/MM/yyyy"):t;return t===a?t:"".concat(t," - ").concat(a)},tS=["#a1c9f4","#ffb482","#8de5a1","#ff9f9b","#d0bbff","#fcfcd4","#c7ceff","#f9c0c0","#b5e8d8"],tR=e=>tS[e%tS.length];function tL(e){let{loggedEvents:t,advisors:a,advisorId:l}=e,[n,i]=(0,r.useState)("week"),[o,c]=(0,r.useState)(void 0),[m,u]=(0,r.useState)("all"),[h,x]=(0,r.useState)("all"),[p,f]=(0,r.useState)(!1),[y,j]=r.useState(!1),b=(0,r.useMemo)(()=>a.reduce((e,t)=>(e[t.id]=t.name,e),{}),[a]),N=(0,r.useMemo)(()=>{let e=new Set;return t.forEach(t=>{t.eventType&&"string"==typeof t.eventType&&""!==t.eventType.trim()&&e.add(t.eventType.trim())}),Array.from(e).sort()},[t]),w=(0,r.useMemo)(()=>{let e,a=t,s=new Date,r=(0,eR.D)(s);return"day"===n?e=(0,ex.o)(s):"week"===n?(e=(0,eE.k)(s,{weekStartsOn:1}),r=(0,eL.$)(s,{weekStartsOn:1})):"last7"===n?e=(0,ex.o)((0,to.e)(s,6)):"last30"===n?e=(0,ex.o)((0,to.e)(s,29)):"month"===n?(e=(0,eS.w)(s),r=(0,eI.p)(s)):"year"===n?(e=(0,td.D)(s),r=(0,tc.Q)(s)):"custom"===n&&(null==o?void 0:o.from)?(e=(0,ex.o)(o.from),r=o.to?(0,eR.D)(o.to):(0,eR.D)(o.from)):"all"===n&&(e=void 0,r=void 0),e&&r&&(a=a.filter(t=>{try{let a=(0,eh.H)(t.date);if(isNaN(a.getTime()))return!1;return(0,ep.v)(a,{start:e,end:r})}catch(e){return console.error("Error parsing event date or checking interval:",t.date,e),!1}})),"all"!==m&&(a=a.filter(e=>e.advisorId===m)),"all"!==h&&(a=a.filter(e=>e.eventType===h)),a.sort((e,t)=>(0,eh.H)(t.date).getTime()-(0,eh.H)(e.date).getTime())},[t,n,o,m,h]),C="week"!==n||"all"!==m||"all"!==h,k=(0,r.useMemo)(()=>{let e=tP(n),t="custom"===n?tE(o):e,a="all"===m?"All Advisors":b[m]||"Unknown",s="all"===h?"All Event Types":h;return"Filters Active: Date: ".concat(t," | Advisor: ").concat(a," | Event Type: ").concat(s)},[n,o,m,h,b]),T=async e=>{if(!p&&0!==w.length){f(!0);try{let t={totalTimeLogged:w.reduce((e,t)=>e+t.loggedTime,0),averageTimePerEvent:0,mostCommonEventType:"",totalEvents:w.length,timeByEventType:{},timeByAdvisor:{}},a={};switch(w.forEach(e=>{t.timeByEventType[e.eventType]||(t.timeByEventType[e.eventType]=0),t.timeByEventType[e.eventType]+=e.loggedTime,t.timeByAdvisor[e.advisorId]||(t.timeByAdvisor[e.advisorId]=0),t.timeByAdvisor[e.advisorId]+=e.loggedTime,a[e.eventType]=(a[e.eventType]||0)+1}),t.averageTimePerEvent=t.totalTimeLogged/t.totalEvents,t.mostCommonEventType=Object.entries(a).sort((e,t)=>{let[,a]=e,[,s]=t;return s-a})[0][0],e){case"csv":!function(e,t){let a=e.map(e=>({Date:(0,eu.GP)((0,eh.H)(e.date),"yyyy-MM-dd"),Advisor:b[e.advisorId]||"Unknown",EventType:e.eventType||"N/A",LoggedTimeMinutes:e.loggedTime,Notes:e.eventDetails||""})),s=new Blob([tu().unparse(a,{header:!0})],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(s),r.setAttribute("download","report_export_".concat(Date.now(),".csv")),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href)}(w,0);break;case"json":!function(e,t){let a=new Blob([JSON.stringify({summary:t,events:e},null,2)],{type:"application/json"}),s=document.createElement("a");s.href=URL.createObjectURL(a),s.setAttribute("download","report_export_".concat(Date.now(),".json")),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(s.href)}(w,t)}}catch(e){console.error("Error generating export:",e),(0,F.oR)({title:"Export Error",description:"Failed to generate export. Please try again.",variant:"destructive"})}finally{f(!1)}}},A=(0,r.useMemo)(()=>{var e;let t=w.reduce((e,t)=>e+t.loggedTime,0),a=w.length,s={},r={},l={};return w.forEach(e=>{s[e.eventType]=(s[e.eventType]||0)+1,r[e.eventType]=(r[e.eventType]||0)+e.loggedTime,l[e.advisorId]=(l[e.advisorId]||0)+e.loggedTime}),{totalTimeLogged:t,averageTimePerEvent:a>0?t/a:0,mostCommonEventType:(null===(e=Object.entries(s).sort((e,t)=>{let[,a]=e,[,s]=t;return s-a})[0])||void 0===e?void 0:e[0])||"N/A",totalEvents:a,timeByEventType:r,timeByAdvisor:l}},[w]),{resolvedTheme:D}=(0,v.D)(),E=Object.keys(A.timeByEventType),R=Object.values(A.timeByEventType),I=E.map((e,t)=>tR(t)),O=Object.keys(A.timeByAdvisor).map(e=>b[e]||e),M=Object.values(A.timeByAdvisor),U=O.map((e,t)=>tR(t)),_=(()=>{let e={};w.forEach(t=>{let a=(0,eu.GP)((0,eh.H)(t.date),"yyyy-MM-dd");e[a]=(e[a]||0)+t.loggedTime});let t=Object.entries(e).sort((e,t)=>e[0].localeCompare(t[0]));return{labels:t.map(e=>{let[t]=e;return t}),data:t.map(e=>{let[t,a]=e;return a})}})(),B="dark"===D?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)",Y={responsive:!0,plugins:{legend:{display:!1},datalabels:{color:B,anchor:"end",align:"end",font:{weight:"bold",size:12},formatter:e=>e>0?tT(e):null,offset:4,padding:0}},scales:{x:{ticks:{color:B},grid:{color:"dark"===D?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}},y:{ticks:{color:B},grid:{color:"dark"===D?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}}}},z={responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0}},scales:{x:{ticks:{color:B},grid:{color:"dark"===D?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}},y:{ticks:{color:B},grid:{color:"dark"===D?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}}}},V=async()=>{j(!0);try{let e=document.getElementById("report-charts-section");if(!e)throw Error("Could not find chart section");let t=(await tx()(e,{backgroundColor:null,scale:2})).toDataURL("image/png"),a=document.createElement("a");a.href=t,a.download="advisor_report_charts.png",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(e){(0,F.oR)({title:"Export failed",description:"Could not generate PNG. Please try again.",variant:"destructive"})}finally{j(!1)}};return(0,s.jsxs)(P.Zp,{className:"w-full shadow-lg",children:[(0,s.jsxs)(P.aR,{className:"pb-4",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4",children:[(0,s.jsx)(P.ZB,{className:"text-xl font-semibold text-primary mb-2 sm:mb-0",children:"Report Data"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 self-end sm:self-center",children:[(0,s.jsxs)(g.$,{variant:"ghost",size:"sm",onClick:()=>{i("week"),c(void 0),u("all"),x("all")},disabled:!C||p,"aria-label":"Clear Filters",className:(0,d.cn)(!C&&"text-muted-foreground"),children:[(0,s.jsx)(tv.A,{className:"mr-2 h-4 w-4"})," Clear"]}),(0,s.jsxs)(ed.l6,{onValueChange:e=>T(e),children:[(0,s.jsx)(ed.bq,{children:(0,s.jsx)(ed.yv,{placeholder:"Export Format"})}),(0,s.jsxs)(ed.gC,{children:[(0,s.jsx)(ed.eb,{value:"csv",children:"CSV"}),(0,s.jsx)(ed.eb,{value:"json",children:"JSON"})]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Date Range"}),(0,s.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:tD.map(e=>(0,s.jsx)(g.$,{variant:n===e.value?"secondary":"outline",size:"sm",onClick:()=>i(e.value),className:(0,d.cn)("h-8","custom"===n&&"custom"===e.value&&"ring-2 ring-primary"),children:e.label},e.value))}),"custom"===n&&(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)(eG,{date:o,onDateChange:c})})]}),(0,s.jsx)("div",{className:"flex flex-col md:flex-row md:items-end gap-3",children:(0,s.jsxs)("div",{className:"flex-grow flex flex-col sm:flex-row gap-3",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-[160px]",children:[(0,s.jsx)("label",{htmlFor:"report-event-type-filter",className:"text-sm font-medium block mb-1.5",children:"Event Type"}),(0,s.jsxs)(ed.l6,{onValueChange:x,value:h,children:[(0,s.jsx)(ed.bq,{id:"report-event-type-filter",className:"w-full",children:(0,s.jsx)(ed.yv,{placeholder:"Filter by Event Type"})}),(0,s.jsxs)(ed.gC,{children:[(0,s.jsx)(ed.eb,{value:"all",children:"All Event Types"}),N.map(e=>(0,s.jsx)(ed.eb,{value:e,children:e},e))]})]})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-[160px]",children:[(0,s.jsx)("label",{htmlFor:"report-advisor-filter",className:"text-sm font-medium block mb-1.5",children:"Advisor"}),(0,s.jsxs)(ed.l6,{onValueChange:u,value:m,children:[(0,s.jsx)(ed.bq,{id:"report-advisor-filter",className:"w-full",children:(0,s.jsx)(ed.yv,{placeholder:"Filter by Advisor"})}),(0,s.jsxs)(ed.gC,{children:[(0,s.jsx)(ed.eb,{value:"all",children:"All Advisors"}),a.map(e=>(0,s.jsx)(ed.eb,{value:e.id,children:e.name},e.id)),"\\"]})]})]})]})})]}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground pt-3 mt-4 border-t border-dashed",children:[k," - ",w.length," entries found."]})]}),(0,s.jsxs)(P.Wu,{className:"pt-4",children:[(0,s.jsx)("div",{className:"flex items-center gap-4 mb-6",children:(0,s.jsxs)(g.$,{onClick:V,disabled:y,variant:"outline",children:[y?(0,s.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(tg.A,{className:"mr-2 h-4 w-4"})," Export Charts as PNG"]})}),(0,s.jsxs)("div",{id:"report-charts-section",className:"mb-8",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Visualizations"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-card rounded-lg p-4 shadow-sm border",children:[(0,s.jsx)("h3",{className:"font-medium mb-2",children:"Time by Event Type (Bar)"}),(0,s.jsx)(ty.yP,{data:{labels:E,datasets:[{label:"Minutes",data:R,backgroundColor:I}]},options:Y,plugins:[tN.A]})]}),(0,s.jsxs)("div",{className:"bg-card rounded-lg p-4 shadow-sm border",children:[(0,s.jsx)("h3",{className:"font-medium mb-2",children:"Time by Advisor (Bar)"}),(0,s.jsx)(ty.yP,{data:{labels:O,datasets:[{label:"Minutes",data:M,backgroundColor:U}]},options:Y,plugins:[tN.A]})]}),(0,s.jsxs)("div",{className:"bg-card rounded-lg p-4 shadow-sm border",children:[(0,s.jsx)("h3",{className:"font-medium mb-2",children:"Event Type Share (Pie)"}),(0,s.jsx)(ty.nu,{data:{labels:E,datasets:[{data:R,backgroundColor:I}]},options:{responsive:!0,plugins:{legend:{position:"top",labels:{color:B}},tooltip:{enabled:!0}}}})]}),(0,s.jsxs)("div",{className:"bg-card rounded-lg p-4 shadow-sm border",children:[(0,s.jsx)("h3",{className:"font-medium mb-2",children:"Time Trend (Line)"}),(0,s.jsx)(ty.N1,{data:{labels:_.labels,datasets:[{label:"Minutes",data:_.data,borderColor:"#3b82f6",backgroundColor:"rgba(59,130,246,0.2)",fill:!0}]},options:z})]})]})]}),(0,s.jsx)("div",{id:"report-summary-section",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,s.jsxs)(P.Zp,{className:"bg-card border shadow-sm",children:[(0,s.jsxs)(P.aR,{className:"flex flex-row items-center gap-2 pb-2",children:[(0,s.jsx)("span",{className:"text-primary",children:(0,s.jsxs)("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,s.jsx)(P.ZB,{className:"text-sm font-medium",children:"Total Time Logged"})]}),(0,s.jsx)(P.Wu,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:tT(A.totalTimeLogged)})})]}),(0,s.jsxs)(P.Zp,{className:"bg-card border shadow-sm",children:[(0,s.jsxs)(P.aR,{className:"flex flex-row items-center gap-2 pb-2",children:[(0,s.jsx)("span",{className:"text-primary",children:(0,s.jsxs)("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M8 12h8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)(P.ZB,{className:"text-sm font-medium",children:"Average Time Per Event"})]}),(0,s.jsx)(P.Wu,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:tT(A.averageTimePerEvent)})})]}),(0,s.jsxs)(P.Zp,{className:"bg-card border shadow-sm",children:[(0,s.jsxs)(P.aR,{className:"flex flex-row items-center gap-2 pb-2",children:[(0,s.jsx)("span",{className:"text-primary",children:(0,s.jsxs)("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M9 12l2 2 4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,s.jsx)(P.ZB,{className:"text-sm font-medium",children:"Most Common Event Type"})]}),(0,s.jsx)(P.Wu,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:A.mostCommonEventType})})]}),(0,s.jsxs)(P.Zp,{className:"bg-card border shadow-sm",children:[(0,s.jsxs)(P.aR,{className:"flex flex-row items-center gap-2 pb-2",children:[(0,s.jsx)("span",{className:"text-primary",children:(0,s.jsxs)("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M12 8v8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)(P.ZB,{className:"text-sm font-medium",children:"Total Events"})]}),(0,s.jsx)(P.Wu,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:A.totalEvents})})]})]})}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"text-md font-semibold mb-2",children:"Event Type Breakdown"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:Object.entries(A.timeByEventType).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"px-3 py-1 rounded-full text-xs font-semibold",style:{background:"#f3f4f6",border:"1px solid #e5e7eb"},children:[t,": ",tT(a)]},t)})})]}),(0,s.jsx)(S,{className:"h-[400px] md:h-[500px] border rounded-md",children:(0,s.jsxs)(ev,{children:[(0,s.jsx)(eg,{className:"sticky top-0 bg-background z-10",children:(0,s.jsxs)(ej,{children:[(0,s.jsx)(eb,{className:"w-[100px]",children:"Date"}),(0,s.jsx)(eb,{children:"Advisor"}),(0,s.jsx)(eb,{children:"Event Type"}),(0,s.jsx)(eb,{className:"text-right w-[120px]",children:"Time (mins)"}),(0,s.jsx)(eb,{children:"Notes"})]})}),(0,s.jsx)(ey,{children:w.length>0?w.map(e=>(0,s.jsxs)(ej,{children:[(0,s.jsx)(eN,{className:"font-medium",children:(0,eu.GP)((0,eh.H)(e.date),"dd MMM yyyy")}),(0,s.jsx)(eN,{children:b[e.advisorId]||"Unknown Advisor"}),(0,s.jsx)(eN,{children:e.eventType||"N/A"}),(0,s.jsx)(eN,{className:"text-right",children:e.loggedTime}),(0,s.jsx)(eN,{className:"text-sm text-muted-foreground truncate max-w-[200px] md:max-w-[300px]",children:e.eventDetails})]},e.id)):(0,s.jsx)(ej,{children:(0,s.jsx)(eN,{colSpan:5,className:"h-24 text-center",children:"No report data available for the selected filters."})})})]})}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground pt-2 text-right",children:["Total Logged Time: ",w.reduce((e,t)=>e+t.loggedTime,0)," minutes"]})]})]})}tj.t1.register(tj.PP,tj.kc,tj.E8,tj.hE,tj.m_,tj.s$,tj.Bs,tj.FN,tj.No,tj.dN,tN.A);var tI=a(5365),tO=a(5300),tM=a(1133),tF=a(8376),tU=a(9114),t_=a(8449),tB=a(763);function tY(e){if(!e)return null;let t=e.split(" ")[0].split("/");if(3===t.length){let a=parseInt(t[0],10),s=parseInt(t[1],10),r=parseInt(t[2],10);if(!isNaN(a)&&!isNaN(s)&&!isNaN(r)&&s>=1&&s<=12&&a>=1&&a<=31&&r>=1900&&r<=2100)try{let t=new Date(Date.UTC(r,s-1,a));if(t.getUTCFullYear()===r&&t.getUTCMonth()===s-1&&t.getUTCDate()===a)return t;return console.warn("Invalid date components created invalid Date object:",e),null}catch(t){return console.error("Error parsing date:",e,t),null}else console.warn("Parsed date components seem invalid:",{day:a,month:s,year:r},"from",e)}return console.warn("Could not parse date string:",e),null}function tz(e){let{policyData:t,setPolicyData:a,fileName:l,setFileName:n,isLoading:i,setIsLoading:o,parseError:d,setParseError:c}=e,[m,u]=(0,r.useState)(""),[h,x]=(0,r.useState)(null),p="Policy Number",f="Policy Status",v="Due Date of 1st Arrear",y="Due Date of 2nd Arrear",j="Due Date of 3rd Arrear",b="Cancellation Reason",N="Current Gross Premium Per Frequency",w="Max. Next Premium Collection Date",C="Number Of Paid Premiums",k=(0,r.useCallback)(e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&(o(!0),c(null),a(new Map),x(null),n(s.name),tu().parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{let t=new Map;if(e.errors.length>0){console.error("CSV Parsing Errors:",e.errors),c("Error parsing CSV: ".concat(e.errors[0].message," on row ").concat(e.errors[0].row)),o(!1),n(null);return}if(!e.data||0===e.data.length){c("CSV file is empty or has no data rows."),o(!1),n(null);return}let s=[p,f,v,y,j],r=Object.keys(e.data[0]||{}),l=s.filter(e=>!r.includes(e));if(l.length>0){let e="'".concat(s.join("', '"),"'"),t="'".concat(b,"', '").concat(N,"', '").concat(w,"', '").concat(C,"'");c("Missing required columns in CSV: ".concat(l.join(", "),". Expected: ").concat(e,". Optional: ").concat(t,".")),o(!1),n(null);return}let i=r.includes(b),d=r.includes(N),m=r.includes(w),u=r.includes(C);e.data.forEach(e=>{var a,s,r,l,n;let o=null===(a=e[p])||void 0===a?void 0:a.trim();if(o){let a,c,h,x,p;let g=[null===(s=e[v])||void 0===s?void 0:s.trim(),null===(r=e[y])||void 0===r?void 0:r.trim(),null===(l=e[j])||void 0===l?void 0:l.trim()].filter(e=>!!e&&""!==e.trim()),k=(null===(n=e[f])||void 0===n?void 0:n.trim())||"UNKNOWN";if(i){let t=e[b];if("string"==typeof t){let e=t.trim();e.length>0&&(a=e)}}if(d){let t=e[N];if("string"==typeof t||"number"==typeof t){let e=String(t).trim();e.length>0&&(c=e)}}if(m){let t=e[w];if("string"==typeof t){let e=t.trim();e.length>0&&(h=e.split(" ")[0])}}if(u){let t=e[C];if("string"==typeof t||"number"==typeof t){let e=String(t).trim();e.length>0&&(x=e)}}let T=k.toUpperCase();if(("ON_RISK"===T||"ON RISK"===T)&&3===g.length){let e=function(e){if(!e)return null;let t=e.split(" ")[0].split("/");if(3===t.length){let a=parseInt(t[0],10),s=parseInt(t[1],10),r=parseInt(t[2],10);if(!isNaN(a)&&!isNaN(s)&&!isNaN(r)&&s>=1&&s<=12&&a>=1&&a<=31){if(r<1900||r>2100)return console.warn("Unlikely year encountered during date parsing:",r),null;try{let t=new Date(r,s-1,a);if(t.getFullYear()!==r||t.getMonth()!==s-1||t.getDate()!==a)return console.warn("Invalid date components:",e),null;return t.setDate(t.getDate()+30),t.toLocaleDateString("en-GB")}catch(t){return console.error("Error calculating cancellation date for:",e,t),null}}else console.warn("Parsed date components seem invalid:",{day:a,month:s,year:r},"from",e)}return console.warn("Could not parse date for cancellation calculation:",e),null}(g[2]);e&&(p=e)}t.set(o,{policyNumber:o,status:k,missedPayments:g,cancellationReason:a,potentialCancellationDate:p,currentGrossPremiumPerFrequency:c,maxNextPremiumCollectionDate:h,numberOfPaidPremiums:x})}}),a(t),o(!1)},error:e=>{console.error("CSV Parsing Failed:",e),c("Failed to parse CSV: ".concat(e.message)),o(!1),n(null)}}))},[a,n,o,c]),T=(0,r.useCallback)(()=>{if(!m){x(null);return}x(t.get(m.trim())||"not_found")},[m,t]),A=e=>["LAPSED","TEMPORARILY_LAPSED","PERMANENTLY_LAPSED"].includes(e.toUpperCase());return(0,s.jsxs)(P.Zp,{children:[(0,s.jsxs)(P.aR,{children:[(0,s.jsxs)(P.ZB,{className:"flex items-center",children:[(0,s.jsx)(tO.A,{className:"mr-2 h-5 w-5"})," Policy Search"]}),(0,s.jsx)(P.BT,{children:"Upload a daily CSV policy sheet and search by policy number."})]}),(0,s.jsxs)(P.Wu,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"policy-csv-upload",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Upload most recent dashboard"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(D,{id:"policy-csv-upload",type:"file",accept:".csv",onChange:k,disabled:i,className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/90 cursor-pointer"}),i&&(0,s.jsx)(L.A,{className:"h-5 w-5 animate-spin"})]}),l&&!i&&!d&&(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[" Loaded: ",l," (",t.size," policies)"]}),d&&(0,s.jsxs)(tI.Fc,{variant:"destructive",className:"mt-2",children:[(0,s.jsx)(tM.A,{className:"h-4 w-4"}),(0,s.jsx)(tI.XL,{children:"Upload Error"}),(0,s.jsx)(tI.TN,{children:d})]})]}),t.size>0&&!i&&!d&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"policy-search-input",className:"text-sm font-medium",children:"Search Policy Number"}),(0,s.jsxs)("div",{className:"flex w-full max-w-sm items-center space-x-2",children:[(0,s.jsx)(D,{id:"policy-search-input",type:"text",placeholder:"Enter policy number...",value:m,onChange:e=>u(e.target.value),onKeyDown:e=>"Enter"===e.key&&T()}),(0,s.jsxs)(g.$,{type:"button",onClick:T,children:[(0,s.jsx)(ew.A,{className:"mr-2 h-4 w-4"})," Search"]})]})]}),h&&(0,s.jsxs)("div",{className:"pt-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Search Result"}),"not_found"===h?(0,s.jsxs)("p",{className:"text-muted-foreground",children:['Policy number "',m,'" not found in the uploaded data.']}):(0,s.jsx)(P.Zp,{className:"bg-secondary/50",children:(0,s.jsxs)(P.Wu,{className:"p-4 space-y-2",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Policy Number:"})," ",h.policyNumber]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Status:"})," ",(0,s.jsx)("span",{className:"font-semibold ".concat((e=>{let t=e.toUpperCase();return"ON_RISK"===t||"ON RISK"===t?"text-green-600":A(e)||"CANCELLED"===t?"text-red-600":"text-muted-foreground"})(h.status)),children:h.status.replace(/_/g," ").toUpperCase()})]}),function(e){if(!(e.missedPayments.length>0&&e.missedPayments.length<3))return!1;let t=e.missedPayments[e.missedPayments.length-1],a=tY(t);if(!a)return console.warn("Could not parse lastMissedPaymentDate for 'cleared' check:",t),!1;let s=new Date(a);if(s.setUTCMonth(s.getUTCMonth()+1),!e.maxNextPremiumCollectionDate)return!1;let r=tY(e.maxNextPremiumCollectionDate);if(!r)return console.warn("Could not parse maxNextPremiumCollectionDate for 'cleared' check:",e.maxNextPremiumCollectionDate),!1;if(r.getTime()<=s.getTime())return!1;let l=new Date;return Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate())>=s.getTime()+432e6}(h)&&(0,s.jsxs)("p",{className:"flex items-center text-green-600 font-semibold",children:[(0,s.jsx)(tF.A,{className:"mr-2 h-4 w-4"})," Next payment cleared"]}),h.currentGrossPremiumPerFrequency&&(0,s.jsxs)("p",{className:"flex items-center",children:[(0,s.jsx)(tU.A,{className:"mr-2 h-4 w-4 text-blue-600"}),(0,s.jsx)("strong",{children:"Monthly Premium:"}),(0,s.jsxs)("span",{className:"ml-1 font-semibold text-blue-700",children:["\xa3",h.currentGrossPremiumPerFrequency]})]}),void 0!==h.numberOfPaidPremiums&&null!==h.numberOfPaidPremiums&&""!==h.numberOfPaidPremiums.trim()&&(0,s.jsxs)("p",{className:"flex items-center",children:[(0,s.jsx)(t_.A,{className:"mr-2 h-4 w-4 text-indigo-600"}),(0,s.jsx)("strong",{children:"Payments Made:"}),(0,s.jsx)("span",{className:"ml-1",children:h.numberOfPaidPremiums})]}),!(A(h.status)||"CANCELLED"===h.status.toUpperCase())&&h.maxNextPremiumCollectionDate&&(0,s.jsxs)("p",{className:"flex items-center",children:[(0,s.jsx)(tB.A,{className:"mr-2 h-4 w-4 text-gray-600"}),(0,s.jsx)("strong",{children:"Next Premium Collection:"}),(0,s.jsx)("span",{className:"ml-1",children:h.maxNextPremiumCollectionDate})]}),(A(h.status)||"CANCELLED"===h.status.toUpperCase())&&h.cancellationReason&&(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Reason:"})," ",(0,s.jsx)("span",{className:"text-muted-foreground",children:h.cancellationReason})]}),h.potentialCancellationDate&&(0,s.jsxs)("p",{className:"flex items-center",children:[(0,s.jsx)(tB.A,{className:"mr-2 h-4 w-4 text-orange-600"}),(0,s.jsx)("strong",{children:"Potential Cancellation Date:"}),(0,s.jsx)("span",{className:"ml-1 text-orange-600 font-semibold",children:h.potentialCancellationDate})]}),(0,s.jsx)("p",{children:(0,s.jsxs)("strong",{children:["Missed Payments (",h.missedPayments.length,"):"]})}),h.missedPayments.length>0?(0,s.jsx)("ul",{className:"list-disc list-inside text-muted-foreground pl-4",children:h.missedPayments.map((e,t)=>(0,s.jsx)("li",{children:e},t))}):(0,s.jsx)("p",{className:"text-muted-foreground italic",children:"No missed payments recorded."})]})})]})]})]})}var tV=a(8214),tG=a(7326),tW=a(3875),tZ=a(5599),t$=a(594),tq=a(3478);let tH=tq.bL,tJ=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(tq.q7,{ref:t,className:(0,d.cn)("border-b",a),...r})});tJ.displayName="AccordionItem";let tK=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsx)(tq.Y9,{className:"flex",children:(0,s.jsxs)(tq.l9,{ref:t,className:(0,d.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",a),...l,children:[r,(0,s.jsx)(eD.A,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});tK.displayName=tq.l9.displayName;let tX=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsx)(tq.UC,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...l,children:(0,s.jsx)("div",{className:(0,d.cn)("pb-4 pt-0",a),children:r})})});tX.displayName=tq.UC.displayName;let tQ="Policy Number",t0="Policy Status",t2="Current Gross Premium Per Frequency",t1="Max. Next Premium Collection Date",t4="Starting Date",t5=["Distribution Partner","Product Name","Sales Channel","Broker ID","Sold Date","Exit Date","Cancellation Type","Policy Type","LOAP Consent","Premium Escalation Type","Benefit Escalation Type","Current Sum Sumassured","Current Gross Premium Annualized","Premium Frequency","Blank","Number Of Paid Premiums","Number Of Unpaid Premiums","Value Of Premiums Collected"];function t3(e){if(!e)return null;let t=e.split(" ")[0].split("/");if(3===t.length){let a=parseInt(t[0],10),s=parseInt(t[1],10),r=parseInt(t[2],10);if(!isNaN(a)&&!isNaN(s)&&!isNaN(r)&&s>=1&&s<=12&&a>=1&&a<=31&&r>=1900&&r<=2100)try{let t=new Date(Date.UTC(r,s-1,a));if(t.getUTCFullYear()===r&&t.getUTCMonth()===s-1&&t.getUTCDate()===a)return t;return console.warn("Invalid date components created invalid Date object:",e),null}catch(t){return console.error("Error parsing date:",e,t),null}else console.warn("Parsed date components seem invalid:",{day:a,month:s,year:r},"from",e)}return console.warn("Could not parse date string:",e),null}function t6(e){let t=e.match(/\d+$/);return t?parseInt(t[0],10):0}let t9=()=>{let{toast:e}=(0,F.dj)(),[t,a]=(0,r.useState)(null),[l,n]=(0,r.useState)(null),[i,o]=(0,r.useState)([]),[d,c]=(0,r.useState)(!1),[m,u]=(0,r.useState)([]),h=(0,r.useRef)(null),x=(0,r.useRef)(null),p=(0,r.useCallback)(async t=>{if(!navigator.clipboard){e({title:"Clipboard API Not Available",description:"Copying to clipboard is not supported or not allowed in this browser/context.",variant:"destructive"});return}try{await navigator.clipboard.writeText(t),e({title:"Copied!",description:"Policy number copied to clipboard."})}catch(a){console.error("Failed to copy text: ",a);let t="Could not copy policy number. Check browser console for details.";a instanceof DOMException&&"NotAllowedError"===a.name&&(t="Clipboard access was denied. This may be due to browser permissions or security settings in this environment."),e({title:"Copy Failed",description:t,variant:"destructive"})}},[e]),f=(0,r.useCallback)(()=>{a(null),n(null),o([]),u([]),h.current&&(h.current.value=""),x.current&&(x.current.value=""),e({title:"Inputs Cleared",description:"File inputs and results have been cleared."})},[e]),v=(0,r.useCallback)(t=>{var s;let r=null===(s=t.target.files)||void 0===s?void 0:s[0];r&&("text/csv"===r.type||r.name.endsWith(".csv")?(a(r),o([])):(e({title:"Invalid File Type",description:"Please upload a CSV file for the daily dashboard.",variant:"destructive"}),t.target.value=""))},[e]),y=(0,r.useCallback)(t=>{var a;let s=null===(a=t.target.files)||void 0===a?void 0:a[0];s&&("text/csv"===s.type||s.name.endsWith(".csv")||"text/plain"===s.type||s.name.endsWith(".txt")?(n(s),o([])):(e({title:"Invalid File Type",description:"Please upload a CSV or TXT file for the cleared batch.",variant:"destructive"}),t.target.value=""))},[e]),j=(0,r.useCallback)(async()=>{if(!t||!l){e({title:"Files Missing",description:"Please upload both the daily dashboard and cleared batch files.",variant:"destructive"});return}c(!0),o([]),u([]);try{let a=await t.text(),s=await l.text(),r=new Set;if(l.name.endsWith(".csv")?tu().parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{var t;let a=null===(t=e.meta.fields)||void 0===t?void 0:t[0];e.data.forEach(e=>{let t=e[tQ]||(a?e[a]:null);t&&String(t).trim()&&r.add(String(t).trim())})}}):r=new Set(s.split(/\r?\n/).map(e=>e.trim()).filter(e=>e&&e.length>0)),0===r.size){e({title:"No Policies in Batch",description:"The cleared batch file is empty or contains no policy numbers.",variant:"destructive"}),c(!1);return}tu().parse(a,{header:!0,skipEmptyLines:!0,complete:t=>{let a=t.meta.fields||[];u(a);let s=[];t.data.forEach(e=>{var t,l,n,i,o,d,c,m,u,h,x;let p=null===(t=e[tQ])||void 0===t?void 0:t.trim();if(p&&r.has(p)){let t={policyNumber:p,status:(null===(l=e[t0])||void 0===l?void 0:l.trim())||"UNKNOWN",missedPayments:[null===(n=e["Due Date of 1st Arrear"])||void 0===n?void 0:n.trim(),null===(i=e["Due Date of 2nd Arrear"])||void 0===i?void 0:i.trim(),null===(o=e["Due Date of 3rd Arrear"])||void 0===o?void 0:o.trim()].filter(e=>!!e&&""!==e.trim()),cancellationReason:null===(d=e["Cancellation Reason"])||void 0===d?void 0:d.trim(),currentGrossPremiumPerFrequency:null===(c=e[t2])||void 0===c?void 0:c.trim(),maxNextPremiumCollectionDate:null===(u=e[t1])||void 0===u?void 0:null===(m=u.trim())||void 0===m?void 0:m.split(" ")[0],startingDate:null===(x=e[t4])||void 0===x?void 0:null===(h=x.trim())||void 0===h?void 0:h.split(" ")[0]};a.forEach(a=>{t.hasOwnProperty(a)||void 0===e[a]||(t[a]=String(e[a]))}),function(e){if(["LAPSED","TEMPORARILY_LAPSED","PERMANENTLY_LAPSED"].includes(e.status.toUpperCase())||!(e.missedPayments.length>0&&e.missedPayments.length<3))return!1;let t=e.missedPayments[e.missedPayments.length-1],a=t3(t);if(!a)return console.warn("Could not parse lastMissedPaymentDate for 'cleared' check:",t),!1;let s=new Date(a);if(s.setUTCMonth(s.getUTCMonth()+1),!e.maxNextPremiumCollectionDate)return!1;let r=t3(e.maxNextPremiumCollectionDate);if(!r)return console.warn("Could not parse maxNextPremiumCollectionDate for 'cleared' check:",e.maxNextPremiumCollectionDate),!1;if(r.getTime()<=s.getTime())return!1;let l=new Date;return Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate())>=s.getTime()+432e6}(t)&&s.push(t)}}),s.sort((e,t)=>{let a=t6(e.policyNumber),s=t6(t.policyNumber);return a-s}),o(s),s.length>0?e({title:"Processing Complete",description:"".concat(s.length," matching and cleared policies found.")}):e({title:"No Matches Found",description:"No policies from the dashboard matched the cleared batch OR met the 'next payment cleared' criteria.",variant:"default"})},transformHeader:e=>e.trim(),onError:t=>{console.error("Error parsing dashboard CSV:",t),e({title:"Parsing Error",description:"Failed to parse dashboard CSV: ".concat(t.message),variant:"destructive"})}})}catch(t){console.error("Error processing files:",t),e({title:"Processing Error",description:"An unexpected error occurred while processing the files.",variant:"destructive"})}finally{c(!1)}},[t,l,e]),b=(e,t)=>{let a="Next Cleared Batch Report\n";return a+="=====================================\n\n",e.forEach((e,s)=>{a+="Policy #".concat(s+1,"\n"),a+="-------------------------------------\n",t.filter(e=>!t5.includes(e)).forEach(t=>{if("missedPayments"===t)a+="Missed Payments: ".concat(e.missedPayments.length>0?e.missedPayments.join(", "):"None","\n");else{var s;let r=null!==(s=e[t])&&void 0!==s?s:"N/A";a+="".concat(t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()),": ").concat(r,"\n")}}),a+="\n"}),a},N=(0,r.useCallback)(t=>{let a,s,r;if(0===i.length){e({title:"No Data",description:"There is no data to download.",variant:"destructive"});return}let l=m.length>0?m:i.length>0?Object.keys(i[0]):[],n=[tQ,t0,"missedPayments",t1,t2,t4].filter(e=>!t5.includes(e));switch(t){case"txt":a=b(i,n),s="text/plain;charset=utf-8;",r="next_cleared_batch_report.txt";break;case"pdf":case"csv":a=tu().unparse({fields:l,data:i.map(e=>l.map(t=>{let a=e[t];return Array.isArray(a)?a.join("; "):null!=a?a:""}))}),s="text/csv;charset=utf-8;",r="pdf"===t?"next_cleared_batch_report_for_sheets.csv":"next_cleared_batch_data.csv";break;default:e({title:"Error",description:"Invalid download format selected.",variant:"destructive"});return}let o=new Blob([a],{type:s}),d=document.createElement("a");d.href=URL.createObjectURL(o),d.setAttribute("download",r),document.body.appendChild(d),d.click(),document.body.removeChild(d),e({title:"Download Started",description:"The results file (".concat(r,") is being downloaded.")})},[i,m,e]),w=[t0,"missedPayments",t1,t4].filter(e=>!t5.includes(e));return(0,s.jsxs)(P.Zp,{className:"w-full max-w-2xl mx-auto",children:[(0,s.jsxs)(P.aR,{children:[(0,s.jsx)(P.ZB,{children:"Next Cleared Batch Processing"}),(0,s.jsx)(P.BT,{children:"Upload the daily dashboard CSV and the cleared batch file (CSV or TXT) to find policies that have their next payment cleared. Results are sorted by policy number."})]}),(0,s.jsxs)(P.Wu,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"dashboard-file-next-cleared",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Daily Dashboard File (CSV)"}),(0,s.jsx)(D,{ref:h,id:"dashboard-file-next-cleared",type:"file",accept:".csv",onChange:v,className:"mt-1"}),t&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Selected: ",t.name]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"cleared-batch-file-next-cleared",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Cleared Batch File (CSV or TXT with policy numbers)"}),(0,s.jsx)(D,{ref:x,id:"cleared-batch-file-next-cleared",type:"file",accept:".csv,.txt",onChange:y,className:"mt-1"}),l&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Selected: ",l.name]})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)(g.$,{onClick:j,disabled:d||!t||!l,className:"flex-grow",children:[d?(0,s.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(tV.A,{className:"mr-2 h-4 w-4"}),"Process Files"]}),(0,s.jsxs)(g.$,{onClick:f,variant:"outline",disabled:d&&!t&&!l&&0===i.length,children:[(0,s.jsx)(tG.A,{className:"mr-2 h-4 w-4"}),"Clear"]})]}),i.length>0&&(0,s.jsxs)("div",{className:"space-y-4 pt-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-medium",children:["Processed Results (",i.length," Matching & Cleared)"]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[(0,s.jsxs)(g.$,{onClick:()=>N("csv"),className:"w-full",variant:"outline",children:[(0,s.jsx)(tg.A,{className:"mr-2 h-4 w-4"}),"Download CSV"]}),(0,s.jsxs)(g.$,{onClick:()=>N("txt"),className:"w-full",variant:"outline",children:[(0,s.jsx)(tO.A,{className:"mr-2 h-4 w-4"}),"Download TXT"]}),(0,s.jsxs)(g.$,{onClick:()=>N("pdf"),className:"w-full",variant:"outline",children:[(0,s.jsx)(tW.A,{className:"mr-2 h-4 w-4"}),"CSV for Sheets"]})]}),(0,s.jsx)(tH,{type:"single",collapsible:!0,className:"w-full",children:i.map(e=>(0,s.jsxs)(tJ,{value:e.policyNumber,className:"border-b rounded-md mb-2",children:[(0,s.jsx)(tK,{className:"font-semibold hover:no-underline px-3 py-3 text-sm",children:(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsxs)("div",{className:"flex items-center min-w-0",children:[(0,s.jsx)(tF.A,{className:"mr-2 h-5 w-5 flex-shrink-0 text-green-600 dark:text-green-500"}),(0,s.jsx)("span",{className:"truncate",children:e.policyNumber}),e[t2]&&(0,s.jsxs)("span",{className:"ml-2 text-xs text-muted-foreground",children:["(\xa3",e[t2],")"]})]}),(0,s.jsx)(g.$,{variant:"ghost",size:"icon",className:"h-7 w-7 p-0 text-muted-foreground hover:text-foreground flex-shrink-0 ml-2",onClick:t=>{t.stopPropagation(),p(e.policyNumber)},"aria-label":"Copy policy number",children:(0,s.jsx)(tZ.A,{className:"h-4 w-4"})})]})}),(0,s.jsx)(tX,{className:"pt-2 pb-3 px-3 text-sm text-foreground",children:(0,s.jsx)("div",{className:"space-y-1 pl-2 border-l-2 border-muted dark:border-muted-foreground/30 ml-2",children:w.map(t=>{if("missedPayments"===t)return(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Missed Payments:"}),e.missedPayments.length>0?e.missedPayments.join(", "):"None"]},t);let a=t.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,e=>e.toUpperCase());return void 0!==e[t]&&null!==e[t]&&""!==String(e[t]).trim()?(0,s.jsxs)("p",{children:[(0,s.jsxs)("strong",{children:[a,":"]})," ",e[t]]},t):null})})})]},e.policyNumber))})]}),(0,s.jsx)("div",{className:"pt-4",children:(0,s.jsx)(tH,{type:"single",collapsible:!0,className:"w-full",children:(0,s.jsxs)(tJ,{value:"instructions",children:[(0,s.jsx)(tK,{children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(t$.A,{className:"mr-2 h-4 w-4"}),"How to use this feature"]})}),(0,s.jsx)(tX,{children:(0,s.jsxs)("div",{className:"space-y-2 text-sm text-muted-foreground",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Step 1:"})," Upload the Daily Dashboard as a .csv file in the first box."]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Step 2:"})," Filter your individual tracker (spreadsheet) to remove leads that are not back on risk, lapsed, TBL (To Be Lapsed), etc."]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Step 3:"})," In your filtered tracker, click on the top of the column containing policy numbers to select all policy numbers you are actively working. Copy this selection (Ctrl+C or Cmd+C)."]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Step 4:"})," Open a new spreadsheet (e.g., File > New > Spreadsheet in Google Sheets or Excel)."]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Step 5:"})," Paste (Ctrl+V or Cmd+V) all the active policy numbers into the first column of the newly created spreadsheet."]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Step 6:"}),' Export this new spreadsheet as a CSV file (e.g., File > Download > .csv). Name it something like "[Your Name] Policies to Check.csv".']}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Step 7:"})," Upload this newly created CSV file to the 'Cleared Batch File' input box on this page."]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Step 8:"}),' Press the "Process Files" button and wait a few seconds for the results.']}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Step 9:"})," You can then download the results as a TXT file (or CSV for Sheets). Save this file to your computer for easy access and work through the identified cases."]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"NOTE:"})," Always double-check the missed payments and other details to ensure you can actually work the lead and put it back on risk. The algorithm has high accuracy but may occasionally make mistakes."]})]})})]})})})]})]})},t8=[{insurer:"SOURCE HOME INSURANCE",contactInformation:"02920 105 400",autoRecollection:"",missedPaymentsToLapse:"",cancelOnBehalf:"",canReinstateDD:"",otherRetentionsInfo:"",emailPassword:"",bankDetails:""},{insurer:"Aegon (now Royal London)",contactInformation:"345 610 0037",autoRecollection:"Yes",missedPaymentsToLapse:"",cancelOnBehalf:"No",canReinstateDD:"Yes",otherRetentionsInfo:" NO PORTAL\n  Clearance - 7 working days\n 4+ missed payments = Declaration of Health required\n Customer can send bank transfer to make up payment\n Can set up double/triple collection on behalf of client\n 'Refer to payer' - currently attempting recollection. ",emailPassword:"UsL1PzrhI5-T",bankDetails:""},{insurer:"AIG Life",contactInformation:"345 600 6820",autoRecollection:"No",missedPaymentsToLapse:"3",cancelOnBehalf:"Yes - via portal",canReinstateDD:"Yes",otherRetentionsInfo:" PORTAL\n  Payment clearance - 4 working days\n Portal - can reattempt 3-5 day collection on portal, can set up double collection, can change bank details & payment dates & reinstate policy if less than 3 payments missed.\n AIG would have reattempted BEFORE sending notification to us",emailPassword:"",bankDetails:""},{insurer:"Aviva",contactInformation:"800 056 5499",autoRecollection:"Yes",missedPaymentsToLapse:"",cancelOnBehalf:"Yes - via portal",canReinstateDD:"Yes",otherRetentionsInfo:' PORTAL\n  Clearance - 5 working days\n Lapses after - 60 days of 1st missed DD\n Can cancel on portal/change bank details\n Can reinstate DD on portal\n "DD REJECTION" - currently recollecting. ',emailPassword:"",bankDetails:""},{insurer:"Canada Life",contactInformation:"3456060708",autoRecollection:"Yes",missedPaymentsToLapse:"",cancelOnBehalf:"No",canReinstateDD:"No",otherRetentionsInfo:' NO PORTAL\n  Clearance - 10 working days\n Lapses after - 60 days of 1st missed DD\n "1 missed payment" - currently recollecting.\n Customer can bank transfer arrears.\n Canada Life will attempt next month premium as normal even when 1 missed payment on the account - if this fails DD suspends.\n We cannot set up anything on behalf of client- they have to call to do this. ',emailPassword:"",bankDetails:""},{insurer:"Cignpost Life",contactInformation:"330 123 3747",autoRecollection:"No",missedPaymentsToLapse:"4",cancelOnBehalf:"Yes - Cancellation form to IPTIQ",canReinstateDD:"No",otherRetentionsInfo:" NO PORTAL\n  Clearance - 4 working days\n 4+ missed payments = Declaration of Health required & all arrears to be cleared.\n Can miss up to 2 payments\n iptiq_serviceops@swissre.com for any cancellations/adhoc recollection/payment link.",emailPassword:"",bankDetails:""},{insurer:"ESMI",contactInformation:"330 123 10 30",autoRecollection:"Yes",missedPaymentsToLapse:"3",cancelOnBehalf:"Yes - Email Isobel",canReinstateDD:"Yes",otherRetentionsInfo:' NO PORTAL\n  Clearance - 5 working days\n smith@getesmi.co.uk to check on payments/cancel policy/reinstate DD.\n Customer can send bank transfer to ESMI to make up arrears.\n  "0213  -  REFER TO PAYER" Automatic double collection when DD is active\n 3 missed payments - policy lapse',emailPassword:"",bankDetails:""},{insurer:"Guardian",contactInformation:"808 133 1821",autoRecollection:"Yes",missedPaymentsToLapse:"3",cancelOnBehalf:"No",canReinstateDD:"Yes",otherRetentionsInfo:" NO PORTAL\n  Clearance - 5 working days\n  Automatic double collection when DD is active & reattempt 7 days after missed premium.\n  We can reinstate DD for customer - can't do manual payments.\n 3 missed payments - policy lapse",emailPassword:"",bankDetails:""},{insurer:"HSBC",contactInformation:"333 207 5563",autoRecollection:"Yes",missedPaymentsToLapse:"",cancelOnBehalf:"Yes",canReinstateDD:"Yes",otherRetentionsInfo:" NO PORTAL\n  Check with HSBC before calling customer for the status of the policy\n Clearance - 7-10 working days\n Lapse 90 days after missed payment.\n Can reinstate DD and set up double collection or recollection. Can also cancel policy on behalf of customer.\n Sometimes recollecting when 'Policy in arrears' - call HSBC to check. They keep recollecting until DD suspends.\nCustomer can bank transfer arrears\n HSBC sometimes recollect premium which causes next month to skip - they will then take a premium as normal the month after if the DD is still active.  -  Can cancel on behalf ",emailPassword:"x=f=Alpha40",bankDetails:""},{insurer:"Legal & General",contactInformation:"370 010 4080",autoRecollection:"Yes",missedPaymentsToLapse:"3+",cancelOnBehalf:"No",canReinstateDD:"Yes",otherRetentionsInfo:" PORTAL\n  Clearance - 11 working days\n 3+ missed payments = Lapse\n Can reinstate DD and set up double on portal if you get clients bank details.\n Alternatively, customer can call to make up payment manually/set up a recollection.\n'Reinstatement not required' - L&G recollecting, no need to call. Wait for payment clearance. If it fails the DD auto-cancels.\n Can't cancel on behalf of client.",emailPassword:"Candidinsuranceservices1!",bankDetails:""},{insurer:"LV=",contactInformation:"800 678 1906",autoRecollection:"Yes",missedPaymentsToLapse:"3+",cancelOnBehalf:"No",canReinstateDD:"Yes",otherRetentionsInfo:' NO PORTAL\n  Payment clearance - 5 working days\n 3+ missed payments = Declaration of Health required\n Can set up double/triple collection on behalf of client\n Can set up 3-5 working day collection on behalf of client\n  "DD Reject/ Refer to payer" - currently reattempting',emailPassword:"wNP!TpRv",bankDetails:""},{insurer:"Polly/Tom/Winston",contactInformation:"800 048 8866",autoRecollection:"No",missedPaymentsToLapse:"Claims number: 800 031 8672 (option 2)",cancelOnBehalf:"Yes - Cancellation form to IPTIQ",canReinstateDD:"Yes",otherRetentionsInfo:" NO PORTAL\n Clearance - 8 working days\n Cancellation 30 days after 3rd miss payment\n Can miss 2 payments and retain cover. \n iptiq_serviceops@swissre.com - email for any payment queries/cancellations/NT forms/dd reinstatements etc. ",emailPassword:"",bankDetails:""},{insurer:"Royal London",contactInformation:"345 609 4500",autoRecollection:"Yes",missedPaymentsToLapse:"3",cancelOnBehalf:"No",canReinstateDD:"No",otherRetentionsInfo:' NO PORTAL\n  Clearance - 5 working days\n Can\'t cancel policy on behalf of client\n "1 missed" -  Automatic double collection when 1 missed payment.\n 3 missed payments - policy lapse\n Customer has to call to make payments.',emailPassword:"Candid123",bankDetails:""},{insurer:"Scottish Widows",contactInformation:"345 030 6240",autoRecollection:"Yes",missedPaymentsToLapse:"",cancelOnBehalf:"Yes - Call Insurer Directly",canReinstateDD:"Yes",otherRetentionsInfo:' NO PORTAL\n  Clearance - 5 working days\n  "DD OPEN - 2 PAYMENTS DUE NEXT PAYMENT" Automatic double/triple collection when DD is active depending on how many payments missed.\n Can set up a 14 day recollection ',emailPassword:"ON962Y",bankDetails:""},{insurer:"Shepherd's Friendly",contactInformation:"161 495 6495",autoRecollection:"No",missedPaymentsToLapse:"3",cancelOnBehalf:"No",canReinstateDD:"Yes",otherRetentionsInfo:" NO PORTAL\n Clearance - 5 working days\n  Can do payment links, manual payments and we can set up double collection\n Lapses after 3 missed payments. ",emailPassword:"C&*d1dSf!",bankDetails:""},{insurer:"The Exeter",contactInformation:"300 123 3203",autoRecollection:"Yes",missedPaymentsToLapse:"3",cancelOnBehalf:"No",canReinstateDD:"No",otherRetentionsInfo:" NO PORTAL\n Clearance - 4 working days\n 3 missed payments - lapses the policy\n Can set up 7 working day recollection/double collection on behalf of client. \n Can cancel on behalf of the client.\n Customer can be transferred to make manual payment \n Automatic 9 working day recollection is in place when 'Refer to payer' ",emailPassword:"",bankDetails:""},{insurer:"Vitality",contactInformation:"345 602 3523",autoRecollection:"Yes",missedPaymentsToLapse:"3",cancelOnBehalf:"Yes",canReinstateDD:"Yes",otherRetentionsInfo:' NO PORTAL\n  Clearance - 5 working days\n  "1 missing"-  Auto-recollection 14 days after missed premium.\n  Customer needs to call to make up premium over the phone\n  Lapses after 3 missed payments. ',emailPassword:"VitalityEWR2022",bankDetails:""},{insurer:"Zurich",contactInformation:"370 850 4419",autoRecollection:"Yes",missedPaymentsToLapse:"2",cancelOnBehalf:"No",canReinstateDD:"No",otherRetentionsInfo:" NO PORTAL\n Clearance - 5 working days\n  Customer needs to call to make up premium\n Lapses after 2 missed payments. ",emailPassword:"",bankDetails:""},{insurer:"Square Health",contactInformation:"3451403000",autoRecollection:"",missedPaymentsToLapse:"",cancelOnBehalf:"",canReinstateDD:"",otherRetentionsInfo:"CM can only amend the clients email address (Square Health will need to do everything else)",emailPassword:"",bankDetails:""},{insurer:"Metlife",contactInformation:"2077152000",autoRecollection:"?",missedPaymentsToLapse:"?",cancelOnBehalf:"No",canReinstateDD:"?",otherRetentionsInfo:"?",emailPassword:"?",bankDetails:"?"}],t7=e=>{let t=e.toLowerCase();return"yes"===t?(0,s.jsx)(X,{variant:"default",className:"bg-green-500 hover:bg-green-600",children:"Yes"}):"no"===t?(0,s.jsx)(X,{variant:"destructive",children:"No"}):"?"===t?(0,s.jsx)(X,{variant:"secondary",children:"?"}):e||"-"};function ae(){let[e,t]=r.useState(""),a=t8.filter(t=>t.insurer.toLowerCase().includes(e.toLowerCase()));return(0,s.jsxs)(P.Zp,{className:"w-full shadow-lg",children:[(0,s.jsxs)(P.aR,{children:[(0,s.jsx)(P.ZB,{className:"text-xl font-semibold text-primary",children:"Whole of Market Insurer Information"}),(0,s.jsx)(P.BT,{children:"Quick reference for insurer contact details, recollection options, and retention information."}),(0,s.jsx)(D,{type:"text",placeholder:"Search by insurer name...",value:e,onChange:e=>t(e.target.value),className:"mt-4"})]}),(0,s.jsx)(P.Wu,{children:(0,s.jsx)("div",{className:"h-[65vh] w-full overflow-auto border rounded-md",children:(0,s.jsxs)("table",{className:(0,d.cn)("w-full caption-bottom text-sm"),children:[(0,s.jsx)(eg,{className:"sticky top-0 bg-background z-10",children:(0,s.jsxs)(ej,{children:[(0,s.jsx)(eb,{className:"min-w-[150px] sticky left-0 bg-background z-20",children:"Insurer"}),(0,s.jsx)(eb,{className:"min-w-[130px]",children:"Contact Info"}),(0,s.jsx)(eb,{className:"min-w-[100px] text-center",children:"Auto Recollect?"}),(0,s.jsx)(eb,{className:"min-w-[150px]",children:"Lapse (Missed Pmts)"}),(0,s.jsx)(eb,{className:"min-w-[120px] text-center",children:"Cancel for Cust.?"}),(0,s.jsx)(eb,{className:"min-w-[100px] text-center",children:"Reinstate DD?"}),(0,s.jsx)(eb,{className:"min-w-[300px]",children:"Retentions Notes"}),(0,s.jsx)(eb,{className:"min-w-[150px]",children:"Login Details"}),(0,s.jsx)(eb,{className:"min-w-[150px]",children:"Bank Details (DD)"})]})}),(0,s.jsx)(ey,{children:a.map(e=>(0,s.jsxs)(ej,{children:[(0,s.jsx)(eN,{className:"font-medium sticky left-0 bg-background z-5",children:e.insurer}),(0,s.jsx)(eN,{children:e.contactInformation||"-"}),(0,s.jsx)(eN,{className:"text-center",children:t7(e.autoRecollection)}),(0,s.jsx)(eN,{children:e.missedPaymentsToLapse||"-"}),(0,s.jsx)(eN,{className:"text-center",children:t7(e.cancelOnBehalf)}),(0,s.jsx)(eN,{className:"text-center",children:t7(e.canReinstateDD)}),(0,s.jsx)(eN,{className:"whitespace-pre-line text-xs",children:e.otherRetentionsInfo||"-"}),(0,s.jsx)(eN,{children:e.emailPassword||"-"}),(0,s.jsx)(eN,{children:e.bankDetails||"-"})]},e.insurer))})]})})})]})}let at=eX.Ik({email:eX.Yj().email({message:"Invalid email address."}),password:eX.Yj().min(6,{message:"Password must be at least 6 characters."})});function aa(){let{toast:e}=(0,F.dj)(),t=(0,eJ.mN)({resolver:(0,eK.u)(at),defaultValues:{email:"",password:""}});async function a(t){try{await (0,l.x9)(n.j,t.email,t.password),e({title:"Login Successful",description:"You have been successfully logged in."})}catch(a){console.error("Login Error:",a);let t="An error occurred during login.";a instanceof eQ.g?t=a.message:a instanceof Error&&(t=a.message),e({title:"Login Failed",description:t,variant:"destructive"})}}return(0,s.jsxs)(P.Zp,{className:"w-full max-w-sm mx-auto",children:[(0,s.jsx)(P.aR,{children:(0,s.jsx)(P.ZB,{className:"text-2xl font-bold text-center",children:"Login"})}),(0,s.jsx)(P.Wu,{children:(0,s.jsx)(e1,{...t,children:(0,s.jsxs)("form",{onSubmit:t.handleSubmit(a),className:"space-y-4",children:[(0,s.jsx)(e5,{control:t.control,name:"email",render:e=>{let{field:t}=e;return(0,s.jsxs)(e9,{children:[(0,s.jsx)(e8,{children:"Email"}),(0,s.jsx)(e7,{children:(0,s.jsx)(D,{type:"email",placeholder:"m@example.com",...t})}),(0,s.jsx)(te,{})]})}}),(0,s.jsx)(e5,{control:t.control,name:"password",render:e=>{let{field:t}=e;return(0,s.jsxs)(e9,{children:[(0,s.jsx)(e8,{children:"Password"}),(0,s.jsx)(e7,{children:(0,s.jsx)(D,{type:"password",placeholder:"Password",...t})}),(0,s.jsx)(te,{})]})}}),(0,s.jsx)(g.$,{type:"submit",className:"w-full",children:"Login"})]})})})]})}let as="advisors",ar=new RegExp(/^(?=.*[A-Z])(?=.*\d).{6,}$/),al=eX.Ik({email:eX.Yj().email({message:"Invalid email address."}).refine(e=>e.toLowerCase().endsWith("@clark.io"),{message:"Sign up requires a @clark.io email address."}),password:eX.Yj().min(6,{message:"Password must be at least 6 characters."}).regex(ar,{message:"Password must contain at least one uppercase letter and one number."})});function an(){let{toast:e}=(0,F.dj)(),[t,a]=r.useState(!1),o=(0,eJ.mN)({resolver:(0,eK.u)(al),defaultValues:{email:"",password:""}});async function d(t){a(!0);let s=t.email.toLowerCase();try{let r;let d=(0,i.rJ)(n.db,as),c=(0,i.P)(d,(0,i._M)("email","==",s),(0,i._M)("status","==","pending")),m=await (0,i.GG)(c);if(m.empty){e({title:"Sign Up Failed",description:"This email address is not authorized for sign-up or has already been activated. Please contact an administrator.",variant:"destructive"}),a(!1);return}let u=m.docs[0];try{r=await (0,l.eJ)(n.j,s,t.password)}catch(s){console.error("Firebase Auth Error:",s);let t="An error occurred during sign up with Firebase Authentication.";s instanceof eQ.g?t="auth/email-already-in-use"===s.code?"This email is already registered in Firebase Authentication. If you believe this is an error, contact an administrator.":s.message:s instanceof Error&&(t=s.message),e({title:"Sign Up Failed",description:t,variant:"destructive"}),a(!1);return}let h=(0,i.H9)(n.db,as,u.id);await (0,i.mZ)(h,{status:"active",firebaseUid:r.user.uid}),e({title:"Sign Up Successful",description:"Your account has been created and activated. Please log in."}),o.reset()}catch(a){console.error("Sign Up Process Error:",a);let t="An unexpected error occurred during sign up.";a instanceof eQ.g?t=a.message:a instanceof Error&&(t=a.message),e({title:"Sign Up Failed",description:t,variant:"destructive"})}finally{a(!1)}}return(0,s.jsxs)(P.Zp,{className:"w-full max-w-sm mx-auto",children:[(0,s.jsx)(P.aR,{children:(0,s.jsx)(P.ZB,{className:"text-2xl font-bold text-center",children:"Sign Up"})}),(0,s.jsx)(P.Wu,{children:(0,s.jsx)(e1,{...o,children:(0,s.jsxs)("form",{onSubmit:o.handleSubmit(d),className:"space-y-4",children:[(0,s.jsx)(e5,{control:o.control,name:"email",render:e=>{let{field:a}=e;return(0,s.jsxs)(e9,{children:[(0,s.jsx)(e8,{children:"Email (@clark.io only)"}),(0,s.jsx)(e7,{children:(0,s.jsx)(D,{type:"email",placeholder:"advisor@clark.io",...a,disabled:t})}),(0,s.jsx)(te,{})]})}}),(0,s.jsx)(e5,{control:o.control,name:"password",render:e=>{let{field:a}=e;return(0,s.jsxs)(e9,{children:[(0,s.jsx)(e8,{children:"Password"}),(0,s.jsx)(e7,{children:(0,s.jsx)(D,{type:"password",placeholder:"Min. 6 chars, 1 uppercase, 1 number",...a,disabled:t})}),(0,s.jsx)(te,{})]})}}),(0,s.jsxs)(g.$,{type:"submit",className:"w-full",disabled:t,children:[t?(0,s.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,t?"Signing Up...":"Sign Up"]})]})})})]})}var ai=a(7648),ao=a(5380),ad=a(1487),ac=a(3173),am=a(5554),au=a(286),ah=a(3349),ax=a(8044),ap=a(6677),af=a(4806);async function av(e,t){let{month:a,year:s}=function(){let e=new Date(new Date().toLocaleString("en-GB",{timeZone:"Europe/London"}));return{month:e.getMonth(),year:e.getFullYear()}}(),r={};for(let t of e)"Meeting"===t.eventType&&t.date&&new Date(t.date).getMonth()===a&&new Date(t.date).getFullYear()===s&&(r[t.advisorId]=(r[t.advisorId]||0)+(t.loggedTime||0));for(let e of t){let t=r[e.id]||0;await (0,ap.i3)(e.id,t)}}let ag="advisors",ay="loggedEvents",aj=["lauren.jackson@clark.io","james.smith@clark.io","daniel.hillman@clark.io","danielhillman94@hotmail.co.uk"];function ab(){let{toast:e}=(0,F.dj)(),[t,a]=(0,r.useState)(null),[o,d]=(0,r.useState)(!0),[p,f]=(0,r.useState)(!0),[v,y]=(0,r.useState)([]),[j,b]=(0,r.useState)([]),[N,w]=(0,r.useState)(!0),[C,k]=(0,r.useState)(!0),[T,D]=(0,r.useState)(null),[P,E]=(0,r.useState)("time-log"),[S,R]=(0,r.useState)(null),[I,O]=(0,r.useState)(!1),[M,U]=(0,r.useState)(null),[Y,z]=(0,r.useState)(new Map),[J,K]=(0,r.useState)(null),[Q,ee]=(0,r.useState)(!1),[et,ea]=(0,r.useState)(null),es=(null==T?void 0:T.hasTopAccess)||(null==t?void 0:t.email)&&aj.includes(t.email)||!1,er=j.find(e=>e.firebaseUid===(null==t?void 0:t.uid)),el=(null==er?void 0:er.id)||"",en=null==er?void 0:er.admin_day_earned,[ei,eo]=(0,r.useState)(!1),[ed,ec]=(0,r.useState)(!1);!function(){let[e,t]=r.useState(void 0);r.useEffect(()=>{let e=window.matchMedia("(max-width: ".concat(767,"px)")),a=()=>{t(window.innerWidth<768)};return e.addEventListener("change",a),t(window.innerWidth<768),()=>e.removeEventListener("change",a)},[])}();let eu=[(null==T?void 0:T.canAccessTimeLog)?{value:"time-log",label:"Time Log",icon:(0,s.jsx)(ai.A,{className:"mr-2 h-4 w-4"})}:void 0,(null==T?void 0:T.canAccessSummary)||es?{value:"summary",label:"Summary",icon:(0,s.jsx)(eM.A,{className:"mr-2 h-4 w-4"})}:void 0,(null==T?void 0:T.canAccessReports)||es?{value:"reports",label:"Reports",icon:(0,s.jsx)(ao.A,{className:"mr-2 h-4 w-4"})}:void 0,(null==T?void 0:T.canAccessVisualisations)||es?{value:"visualizations",label:"Visualizations",icon:(0,s.jsx)(ao.A,{className:"mr-2 h-4 w-4"})}:void 0,(null==T?void 0:T.canAccessPolicySearch)?{value:"policy-search",label:"Policy Search",icon:(0,s.jsx)(ad.A,{className:"mr-2 h-4 w-4"})}:void 0,(null==T?void 0:T.canAccessNextClearedBatch)?{value:"next-cleared-batch",label:"Next Cleared Batch",icon:(0,s.jsx)(tV.A,{className:"mr-2 h-4 w-4"})}:void 0,(null==T?void 0:T.canAccessWholeOfMarket)?{value:"whole-of-market",label:"Whole Of Market",icon:(0,s.jsx)(ac.A,{className:"mr-2 h-4 w-4"})}:void 0,(null==T?void 0:T.canAccessAgentTools)?{value:"agent",label:"Agent Tools",icon:(0,s.jsx)(am.A,{className:"mr-2 h-4 w-4"})}:void 0,(null==T?void 0:T.canManageAdvisors)||es?{value:"manage-advisors",label:"Manage Advisors",icon:(0,s.jsx)(au.A,{className:"mr-2 h-4 w-4"})}:void 0].filter(e=>!!e);(0,r.useEffect)(()=>{let t=(0,l.hg)(n.j,async t=>{if(a(t),d(!1),t){k(!0);try{let e=(0,i.P)((0,i.rJ)(n.db,ag),(0,i._M)("firebaseUid","==",t.uid)),a=await (0,i.GG)(e),s=null;if(a.empty){if(t.email&&aj.includes(t.email)){let e=(0,ap.Ur)();Object.keys(e).forEach(t=>e[t]=!0),e.hasTopAccess=!0,D(e)}else D((0,ap.Ur)())}else{let e=a.docs[0].data().permissions||{};D({...(0,ap.Ur)(),...e})}}catch(t){console.error("Error fetching user permissions:",t),e({variant:"destructive",title:"Permissions Error",description:"Could not load user permissions. Applying default access."}),D((0,ap.Ur)())}finally{k(!1)}}else a(null),w(!1),k(!1),D(null),b([]),y([]),R(null),z(new Map),K(null)});return()=>t()},[e]),(0,r.useEffect)(()=>{let a;if(!t||!T){b([]),y([]),w(!1);return}w(!0);let s=!1,r=!1,l=()=>{s&&r&&w(!1)},o=(0,i.P)((0,i.rJ)(n.db,ag)),d=(0,i.aQ)(o,e=>{b(e.docs.map(e=>({id:e.id,...e.data()}))),s=!0,l()},t=>{console.error("Error fetching advisors: ",t),e({variant:"destructive",title:"Error",description:"Could not fetch advisors."}),s=!0,l()});a=T.canViewAllEvents||es?(0,i.P)((0,i.rJ)(n.db,ay)):(0,i.P)((0,i.rJ)(n.db,ay),(0,i._M)("userId","==",t.uid));let c=(0,i.aQ)(a,e=>{y(e.docs.map(e=>{let t=e.data(),a={id:e.id,...t,timestamp:t.timestamp&&"function"==typeof t.timestamp.toDate?t.timestamp.toDate().toISOString():"string"==typeof t.timestamp?t.timestamp:new Date().toISOString(),date:t.date};return a.eventType&&eH.includes(a.eventType)||(a.eventType="Other"),a})),r=!0,l()},t=>{console.error("Error fetching logged events: ",t),e({variant:"destructive",title:"Error",description:"Could not fetch time logs."}),r=!0,l()});return()=>{d(),c()}},[t,T,e]);let eh=(0,r.useCallback)(a=>{var s;if(!(a.userId===(null==t?void 0:t.uid)||es)){e({variant:"destructive",title:"Permission Denied",description:"You cannot edit this log entry."});return}"string"==typeof a.eventType&&eH.includes(a.eventType)?R(a):R({...a,eventType:"Other"}),E("time-log"),null===(s=document.getElementById("time-log-form-card"))||void 0===s||s.scrollIntoView({behavior:"smooth",block:"center"})},[t,es,e]),ex=(0,r.useCallback)(()=>{R(null)},[]),ep=(0,r.useCallback)(async a=>{if(!t){e({variant:"destructive",title:"Error",description:"You must be logged in."});return}let s=v.find(e=>e.id===a);if(!((null==s?void 0:s.userId)===t.uid||es)){e({variant:"destructive",title:"Permission Denied",description:"You cannot delete this log entry."});return}U(a);try{await (0,i.kd)((0,i.H9)(n.db,ay,a)),e({title:"Success",description:"Log entry deleted."});let t=await (0,i.GG)((0,i.rJ)(n.db,ay)),s=await (0,i.GG)((0,i.rJ)(n.db,ag)),r=t.docs.map(e=>({id:e.id,...e.data()})),l=s.docs.map(e=>({id:e.id,...e.data()}));await av(r,l)}catch(t){console.error("Error deleting log entry: ",t),e({variant:"destructive",title:"Error",description:"Failed to delete log entry."})}finally{U(null)}},[t,v,es,e]),ef=(0,r.useCallback)(async a=>{if(!t||!(null==T?void 0:T.canAccessTimeLog)){e({variant:"destructive",title:"Permission Denied",description:"You do not have permission to log time."});return}O(!0);try{let s={...a,userId:t.uid,timestamp:new Date().toISOString()};await (0,i.gS)((0,i.rJ)(n.db,ay),s),e({title:"Success",description:"Time logged successfully."}),R(null);let r=await (0,i.GG)((0,i.rJ)(n.db,ay)),l=await (0,i.GG)((0,i.rJ)(n.db,ag)),o=r.docs.map(e=>({id:e.id,...e.data()})),d=l.docs.map(e=>({id:e.id,...e.data()}));await av(o,d)}catch(t){console.error("Error adding time log: ",t),e({variant:"destructive",title:"Error",description:"Failed to log time."})}finally{O(!1)}},[t,T,e]),ev=(0,r.useCallback)(async a=>{if(!t){e({variant:"destructive",title:"Error",description:"You must be logged in."});return}if(!(a.userId===t.uid||es)){e({variant:"destructive",title:"Permission Denied",description:"You cannot edit this log entry."});return}if(!a.id){e({variant:"destructive",title:"Error",description:"Cannot update event without an ID."});return}O(!0);try{let t=(0,i.H9)(n.db,ay,a.id),s={advisorId:a.advisorId,date:a.date,eventType:a.eventType,eventDetails:a.eventDetails,loggedTime:a.loggedTime,timestamp:new Date().toISOString()};Object.keys(s).forEach(e=>{void 0===s[e]&&delete s[e]}),"Other"!==s.eventType&&s.hasOwnProperty("eventDetails")&&(s.eventDetails=null),await (0,i.mZ)(t,s),e({title:"Success",description:"Event updated successfully."}),R(null);let r=await (0,i.GG)((0,i.rJ)(n.db,ay)),l=await (0,i.GG)((0,i.rJ)(n.db,ag)),o=r.docs.map(e=>({id:e.id,...e.data()})),d=l.docs.map(e=>({id:e.id,...e.data()}));await av(o,d)}catch(t){console.error("Error editing log entry: ",t),e({variant:"destructive",title:"Error",description:"Failed to update event."})}finally{O(!1)}},[t,es,e]),eg=(0,r.useCallback)(async(a,s)=>{if(!t||!((null==T?void 0:T.canManageAdvisors)||(null==T?void 0:T.hasTopAccess)))throw e({variant:"destructive",title:"Permission Denied",description:"You do not have permission to add advisors."}),Error("Permission Denied");let r=a.trim(),l=s.trim().toLowerCase();if(!l.endsWith("@clark.io"))throw e({variant:"destructive",title:"Invalid Email",description:"Email must end with @clark.io."}),Error("Invalid email domain");let o=(0,i.P)((0,i.rJ)(n.db,ag),(0,i._M)("email","==",l));if(!(await (0,i.GG)(o)).empty)throw e({variant:"destructive",title:"Duplicate Email",description:"An advisor with this email already exists."}),Error("Duplicate email");let d=(0,i.P)((0,i.rJ)(n.db,ag),(0,i._M)("name","==",r));if(!(await (0,i.GG)(d)).empty)throw e({variant:"destructive",title:"Duplicate Name",description:"An advisor with this name already exists."}),Error("Duplicate name");try{await (0,ap.Gs)({name:r,email:l,addedByAdminUid:t.uid}),e({title:"Success",description:"Advisor '".concat(r,"' added with email '").concat(l,"'. They can now sign up.")})}catch(t){throw console.error("Error in addAdvisor try block:",t),e({variant:"destructive",title:"Error Adding Advisor",description:t.message||"Failed to add advisor."}),t}},[t,T,e]),ey=(0,r.useCallback)(async a=>{if(!t||!((null==T?void 0:T.canManageAdvisors)||(null==T?void 0:T.hasTopAccess)))throw e({variant:"destructive",title:"Permission Denied",description:"You do not have permission to remove advisors."}),Error("Permission Denied");let s=j.find(e=>e.id===a);if(!s)throw e({variant:"destructive",title:"Not Found",description:"Advisor not found."}),Error("Advisor not found");if("active"===s.status&&v.some(e=>e.advisorId===a))throw e({variant:"destructive",title:"Deletion Failed",description:"Cannot remove active advisor '".concat(s.name,"' as they have logged time entries. Please reassign or delete the logs first."),duration:7e3}),Error("Active advisor has logged events");"active"!==s.status||v.some(e=>e.advisorId===a)||console.warn("Admin ".concat(t.email," is removing active advisor ").concat(s.name," (").concat(s.email,") who has no logged events."));try{await (0,i.kd)((0,i.H9)(n.db,ag,a)),e({title:"Success",description:"Advisor '".concat(s.name,"' removed.")})}catch(t){throw console.error("Error removing advisor: ",t),e({variant:"destructive",title:"Error",description:"Failed to remove advisor."}),t}},[j,v,t,T,e]),ej=(0,r.useCallback)(async(a,s,r)=>{if(!t||!((null==T?void 0:T.canManageAdvisors)||(null==T?void 0:T.hasTopAccess)))throw e({variant:"destructive",title:"Permission Denied",description:"You do not have permission to edit advisors."}),Error("Permission Denied");let l=s.trim(),o=null==r?void 0:r.trim().toLowerCase(),d=j.find(e=>e.id===a);if(!d)throw e({variant:"destructive",title:"Not Found",description:"Advisor not found."}),Error("Advisor not found");let c={};if(l!==d.name){let t=(0,i.P)((0,i.rJ)(n.db,ag),(0,i._M)("name","==",l),(0,i._M)("id","!=",a));if(!(await (0,i.GG)(t)).empty)throw e({variant:"destructive",title:"Duplicate Name",description:"An advisor with the name '".concat(l,"' already exists.")}),Error("Duplicate name");c.name=l}if(o&&o!==d.email){if("active"===d.status)throw e({variant:"destructive",title:"Update Denied",description:"Email cannot be changed for an active advisor."}),Error("Cannot change email for active advisor");if(!o.endsWith("@clark.io"))throw e({variant:"destructive",title:"Invalid Email",description:"Email must end with @clark.io."}),Error("Invalid email domain");let t=(0,i.P)((0,i.rJ)(n.db,ag),(0,i._M)("email","==",o),(0,i._M)("id","!=",a));if(!(await (0,i.GG)(t)).empty)throw e({variant:"destructive",title:"Duplicate Email",description:"An advisor with the email '".concat(o,"' already exists.")}),Error("Duplicate email");c.email=o}if(0===Object.keys(c).length){e({title:"No Changes",description:"No changes detected."});return}try{let t=(0,i.H9)(n.db,ag,a);await (0,i.mZ)(t,c);let s="Advisor details updated.";c.name&&c.email?s="Advisor '".concat(d.name,"' renamed to '").concat(c.name,"' and email updated to '").concat(c.email,"'."):c.name?s="Advisor '".concat(d.name,"' renamed to '").concat(c.name,"'."):c.email&&(s="Advisor '".concat(d.name,"' email updated to '").concat(c.email,"'.")),e({title:"Success",description:s})}catch(t){throw console.error("Error editing advisor: ",t),e({variant:"destructive",title:"Error",description:"Failed to update advisor."}),t}},[j,t,T,e]),eb=(0,r.useCallback)(async(a,s)=>{if(!t||!((null==T?void 0:T.canManageAdvisors)||(null==T?void 0:T.hasTopAccess)))throw e({variant:"destructive",title:"Permission Denied",description:"You do not have permission to update advisor permissions."}),Error("Permission Denied");try{await (0,ap.cj)(a,s),e({title:"Permissions Updated",description:"Advisor permissions have been successfully updated."})}catch(t){throw console.error("Error updating advisor permissions from page.tsx: ",t),e({variant:"destructive",title:"Update Failed",description:t.message||"Failed to update advisor permissions."}),t}},[t,T,e]);(0,r.useCallback)(async()=>{if(!t||!es){e({variant:"destructive",title:"Permission Denied",description:"You do not have permission to clear all logs."});return}if(0===v.length){e({variant:"default",title:"Info",description:"There are no time logs to clear."});return}try{let t=(0,i.wP)(n.db);v.forEach(e=>{let a=(0,i.H9)(n.db,ay,e.id);t.delete(a)}),await t.commit(),e({title:"Success",description:"All time log entries cleared."})}catch(t){console.error("Error clearing all logs: ",t),e({variant:"destructive",title:"Error",description:"Failed to clear all time logs."})}},[v,t,es,e]);let eN=async()=>{try{await (0,l.CI)(n.j),D(null),e({title:"Logged Out",description:"You have been successfully logged out."})}catch(t){console.error("Logout Error:",t),e({variant:"destructive",title:"Logout Failed",description:"An error occurred during logout."})}},ew=async(e,t)=>{await (0,ap.gn)(e,t),await av(v,j)},eC=async(e,t,a)=>{await (0,ap.ut)(e,t,a)},ek=async()=>{if(er&&t){ec(!0);try{await (0,ap.ut)(er.id,t.uid,t.displayName||t.email||""),e({title:"Admin Day Taken",description:"You have taken your Admin Day for this month."})}catch(t){e({title:"Error",description:"Failed to take Admin Day.",variant:"destructive"})}finally{ec(!1),eo(!1)}}};return o||t&&C?(0,s.jsxs)("div",{className:"flex justify-center items-center min-h-screen",children:[(0,s.jsx)(L.A,{className:"h-8 w-8 animate-spin mr-2"}),o?"Loading Authentication...":"Loading User Permissions..."]}):t?C?(0,s.jsxs)("div",{className:"flex justify-center items-center min-h-screen",children:[(0,s.jsx)(L.A,{className:"h-8 w-8 animate-spin mr-2"}),"Loading User Permissions..."]}):(0,s.jsx)(x.ThemeProvider,{attribute:"class",defaultTheme:"system",enableSystem:!0,children:(0,s.jsx)("div",{className:"min-h-screen bg-background text-foreground",children:(0,s.jsxs)("div",{className:"container mx-auto p-4 md:p-8",children:[(0,s.jsxs)("header",{className:"flex justify-center items-center relative mb-8 pb-4 border-b",children:[(0,s.jsx)("div",{className:"text-5xl font-designer font-bold text-blue-500",children:"Tempo"}),(0,s.jsxs)("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 flex items-center space-x-2",children:[t.email&&(0,s.jsx)("span",{className:"text-sm text-muted-foreground hidden md:inline",children:t.email}),(0,s.jsx)(A,{}),(0,s.jsx)(g.$,{variant:"outline",size:"icon",onClick:eN,title:"Logout",children:(0,s.jsx)(ah.A,{className:"h-5 w-5"})})]})]}),en&&((null==er?void 0:er.firebaseUid)===(null==t?void 0:t.uid)&&((null==er?void 0:er.role)==="Senior"||(null==er?void 0:er.role)==="Captain")||es)&&(0,s.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,s.jsx)(X,{variant:"destructive",className:"text-lg px-4 py-2 mb-2",children:"\uD83C\uDF89 You are eligible for an Admin Day this month!"}),(null==er?void 0:er.firebaseUid)===(null==t?void 0:t.uid)&&((null==er?void 0:er.role)==="Senior"||(null==er?void 0:er.role)==="Captain")&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(_,{open:ei,onOpenChange:eo,children:[(0,s.jsx)(B,{asChild:!0,children:(0,s.jsx)(g.$,{variant:"outline",className:"mb-2",onClick:()=>eo(!0),disabled:ed,children:"Take Admin Day"})}),(0,s.jsxs)(V,{children:[(0,s.jsxs)(G,{children:[(0,s.jsx)(Z,{children:"Take Admin Day?"}),(0,s.jsx)($,{children:"Are you sure you want to take your Admin Day for this month? This action cannot be undone until you earn it again next month."})]}),(0,s.jsxs)(W,{children:[(0,s.jsx)(H,{disabled:ed,children:"Cancel"}),(0,s.jsx)(q,{onClick:ek,disabled:ed,children:ed?"Processing...":"Yes, Take Admin Day"})]})]})]}),Array.isArray(null==er?void 0:er.admin_day_history)&&er.admin_day_history.length>0&&(0,s.jsx)(tH,{type:"single",collapsible:!0,className:"w-full max-w-md mx-auto mt-2",children:(0,s.jsxs)(tJ,{value:"history",children:[(0,s.jsx)(tK,{className:"text-base font-medium",children:"View Admin Day History"}),(0,s.jsx)(tX,{children:(0,s.jsx)("ul",{className:"space-y-2",children:er.admin_day_history.slice().reverse().map((e,t)=>(0,s.jsxs)("li",{className:"border rounded p-2 bg-muted/50",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center",children:[(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"font-semibold",children:"Granted:"})," ",new Date(e.grantedDate).toLocaleDateString()]}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["by ",e.grantedBy]})]}),e.usedDate&&(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mt-1",children:[(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"font-semibold",children:"Taken:"})," ",new Date(e.usedDate).toLocaleDateString()]}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["by ",e.usedBy]})]}),e.notes&&(0,s.jsx)("div",{className:"mt-1 text-xs italic",children:e.notes})]},t))})})]})})]})]}),N?(0,s.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,s.jsx)(L.A,{className:"h-6 w-6 animate-spin mr-3"}),"Loading App Data..."]}):(0,s.jsxs)(c,{value:P,onValueChange:E,className:"w-full",children:[(0,s.jsx)("div",{className:"w-full mb-12",children:(0,s.jsx)(m,{className:"flex flex-row rounded-xl shadow-lg bg-card/80 border p-2 gap-2 h-auto w-full items-center overflow-x-hidden hover:overflow-x-auto whitespace-nowrap [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar-track]:bg-muted [&::-webkit-scrollbar-thumb]:bg-primary/50 [&::-webkit-scrollbar-thumb]:rounded-full [&:not(:hover)]:overflow-x-hidden [&:hover]:overflow-x-auto [&:hover]:overflow-y-hidden",children:eu.map(e=>(0,s.jsxs)(u,{value:e.value,className:"nav-tab data-[state=active]:bg-primary data-[state=active]:text-primary-foreground flex items-center px-4 py-2 rounded-md font-medium whitespace-nowrap",children:[e.icon,e.label]},e.value))})}),(null==T?void 0:T.canAccessTimeLog)?(0,s.jsx)(h,{value:"time-log",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsx)(ti,{advisors:j.filter(e=>"active"===e.status),onLogEvent:ef,onUpdateEvent:async(e,t)=>{let a={...t,id:e};await ev(a)},onCancelEdit:ex,eventToEdit:S,isSubmitting:I})}),(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsx)(eq,{events:v,advisors:j,onDeleteEvent:ep,onEditEvent:eh,deletingId:M,currentUser:t,currentUserIsAdmin:es})})]})}):(0,s.jsx)(h,{value:"time-log",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,s.jsx)(ax.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to view Time Logs."})]})}),(null==T?void 0:T.canAccessSummary)||es?(0,s.jsx)(h,{value:"summary",children:(0,s.jsx)(eO,{loggedEvents:v,advisors:j})}):(0,s.jsx)(h,{value:"summary",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,s.jsx)(ax.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to view the Summary."})]})}),(null==T?void 0:T.canAccessReports)||es?(0,s.jsx)(h,{value:"reports",children:(0,s.jsx)(tL,{loggedEvents:v,advisors:j,advisorId:el})}):(0,s.jsx)(h,{value:"reports",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,s.jsx)(ax.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to view Reports."})]})}),(null==T?void 0:T.canAccessVisualisations)||es?(0,s.jsx)(h,{value:"visualizations",children:(0,s.jsx)(tA,{loggedEvents:v,advisors:j})}):(0,s.jsx)(h,{value:"visualizations",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,s.jsx)(ax.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to view Visualizations."})]})}),(null==T?void 0:T.canAccessPolicySearch)?(0,s.jsx)(h,{value:"policy-search",children:(0,s.jsx)(tz,{policyData:Y,setPolicyData:z,fileName:J,setFileName:K,isLoading:Q,setIsLoading:ee,parseError:et,setParseError:ea})}):(0,s.jsx)(h,{value:"policy-search",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,s.jsx)(ax.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to use Policy Search."})]})}),(null==T?void 0:T.canAccessNextClearedBatch)?(0,s.jsx)(h,{value:"next-cleared-batch",children:(0,s.jsx)(t9,{})}):(0,s.jsx)(h,{value:"next-cleared-batch",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,s.jsx)(ax.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to use Next Cleared Batch."})]})}),(null==T?void 0:T.canAccessWholeOfMarket)?(0,s.jsx)(h,{value:"whole-of-market",children:(0,s.jsx)(ae,{})}):(0,s.jsx)(h,{value:"whole-of-market",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,s.jsx)(ax.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to view Whole of Market."})]})}),(null==T?void 0:T.canAccessAgentTools)?(0,s.jsx)(h,{value:"agent",children:(0,s.jsx)(af.default,{})}):(0,s.jsx)(h,{value:"agent",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,s.jsx)(ax.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to use Agent Tools."})]})}),(null==T?void 0:T.canManageAdvisors)||es?(0,s.jsx)(h,{value:"manage-advisors",children:(0,s.jsx)(em,{advisors:j,onAddAdvisor:eg,onRemoveAdvisor:ey,onEditAdvisor:ej,onUpdateAdvisorPermissions:eb,onUpdateAdvisorRole:ew,onDismissAdminDayFlag:eC,currentUser:t,isAdmin:es,hasTopAccess:null==T?void 0:T.hasTopAccess})}):(0,s.jsx)(h,{value:"manage-advisors",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,s.jsx)(ax.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to Manage Advisors."})]})})]})]})})}):(0,s.jsx)(x.ThemeProvider,{attribute:"class",defaultTheme:"system",enableSystem:!0,children:(0,s.jsxs)("div",{className:"min-h-screen bg-background text-foreground flex flex-col items-center justify-center p-4",children:[(0,s.jsxs)("header",{className:"flex justify-center items-center relative mb-8 pb-4 border-b w-full max-w-4xl",children:[(0,s.jsx)("div",{className:"text-5xl font-designer font-bold text-blue-500",children:"Tempo"}),(0,s.jsx)("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2",children:(0,s.jsx)(A,{})})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4 w-full",children:[p?(0,s.jsx)(aa,{}):(0,s.jsx)(an,{}),(0,s.jsx)(g.$,{variant:"link",onClick:()=>f(!p),children:p?"Need an account? Sign Up":"Already have an account? Login"})]})]})})}},2751:(e,t,a)=>{Promise.resolve().then(a.bind(a,2119))}},e=>{var t=t=>e(e.s=t);e.O(0,[992,156,647,316,112,496,752,806,441,684,358],()=>t(2751)),_N_E=e.O()}]);