(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1483:(e,t,s)=>{"use strict";s.d(t,{ThemeProvider:()=>l});var a=s(5155);s(2115);var r=s(1362);function l(e){let{children:t,...s}=e;return(0,a.jsx)(r.N,{...s,children:t})}},1554:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>sC});var a=s(5155),r=s(2115),l=s(3004),n=s(6104),i=s(5317),o=s(704),d=s(9434);let c=o.bL,m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(o.B8,{ref:t,className:(0,d.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r})});m.displayName=o.B8.displayName;let u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(o.l9,{ref:t,className:(0,d.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...r})});u.displayName=o.l9.displayName;let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(o.UC,{ref:t,className:(0,d.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r})});h.displayName=o.UC.displayName;var x=s(1483),p=s(6936),f=s(8027),v=s(1362),g=s(285),y=s(8698),j=s(3158),b=s(518),N=s(154);let w=y.bL,C=y.l9;y.YJ,y.ZL,y.Pb,y.z6,r.forwardRef((e,t)=>{let{className:s,inset:r,children:l,...n}=e;return(0,a.jsxs)(y.ZP,{ref:t,className:(0,d.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...n,children:[l,(0,a.jsx)(j.A,{className:"ml-auto"})]})}).displayName=y.ZP.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(y.G5,{ref:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})}).displayName=y.G5.displayName;let T=r.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...l}=e;return(0,a.jsx)(y.ZL,{children:(0,a.jsx)(y.UC,{ref:t,sideOffset:r,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})})});T.displayName=y.UC.displayName;let k=r.forwardRef((e,t)=>{let{className:s,inset:r,...l}=e;return(0,a.jsx)(y.q7,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...l})});function A(){let{setTheme:e}=(0,v.D)();return(0,a.jsxs)(w,{children:[(0,a.jsx)(C,{asChild:!0,children:(0,a.jsxs)(g.$,{variant:"outline",size:"icon",children:[(0,a.jsx)(p.A,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,a.jsx)(f.A,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}),(0,a.jsxs)(T,{align:"end",children:[(0,a.jsx)(k,{onClick:()=>e("light"),children:"Light"}),(0,a.jsx)(k,{onClick:()=>e("dark"),children:"Dark"}),(0,a.jsx)(k,{onClick:()=>e("system"),children:"System"})]})]})}k.displayName=y.q7.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,checked:l,...n}=e;return(0,a.jsxs)(y.H_,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:l,...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(y.VF,{children:(0,a.jsx)(b.A,{className:"h-4 w-4"})})}),r]})}).displayName=y.H_.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(y.hN,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(y.VF,{children:(0,a.jsx)(N.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=y.hN.displayName,r.forwardRef((e,t)=>{let{className:s,inset:r,...l}=e;return(0,a.jsx)(y.JU,{ref:t,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...l})}).displayName=y.JU.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(y.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=y.wv.displayName;let D=r.forwardRef((e,t)=>{let{className:s,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:(0,d.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...l})});D.displayName="Input";var P=s(6695),E=s(7655);let R=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(E.bL,{ref:t,className:(0,d.cn)("relative overflow-hidden",s),...l,children:[(0,a.jsx)(E.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(S,{}),(0,a.jsx)(E.OK,{})]})});R.displayName=E.bL.displayName;let S=r.forwardRef((e,t)=>{let{className:s,orientation:r="vertical",...l}=e;return(0,a.jsx)(E.VM,{ref:t,orientation:r,className:(0,d.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...l,children:(0,a.jsx)(E.lr,{className:"relative flex-1 rounded-full bg-border"})})});S.displayName=E.VM.displayName;var L=s(172),I=s(3896),O=s(6570),M=s(8044),F=s(9637),U=s(5943),B=s(7223),_=s(7481),Y=s(4520);let z=Y.bL,V=Y.l9,W=Y.ZL,G=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(Y.hJ,{className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:t})});G.displayName=Y.hJ.displayName;let Z=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsxs)(W,{children:[(0,a.jsx)(G,{}),(0,a.jsx)(Y.UC,{ref:t,className:(0,d.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r})]})});Z.displayName=Y.UC.displayName;let $=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s})};$.displayName="AlertDialogHeader";let q=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};q.displayName="AlertDialogFooter";let H=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(Y.hE,{ref:t,className:(0,d.cn)("text-lg font-semibold",s),...r})});H.displayName=Y.hE.displayName;let J=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(Y.VY,{ref:t,className:(0,d.cn)("text-sm text-muted-foreground",s),...r})});J.displayName=Y.VY.displayName;let K=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(Y.rc,{ref:t,className:(0,d.cn)((0,g.r)(),s),...r})});K.displayName=Y.rc.displayName;let X=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(Y.ZD,{ref:t,className:(0,d.cn)((0,g.r)({variant:"outline"}),"mt-2 sm:mt-0",s),...r})});X.displayName=Y.ZD.displayName;var Q=s(4884);let ee=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(Q.bL,{className:(0,d.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-green-500","data-[state=checked]:border-green-600","data-[state=unchecked]:bg-slate-200","data-[state=unchecked]:border-slate-300","dark:data-[state=unchecked]:bg-slate-700","dark:data-[state=unchecked]:border-slate-600",s),...r,ref:t,children:(0,a.jsx)(Q.zi,{className:(0,d.cn)("pointer-events-none block h-5 w-5 rounded-full shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0","bg-slate-600 dark:bg-white")})})});ee.displayName=Q.bL.displayName;var et=s(968),es=s(2085);let ea=(0,es.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),er=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(et.b,{ref:t,className:(0,d.cn)(ea(),s),...r})});er.displayName=et.b.displayName;var el=s(9613);let en=el.Kq,ei=el.bL,eo=el.l9,ed=r.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...l}=e;return(0,a.jsx)(el.UC,{ref:t,sideOffset:r,className:(0,d.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})});ed.displayName=el.UC.displayName;let ec={canAccessTimeLog:"Time Log",canAccessPolicySearch:"Policy Search",canAccessNextClearedBatch:"Next Cleared Batch",canAccessWholeOfMarket:"Whole of Market",canAccessAgentTools:"Agent Tools",canAccessVisualisations:"Visualisations",canAccessSummary:"Summary",canAccessReports:"Reports",canManageAdvisors:"Manage Advisors",hasTopAccess:"Top Access (Grants All)",canViewAllEvents:"View all logged events"},em=["canAccessTimeLog","canAccessPolicySearch","canAccessNextClearedBatch","canAccessWholeOfMarket","canAccessAgentTools"],eu=["canAccessVisualisations","canAccessSummary","canAccessReports","canManageAdvisors"];function eh(e){let{advisors:t,onAddAdvisor:s,onRemoveAdvisor:l,onEditAdvisor:n,onUpdateAdvisorPermissions:i}=e,[o,c]=(0,r.useState)(""),[m,u]=(0,r.useState)(""),[h,x]=(0,r.useState)(null),[p,f]=(0,r.useState)(""),[v,y]=(0,r.useState)(""),[j,b]=(0,r.useState)(!1),[N,w]=(0,r.useState)(null),{toast:C}=(0,_.dj)(),T=(0,r.useRef)(null),k=(0,r.useRef)(null),A=(0,r.useRef)(null),E=(0,r.useRef)(null);(0,r.useEffect)(()=>{j||h||!T.current||setTimeout(()=>{var e;return null===(e=T.current)||void 0===e?void 0:e.focus()},0)},[j,h]),(0,r.useEffect)(()=>{h&&A.current&&setTimeout(()=>{var e;return null===(e=A.current)||void 0===e?void 0:e.focus()},0)},[h]);let S=async(e,t,s)=>{b(!0);try{await i(e,{[t]:s}),C({title:"Permissions Updated",description:"Permission '".concat(ec[t]||t,"' for advisor has been ").concat(s?"enabled":"disabled",".")})}catch(e){console.error("Error updating permissions:",e),C({title:"Error",description:e.message||"Failed to update permissions.",variant:"destructive"})}finally{b(!1)}},Y=async()=>{var e,a,r,l,n,i;if(j||h)return;let d=o.trim(),x=m.trim().toLowerCase();if(""===d){C({title:"Error",description:"Advisor name cannot be empty.",variant:"destructive"}),null===(e=T.current)||void 0===e||e.focus();return}if(""===x){C({title:"Error",description:"Advisor email cannot be empty.",variant:"destructive"}),null===(a=k.current)||void 0===a||a.focus();return}if(!x.endsWith("@clark.io")){C({title:"Error",description:"Advisor email must end with @clark.io.",variant:"destructive"}),null===(r=k.current)||void 0===r||r.focus();return}if(t.some(e=>e.name.toLowerCase()===d.toLowerCase())){C({title:"Error",description:"Advisor with this name already exists.",variant:"destructive"}),null===(l=T.current)||void 0===l||l.focus();return}if(t.some(e=>e.email.toLowerCase()===x.toLowerCase())){C({title:"Error",description:"Advisor with this email already exists.",variant:"destructive"}),null===(n=k.current)||void 0===n||n.focus();return}b(!0);try{await s(d,x),c(""),u("")}catch(e){console.error("Error adding advisor:",e),e.message?C({title:"Error",description:e.message,variant:"destructive"}):C({title:"Error",description:"Failed to add advisor.",variant:"destructive"}),null===(i=T.current)||void 0===i||i.focus()}finally{b(!1)}},W=async e=>{if(!j&&!h){w(e),b(!0);try{await l(e)}catch(e){console.error("Error removing advisor:",e),C({title:"Error",description:e.message||"Failed to remove advisor.",variant:"destructive"})}finally{b(!1),w(null)}}},G=e=>{j||(x(e.id),f(e.name),y(e.email))},Q=()=>{x(null),f(""),y(""),setTimeout(()=>{var e;return null===(e=T.current)||void 0===e?void 0:e.focus()},0)},et=async()=>{var e,s,a,r,l,i;if(!h||j)return;let o=p.trim(),d=v.trim().toLowerCase(),c=t.find(e=>e.id===h);if(!c)return;if(""===o){C({title:"Error",description:"Advisor name cannot be empty.",variant:"destructive"}),null===(e=A.current)||void 0===e||e.focus();return}if(""===d){C({title:"Error",description:"Advisor email cannot be empty.",variant:"destructive"}),null===(s=E.current)||void 0===s||s.focus();return}if(!d.endsWith("@clark.io")){C({title:"Error",description:"Advisor email must end with @clark.io.",variant:"destructive"}),null===(a=E.current)||void 0===a||a.focus();return}let m=c.name!==o,u=c.email.toLowerCase()!==d;if(!m&&!u){Q();return}if(t.some(e=>e.id!==h&&e.name.toLowerCase()===o.toLowerCase())){C({title:"Error",description:"Advisor name '".concat(o,"' already exists."),variant:"destructive"}),null===(r=A.current)||void 0===r||r.focus();return}if(t.some(e=>e.id!==h&&e.email.toLowerCase()===d.toLowerCase())){C({title:"Error",description:"Advisor email '".concat(d,"' already exists."),variant:"destructive"}),null===(l=E.current)||void 0===l||l.focus();return}b(!0);try{await n(h,o,d),Q()}catch(e){console.error("Error editing advisor:",e),C({title:"Error",description:e.message||"Failed to save changes.",variant:"destructive"}),null===(i=A.current)||void 0===i||i.focus()}finally{b(!1)}};return(0,a.jsxs)(en,{children:[" ",(0,a.jsxs)(P.Zp,{className:"w-full shadow-lg",children:[(0,a.jsx)(P.aR,{children:(0,a.jsx)(P.ZB,{className:"text-xl font-semibold text-primary",children:"Manage Advisors"})}),(0,a.jsxs)(P.Wu,{children:[(0,a.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,a.jsx)(D,{ref:T,type:"text",placeholder:"New advisor name",value:o,onChange:e=>c(e.target.value),"aria-label":"New advisor name",disabled:j||!!h}),(0,a.jsx)(D,{ref:k,type:"email",placeholder:"New advisor email (@clark.io)",value:m,onChange:e=>u(e.target.value),"aria-label":"New advisor email",disabled:j||!!h,onKeyDown:e=>!j&&!h&&"Enter"===e.key&&Y()}),(0,a.jsxs)(g.$,{onClick:Y,"aria-label":"Add Advisor",variant:"outline",className:"bg-accent text-accent-foreground hover:bg-accent/90 w-full sm:w-auto",disabled:j||!!h,children:[!j||N||h?(0,a.jsx)(I.A,{className:"mr-2 h-4 w-4"}):(0,a.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}),!j||N||h?"Add Advisor":"Adding..."]})]}),(0,a.jsx)(R,{className:"h-[calc(100vh-450px)] min-h-[280px] border rounded-md p-2 bg-secondary/30",children:0===t.length?(0,a.jsx)("p",{className:"text-center text-muted-foreground p-4",children:"No advisors added yet."}):(0,a.jsx)("ul",{className:"space-y-3",children:t.map(e=>{let t=N===e.id,s=h===e.id,r=e.permissions||{};return(0,a.jsx)("li",{className:"p-3 bg-background rounded shadow-sm group space-y-2",children:s?(0,a.jsxs)("div",{className:"flex-grow space-y-2 sm:space-y-0 sm:flex sm:items-center sm:gap-2 mr-2 w-full mb-2 sm:mb-0",children:[(0,a.jsx)(D,{ref:A,type:"text",value:p,onChange:e=>f(e.target.value),className:"h-8 flex-grow",disabled:j&&!s}),(0,a.jsx)(D,{ref:E,type:"email",value:v,onChange:e=>y(e.target.value),className:"h-8 flex-grow",disabled:j&&!s||"active"===e.status,title:"active"===e.status?"Email cannot be changed for active advisors":""}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end sm:justify-start",children:[(0,a.jsx)(g.$,{variant:"ghost",size:"sm",onClick:et,disabled:j&&!s,children:"Save"}),(0,a.jsx)(g.$,{variant:"ghost",size:"sm",onClick:Q,disabled:j&&!s,children:"Cancel"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[(0,a.jsxs)("div",{className:"flex-grow mb-2 sm:mb-0",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:(0,d.cn)("text-foreground font-medium",(t||j&&!s)&&"opacity-50"),children:e.name}),(0,a.jsxs)(ei,{children:[(0,a.jsx)(eo,{asChild:!0,children:"active"===e.status?(0,a.jsx)(O.A,{className:"ml-2 h-4 w-4 text-green-500"}):(0,a.jsx)(M.A,{className:"ml-2 h-4 w-4 text-yellow-500"})}),(0,a.jsx)(ed,{children:(0,a.jsx)("p",{children:"active"===e.status?"Active":"Pending Sign-up"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center text-xs text-muted-foreground mt-1",children:[(0,a.jsx)(F.A,{className:"mr-1.5 h-3 w-3"}),e.email]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 focus-within:opacity-100 transition-opacity self-start sm:self-center",children:[(0,a.jsx)(g.$,{variant:"ghost",size:"icon",onClick:()=>G(e),"aria-label":"Edit ".concat(e.name),className:"text-primary hover:bg-primary/10 h-7 w-7",disabled:j||!!h,children:(0,a.jsx)(U.A,{className:"h-4 w-4"})}),(0,a.jsxs)(z,{children:[(0,a.jsx)(V,{asChild:!0,children:(0,a.jsx)(g.$,{variant:"ghost",size:"icon","aria-label":"Remove ".concat(e.name),className:"text-destructive hover:bg-destructive/10 h-7 w-7",disabled:j||!!h,children:t?(0,a.jsx)(L.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(B.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(Z,{children:[(0,a.jsxs)($,{children:[(0,a.jsx)(H,{children:"Confirm Deletion"}),(0,a.jsxs)(J,{children:["Are you sure you want to remove advisor '$",e.name,"' (",e.email,")?","active"===e.status&&" This advisor has an active account.","This action cannot be undone."]})]}),(0,a.jsxs)(q,{children:[(0,a.jsx)(X,{disabled:j,children:"Cancel"}),(0,a.jsxs)(K,{onClick:()=>W(e.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:j,children:[t?(0,a.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete"]})]})]})]})]})]}),(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-border/40",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,a.jsx)(ee,{id:"top-access-".concat(e.id),checked:!!r.hasTopAccess,onCheckedChange:t=>S(e.id,"hasTopAccess",t),disabled:j}),(0,a.jsx)(er,{htmlFor:"top-access-".concat(e.id),className:"font-semibold text-sm",children:ec.hasTopAccess})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 pl-4 border-l border-border/40 ml-2",children:[em.map(t=>{let s=!!r.hasTopAccess||!!r[t],l=j||!!r.hasTopAccess||!r.hasTopAccess&&em.includes(t),n=r.hasTopAccess?"Enabled by Top Access":"Enabled by default for all users.";return r.hasTopAccess?n="Enabled by Top Access":em.includes(t)&&(n="Enabled by default for all users."),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(ei,{children:[(0,a.jsx)(eo,{asChild:!0,children:(0,a.jsx)(ee,{id:"".concat(t,"-").concat(e.id),checked:s,disabled:l,onCheckedChange:s=>S(e.id,t,s)})}),n&&(0,a.jsx)(ed,{children:(0,a.jsx)("p",{children:n})})]}),(0,a.jsx)(er,{htmlFor:"".concat(t,"-").concat(e.id),className:"text-xs",children:ec[t]||t})]},t)}),eu.map(t=>{let s=!!r.hasTopAccess||!!r[t],l=j||!!r.hasTopAccess,n=r.hasTopAccess?"Enabled by Top Access":"Toggleable advanced permission";return r.hasTopAccess&&(n="Enabled by Top Access"),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(ei,{children:[(0,a.jsx)(eo,{asChild:!0,children:(0,a.jsx)(ee,{id:"".concat(t,"-").concat(e.id),checked:s,disabled:l,onCheckedChange:s=>S(e.id,t,s)})}),n&&(0,a.jsx)(ed,{children:(0,a.jsx)("p",{children:n})})]}),(0,a.jsx)(er,{htmlFor:"".concat(t,"-").concat(e.id),className:"text-xs",children:ec[t]||t})]},t)}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,a.jsxs)(ei,{children:[(0,a.jsx)(eo,{asChild:!0,children:(0,a.jsx)(ee,{id:"canViewAllEvents-".concat(e.id),checked:!!r.canViewAllEvents,onCheckedChange:t=>S(e.id,"canViewAllEvents",t),disabled:j})}),(0,a.jsx)(ed,{children:(0,a.jsx)("p",{children:"Allow this advisor to view all advisors' logged events in the Time Log tab."})})]}),(0,a.jsx)(er,{htmlFor:"canViewAllEvents-".concat(e.id),className:"text-xs",children:ec.canViewAllEvents})]})]})]})]})},e.id)})})})]}),(0,a.jsxs)(P.wL,{className:"text-sm text-muted-foreground pt-4",children:["Total Advisors: ",t.length]})]})]})}var ex=s(3013),ep=s(3343),ef=s(644),ev=s(2873),eg=s(5339);let ey=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,d.cn)("w-full caption-bottom text-sm",s),...r})})});ey.displayName="Table";let ej=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsx)("thead",{ref:t,className:(0,d.cn)("[&_tr]:border-b",s),...l,children:r})});ej.displayName="TableHeader";let eb=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,d.cn)("[&_tr:last-child]:border-0",s),...r})});eb.displayName="TableBody",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,d.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...r})}).displayName="TableFooter";let eN=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tr",{ref:t,className:(0,d.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r})});eN.displayName="TableRow";let ew=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("th",{ref:t,className:(0,d.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...r})});ew.displayName="TableHead";let eC=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("td",{ref:t,className:(0,d.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...r})});eC.displayName="TableCell",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("caption",{ref:t,className:(0,d.cn)("mt-4 text-sm text-muted-foreground",s),...r})}).displayName="TableCaption";var eT=s(5074),ek=s(7150),eA=s(4214),eD=s(9545),eP=s(7381),eE=s(9556),eR=s(4607),eS=s(4548),eL=s(9164),eI=s(3941),eO=s(5119),eM=s(4641);function eF(e){let{loggedEvents:t,advisors:s}=e,l=r.useMemo(()=>{let e={};return s.forEach(t=>{e[t.id]={name:t.name,day:0,week:0,month:0}}),t.forEach(t=>{try{let s=new Date(t.date);if(isNaN(s.getTime())){console.warn("Skipping event with invalid date:",t);return}let a=t.loggedTime||0,r=new Date,l=(0,ef.o)(r),n=(0,eS.k)(r,{weekStartsOn:1}),i=(0,eL.w)(r),o=(0,eI.D)(r),d=(0,eO.$)(r,{weekStartsOn:1}),c=(0,eM.p)(r);if(!e[t.advisorId]){console.warn("Event found for unknown advisor:",t.advisorId);return}(0,ev.v)(s,{start:l,end:o})&&(e[t.advisorId].day+=a),(0,ev.v)(s,{start:n,end:d})&&(e[t.advisorId].week+=a),(0,ev.v)(s,{start:i,end:c})&&(e[t.advisorId].month+=a)}catch(e){console.error("Error processing event date in summary:",t.date,e)}}),e},[t,s]);return(0,a.jsxs)(P.Zp,{className:"w-full shadow-lg",children:[(0,a.jsx)(P.aR,{children:(0,a.jsx)(P.ZB,{className:"text-xl font-semibold text-primary",children:"Time Log Summary"})}),(0,a.jsx)(P.Wu,{children:(0,a.jsx)(R,{className:"h-[300px] border rounded-md",children:(0,a.jsxs)(ey,{children:[(0,a.jsx)(ej,{children:(0,a.jsxs)(eN,{children:[(0,a.jsx)(ew,{className:"w-[200px]",children:"Advisor"}),(0,a.jsx)(ew,{className:"w-[100px] text-right",children:"Today"}),(0,a.jsx)(ew,{className:"w-[100px] text-right",children:"This Week"}),(0,a.jsx)(ew,{className:"w-[100px] text-right",children:"This Month"})]})}),(0,a.jsx)(eb,{children:0===s.length?(0,a.jsx)(eN,{children:(0,a.jsx)(eC,{colSpan:4,className:"h-24 text-center text-muted-foreground",children:"No advisor data to summarize."})}):0===Object.entries(l).length?(0,a.jsx)(eN,{children:(0,a.jsx)(eC,{colSpan:4,className:"h-24 text-center text-muted-foreground",children:"No time logged for the current periods."})}):Object.entries(l).map(e=>{let[t,s]=e;return(0,a.jsxs)(eN,{children:[(0,a.jsx)(eC,{children:s.name}),(0,a.jsxs)(eC,{className:"text-right",children:[s.day," min"]}),(0,a.jsxs)(eC,{className:"text-right",children:[s.week," min"]}),(0,a.jsxs)(eC,{className:"text-right",children:[s.month," min"]})]},t)})})]})})})]})}var eU=s(1920),eB=s(965),e_=s(1011);function eY(e){let{className:t,classNames:s,showOutsideDays:r=!0,...l}=e;return(0,a.jsx)(e_.hv,{showOutsideDays:r,className:(0,d.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,d.cn)((0,g.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,d.cn)((0,g.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{className:t,...s}=e;return(0,a.jsx)(eB.A,{className:(0,d.cn)("h-4 w-4",t),...s})},IconRight:e=>{let{className:t,...s}=e;return(0,a.jsx)(j.A,{className:(0,d.cn)("h-4 w-4",t),...s})}},...l})}eY.displayName="Calendar";var ez=s(547);let eV=ez.bL,eW=ez.l9,eG=r.forwardRef((e,t)=>{let{className:s,align:r="center",sideOffset:l=4,...n}=e;return(0,a.jsx)(ez.ZL,{children:(0,a.jsx)(ez.UC,{ref:t,align:r,sideOffset:l,className:(0,d.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})})});function eZ(e){let{className:t,date:s,onDateChange:r}=e;return(0,a.jsx)("div",{className:(0,d.cn)("grid gap-2",t),children:(0,a.jsxs)(eV,{children:[(0,a.jsx)(eW,{asChild:!0,children:(0,a.jsxs)(g.$,{id:"date",variant:"outline",className:(0,d.cn)("w-[300px] justify-start text-left font-normal",!s&&"text-muted-foreground"),children:[(0,a.jsx)(eU.A,{className:"mr-2 h-4 w-4"}),(null==s?void 0:s.from)?s.to?(0,a.jsxs)(a.Fragment,{children:[(0,ex.GP)(s.from,"LLL dd, y")," - ",(0,ex.GP)(s.to,"LLL dd, y")]}):(0,ex.GP)(s.from,"LLL dd, y"):(0,a.jsx)("span",{children:"Pick a date range"})]})}),(0,a.jsx)(eG,{className:"w-auto p-0",align:"end",children:(0,a.jsx)(eY,{initialFocus:!0,mode:"range",selected:s,onSelect:r,numberOfMonths:2})})]})})}eG.displayName=ez.UC.displayName;var e$=s(9409);let eq=(0,es.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function eH(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,d.cn)(eq({variant:s}),t),...r})}let eJ=()=>(0,ex.GP)(new Date,"yyyy-MM-dd"),eK={Meeting:"bg-blue-500 hover:bg-blue-600",Training:"bg-green-500 hover:bg-green-600",Doctor:"bg-red-500 hover:bg-red-600",Dentist:"bg-purple-500 hover:bg-purple-600","Family care":"bg-yellow-500 hover:bg-yellow-600 text-black",Learning:"bg-indigo-500 hover:bg-indigo-600","Exam/Study":"bg-pink-500 hover:bg-pink-600","Task work":"bg-teal-500 hover:bg-teal-600",Charity:"bg-orange-500 hover:bg-orange-600",Other:"bg-gray-500 hover:bg-gray-600",default:"bg-gray-400 hover:bg-gray-500"},eX=e=>eK[e]||eK.default;function eQ(e){let{events:t,advisors:s,onDeleteEvent:l,onEditEvent:n,deletingId:i,currentUser:o,currentUserIsAdmin:c}=e,[m,u]=(0,r.useState)(""),[h,x]=(0,r.useState)(void 0),[p,f]=(0,r.useState)("all"),[v,y]=(0,r.useState)("date"),[j,b]=(0,r.useState)("desc"),[N,w]=(0,r.useState)(!1),[C,T]=(0,r.useState)(null),k=(0,r.useMemo)(()=>s.reduce((e,t)=>(e[t.id]=t.name,e),{}),[s]),A=(0,r.useMemo)(()=>{let e=t,s=eJ();if(N)e=t.filter(e=>e.date===s);else if((null==h?void 0:h.from)&&(e=e.filter(e=>{try{let t=(0,ep.H)(String(e.date)),s=(0,ef.o)(h.from),a=h.to?(0,ef.o)(h.to):(0,ef.o)(h.from);return a.setHours(23,59,59,999),(0,ev.v)(t,{start:s,end:a})}catch(t){return console.error("Error parsing date or filtering:",e.date,t),!1}})),"all"!==p&&(e=e.filter(e=>e.advisorId===p)),""!==m.trim()){let t=m.toLowerCase();e=e.filter(e=>{var s,a,r;let l=(null===(s=k[e.advisorId])||void 0===s?void 0:s.toLowerCase())||"",n=(null===(a=e.eventType)||void 0===a?void 0:a.toLowerCase())||"",i=(null===(r=e.eventDetails)||void 0===r?void 0:r.toLowerCase())||"",d=c||e.userId===(null==o?void 0:o.uid);return l.includes(t)||n.includes(t)||"Other"===e.eventType&&(d?i:"").includes(t)||"Other"!==e.eventType&&n.includes(t)})}return e},[t,h,p,m,k,N,o,c]),E=(0,r.useMemo)(()=>Array.isArray(A)?[...A].sort((e,t)=>{let s=0;try{switch(v){case"date":let a=(0,ep.H)(String(e.date||"")).getTime(),r=(0,ep.H)(String(t.date||"")).getTime();s=(0,eg.z)(isNaN(a)?0:a,isNaN(r)?0:r);break;case"advisor":let l=k[e.advisorId]||"",n=k[t.advisorId]||"";s=l.localeCompare(n);break;case"eventType":s=String(e.eventType||"").localeCompare(String(t.eventType||""));break;case"loggedTime":s=(e.loggedTime||0)-(t.loggedTime||0)}}catch(s){console.error("Error during sorting:",s,e,t)}return"asc"===j?s:-s}):[],[A,v,j,k]),S=e=>"Other"===e.eventType&&e.eventDetails?c||e.userId===(null==o?void 0:o.uid)?"Other (".concat(e.eventDetails.substring(0,30)).concat(e.eventDetails.length>30?"...":"",")"):"Other [comment hidden]":"string"==typeof e.eventType?e.eventType:"Unknown Event",I=async e=>{if(!i)try{await l(e.id)}catch(e){console.error("Error calling onDeleteEvent from EventList:",e)}},O=e=>{i||n(e)},M=(null==h?void 0:h.from)||"all"!==p||""!==m;return(0,a.jsx)(en,{children:(0,a.jsxs)(P.Zp,{className:"w-full shadow-lg",children:[(0,a.jsxs)(P.aR,{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0 pb-2",children:[(0,a.jsx)(P.ZB,{className:"text-xl font-semibold text-primary",children:"Logged Events"}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-2 flex-wrap",children:[(0,a.jsxs)("div",{className:"relative w-full md:w-auto",children:[(0,a.jsx)(eT.A,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(D,{type:"search",placeholder:"Search events...",className:"pl-8 w-full md:w-[180px]",value:m,onChange:e=>u(e.target.value),disabled:N})]}),(0,a.jsx)(eZ,{date:h,onDateChange:x}),(0,a.jsxs)(e$.l6,{onValueChange:f,value:p,disabled:N,children:[(0,a.jsx)(e$.bq,{className:"w-full md:w-[160px]",children:(0,a.jsx)(e$.yv,{placeholder:"Filter Advisor"})}),(0,a.jsxs)(e$.gC,{children:[(0,a.jsx)(e$.eb,{value:"all",children:"All Advisors"}),s.map(e=>(0,a.jsx)(e$.eb,{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(e$.l6,{onValueChange:e=>y(e),value:v,children:[(0,a.jsxs)(e$.bq,{className:"w-auto",children:[" ",(0,a.jsx)(e$.yv,{placeholder:"Sort by..."})," "]}),(0,a.jsxs)(e$.gC,{children:[(0,a.jsx)(e$.eb,{value:"date",children:"Date"}),(0,a.jsx)(e$.eb,{value:"advisor",children:"Advisor"}),(0,a.jsx)(e$.eb,{value:"eventType",children:"Event Type"}),(0,a.jsx)(e$.eb,{value:"loggedTime",children:"Time Logged"})]})]}),(0,a.jsxs)(g.$,{variant:"outline",size:"icon",onClick:()=>{b(e=>"asc"===e?"desc":"asc")},"aria-label":"Toggle sort direction",children:[" ",(0,a.jsx)(ek.A,{className:"h-4 w-4"})," "]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[N?(0,a.jsxs)(g.$,{variant:"secondary",size:"sm",onClick:()=>{w(!1)},children:[" ",(0,a.jsx)(eA.A,{className:"mr-2 h-4 w-4"})," Show All Logs "]}):(0,a.jsxs)(g.$,{variant:"outline",size:"sm",onClick:()=>{w(!0),x(void 0),f("all"),u("")},children:[" ",(0,a.jsx)(eD.A,{className:"mr-2 h-4 w-4"})," View Today's Logs "]}),M&&!N&&(0,a.jsx)(g.$,{variant:"ghost",size:"sm",onClick:()=>{x(void 0),f("all"),u(""),w(!1)},children:"Clear Filters"})]})]})]}),(0,a.jsxs)(P.Wu,{children:[N&&(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mb-4 italic",children:["Showing all logs for today (",(0,ex.GP)(new Date,"MMM dd, yyyy"),"). Sorting is still applied."]}),(0,a.jsx)(R,{className:"h-[400px] border rounded-md",children:(0,a.jsxs)(ey,{children:[(0,a.jsx)(ej,{className:"sticky top-0 bg-secondary z-10",children:(0,a.jsxs)(eN,{children:[(0,a.jsx)(ew,{className:"w-[110px]",children:"Date"}),(0,a.jsx)(ew,{children:"Advisor"}),(0,a.jsx)(ew,{children:"Event Type / Details"}),(0,a.jsx)(ew,{className:"w-[160px] text-right",children:"Time (24h)"}),(0,a.jsx)(ew,{className:"w-[100px] text-right",children:"Actions"})]})}),(0,a.jsx)(eb,{children:0===E.length?(0,a.jsx)(eN,{children:(0,a.jsx)(eC,{colSpan:5,className:"h-24 text-center text-muted-foreground",children:N?"No events logged today yet.":M?"No events found for the selected filters.":"No events logged yet."})}):E.map(e=>{let t=i===e.id,s=S(e),r=C===e.id,l=e.eventDetails||"",n="Other"===e.eventType&&l.length>70,m=c||o&&e.userId===o.uid;return(0,a.jsxs)(eN,{className:(0,d.cn)(t&&"opacity-50"),children:[(0,a.jsxs)(eC,{children:[" ",e.date?(0,ex.GP)((0,ep.H)(String(e.date)),"MMM dd, yyyy"):"Invalid Date"," "]}),(0,a.jsx)(eC,{children:k[e.advisorId]||"Unknown Advisor"}),(0,a.jsx)(eC,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)(eH,{className:(0,d.cn)("text-white",eX(e.eventType)),children:"string"==typeof e.eventType?e.eventType:"N/A"}),"Other"===e.eventType&&e.eventDetails&&(0,a.jsx)("div",{className:"mt-1 text-xs text-muted-foreground",children:m?(0,a.jsxs)(a.Fragment,{children:[r?e.eventDetails:"".concat(e.eventDetails.substring(0,70)).concat(n?"...":""),n&&(0,a.jsxs)(g.$,{variant:"link",size:"sm",className:"p-0 h-auto ml-1 text-blue-500",onClick:()=>T(r?null:e.id),children:[r?"Read less":"Read more",r?(0,a.jsx)(eP.A,{className:"h-3 w-3 ml-1"}):(0,a.jsx)(eE.A,{className:"h-3 w-3 ml-1"})]})]}):(0,a.jsxs)("span",{className:"italic flex items-center",children:[(0,a.jsx)(eR.A,{className:"h-3 w-3 mr-1 text-gray-400"})," Comment hidden"]})})]})}),(0,a.jsx)(eC,{className:"text-right",children:e.startTime&&e.endTime?"".concat(e.startTime," - ").concat(e.endTime):"".concat(e.loggedTime," min")}),(0,a.jsxs)(eC,{className:"text-right space-x-1",children:[(0,a.jsxs)(ei,{children:[(0,a.jsx)(eo,{asChild:!0,children:(0,a.jsx)(g.$,{variant:"ghost",size:"icon",className:"text-primary hover:bg-primary/10 h-8 w-8",onClick:()=>O(e),disabled:!!i,"aria-label":"Edit Event",children:(0,a.jsx)(U.A,{className:"h-4 w-4"})})}),(0,a.jsx)(ed,{children:(0,a.jsx)("p",{children:"Edit Event"})})]}),(0,a.jsxs)(z,{children:[(0,a.jsx)(V,{asChild:!0,children:(0,a.jsx)(g.$,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10 h-8 w-8",disabled:!!i,"aria-label":"Delete Event",children:t?(0,a.jsx)(L.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(B.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(Z,{children:[(0,a.jsxs)($,{children:[(0,a.jsx)(H,{children:"Are you absolutely sure?"}),(0,a.jsxs)(J,{children:[' This action cannot be undone. This will permanently delete the event: "',(0,a.jsx)("span",{className:"font-semibold",children:s}),'". ']})]}),(0,a.jsxs)(q,{children:[(0,a.jsx)(X,{disabled:t,children:"Cancel"}),(0,a.jsxs)(K,{onClick:()=>I(e),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:t,children:[t?(0,a.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):null," Delete"]})]})]})]})]})]},e.id)})})]})}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(eF,{loggedEvents:E,advisors:s})})]})]})})}let e0=["Meeting","Training","Doctor","Dentist","Family care","Learning","Exam/Study","Task work","Charity","Other"];var e2=s(2177),e1=s(221),e4=s(5594),e5=s(3915),e3=s(8539),e6=s(9708);let e9=e2.Op,e8=r.createContext({}),e7=e=>{let{...t}=e;return(0,a.jsx)(e8.Provider,{value:{name:t.name},children:(0,a.jsx)(e2.xI,{...t})})},te=()=>{let e=r.useContext(e8),t=r.useContext(tt),{getFieldState:s,formState:a}=(0,e2.xW)(),l=s(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:n}=t;return{id:n,name:e.name,formItemId:"".concat(n,"-form-item"),formDescriptionId:"".concat(n,"-form-item-description"),formMessageId:"".concat(n,"-form-item-message"),...l}},tt=r.createContext({}),ts=r.forwardRef((e,t)=>{let{className:s,...l}=e,n=r.useId();return(0,a.jsx)(tt.Provider,{value:{id:n},children:(0,a.jsx)("div",{ref:t,className:(0,d.cn)("space-y-2",s),...l})})});ts.displayName="FormItem";let ta=r.forwardRef((e,t)=>{let{className:s,...r}=e,{error:l,formItemId:n}=te();return(0,a.jsx)(er,{ref:t,className:(0,d.cn)(l&&"text-destructive",s),htmlFor:n,...r})});ta.displayName="FormLabel";let tr=r.forwardRef((e,t)=>{let{...s}=e,{error:r,formItemId:l,formDescriptionId:n,formMessageId:i}=te();return(0,a.jsx)(e6.DX,{ref:t,id:l,"aria-describedby":r?"".concat(n," ").concat(i):"".concat(n),"aria-invalid":!!r,...s})});tr.displayName="FormControl",r.forwardRef((e,t)=>{let{className:s,...r}=e,{formDescriptionId:l}=te();return(0,a.jsx)("p",{ref:t,id:l,className:(0,d.cn)("text-sm text-muted-foreground",s),...r})}).displayName="FormDescription";let tl=r.forwardRef((e,t)=>{var s;let{className:r,children:l,...n}=e,{error:i,formMessageId:o}=te(),c=i?String(null!==(s=null==i?void 0:i.message)&&void 0!==s?s:""):l;return c?(0,a.jsx)("p",{ref:t,id:o,className:(0,d.cn)("text-sm font-medium text-destructive",r),...n,children:c}):null});tl.displayName="FormMessage";var tn=s(960),ti=s(5318),to=s(9119),td=s(4301);let tc=e4.Ik({date:e4.p6({required_error:"A date is required."}),advisorId:e4.Yj({required_error:"Please select an advisor."}).min(1,"Please select an advisor."),eventType:e4.k5(e0,{required_error:"Please select an event type."}),eventDetails:e4.Yj().optional(),startTime:e4.Yj({required_error:"Start time is required."}).regex(/^\d{2}:\d{2}$/,"Invalid start time"),endTime:e4.Yj({required_error:"End time is required."}).regex(/^\d{2}:\d{2}$/,"Invalid end time")}).refine(e=>"Other"!==e.eventType||!!e.eventDetails&&"string"==typeof e.eventDetails&&e.eventDetails.trim().length>0,{message:"Please provide details for the 'Other' event type.",path:["eventDetails"]}).refine(e=>{let[t,s]=e.startTime.split(":").map(Number),[a,r]=e.endTime.split(":").map(Number);return 60*a+r>60*t+s},{message:"End time must be after start time.",path:["endTime"]}),tm={date:void 0,advisorId:"",eventType:e0[0],eventDetails:"",startTime:"09:00",endTime:"09:30"};function tu(e){let{advisors:t,onLogEvent:s,onUpdateEvent:l,onCancelEdit:n,eventToEdit:i,isSubmitting:o}=e,{toast:c}=(0,_.dj)(),m=!!i,u=e=>"string"==typeof e&&e0.includes(e)?e:(m&&e&&!e0.includes(e)&&console.warn("Invalid event type '".concat(e,"' provided for editing. Defaulting to 'Other'.")),"Other"),h=(0,e2.mN)({resolver:(0,e1.u)(tc),defaultValues:i?{date:(0,ep.H)(i.date),advisorId:i.advisorId,eventType:u(i.eventType),eventDetails:i.eventDetails||"",startTime:i.startTime||"09:00",endTime:i.endTime||"09:30"}:{...tm,date:new Date},mode:"onChange"}),x=h.watch("eventType");async function p(e){if(!(e.date instanceof Date)||isNaN(e.date.getTime())){c({title:"Invalid Date",description:"Please select a valid date.",variant:"destructive"});return}let[t,a]=e.startTime.split(":").map(Number),[r,n]=e.endTime.split(":").map(Number),o={date:(0,ex.GP)(e.date,"yyyy-MM-dd"),advisorId:e.advisorId,eventType:e.eventType,eventDetails:"Other"===e.eventType?(e.eventDetails||"").trim():null,loggedTime:60*r+n-(60*t+a),startTime:e.startTime,endTime:e.endTime};try{m&&i?(await l(i.id,o),c({title:"Success",description:"Event updated successfully."})):(await s(o),c({title:"Success",description:"Time logged successfully."}),h.reset({...tm,date:new Date}))}catch(t){console.error("Error ".concat(m?"updating":"submitting"," time log from form:"),t);let e="Failed to ".concat(m?"update":"log"," event. Please try again.");t instanceof e5.g?e=t.message:t instanceof Error&&(e=t.message),c({title:"Error",description:e,variant:"destructive"})}}return(0,r.useEffect)(()=>{i?h.reset({date:(0,ep.H)(i.date),advisorId:i.advisorId,eventType:u(i.eventType),eventDetails:i.eventDetails||"",startTime:i.startTime||"09:00",endTime:i.endTime||"09:30"}):h.reset({...tm,date:new Date})},[i,h]),(0,a.jsxs)(P.Zp,{id:"time-log-form-card",className:"w-full shadow-lg mb-6",children:[(0,a.jsx)(P.aR,{children:(0,a.jsx)(P.ZB,{className:"text-xl font-semibold text-primary",children:m?"Edit Time Entry":"Log New Time Entry"})}),(0,a.jsx)(P.Wu,{children:(0,a.jsx)(e9,{...h,children:(0,a.jsxs)("form",{onSubmit:h.handleSubmit(p),className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(e7,{control:h.control,name:"date",render:e=>{let{field:t}=e;return(0,a.jsxs)(ts,{className:"flex flex-col",children:[(0,a.jsx)(ta,{children:"Date"}),(0,a.jsxs)(eV,{children:[(0,a.jsx)(eW,{asChild:!0,children:(0,a.jsx)(tr,{children:(0,a.jsxs)(g.$,{variant:"outline",disabled:o,className:(0,d.cn)("w-full justify-start text-left font-normal",!(t.value instanceof Date)&&"text-muted-foreground"),children:[(0,a.jsx)(eU.A,{className:"mr-2 h-4 w-4"}),t.value instanceof Date&&!isNaN(t.value.getTime())?(0,ex.GP)(t.value,"PPP"):(0,a.jsx)("span",{children:"Pick a date"})]})})}),(0,a.jsx)(eG,{className:"w-auto p-0",align:"start",children:(0,a.jsx)(eY,{mode:"single",selected:t.value instanceof Date?t.value:void 0,onSelect:t.onChange,disabled:e=>e<new Date("1900-01-01")||o,initialFocus:!0})})]}),(0,a.jsx)(tl,{})]})}}),(0,a.jsx)(e7,{control:h.control,name:"advisorId",render:e=>{let{field:s}=e;return(0,a.jsxs)(ts,{children:[(0,a.jsx)(ta,{children:"Advisor"}),(0,a.jsxs)(e$.l6,{onValueChange:s.onChange,value:s.value||"",disabled:o,children:[(0,a.jsx)(tr,{children:(0,a.jsx)(e$.bq,{children:(0,a.jsx)(e$.yv,{placeholder:"Select an advisor"})})}),(0,a.jsx)(e$.gC,{children:0===t.length?(0,a.jsx)(e$.eb,{value:"-",disabled:!0,children:"No advisors available"}):t.map(e=>(0,a.jsx)(e$.eb,{value:e.id,children:e.name},e.id))})]}),(0,a.jsx)(tl,{})]})}})]}),(0,a.jsxs)("div",{className:(0,d.cn)("grid grid-cols-1 gap-4","Other"===x?"":"md:grid-cols-2"),children:[(0,a.jsx)(e7,{control:h.control,name:"eventType",render:e=>{let{field:t}=e;return(0,a.jsxs)(ts,{children:[(0,a.jsx)(ta,{children:"Event Type"}),(0,a.jsxs)(e$.l6,{onValueChange:t.onChange,value:t.value,disabled:o,children:[(0,a.jsx)(tr,{children:(0,a.jsxs)(e$.bq,{children:[(0,a.jsx)(tn.A,{className:"mr-2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(e$.yv,{placeholder:"Select event type"})]})}),(0,a.jsx)(e$.gC,{children:e0.map(e=>(0,a.jsx)(e$.eb,{value:e,children:e},e))})]}),(0,a.jsx)(tl,{})]})}}),(0,a.jsx)(e7,{control:h.control,name:"startTime",render:e=>{let{field:t}=e;return(0,a.jsxs)(ts,{children:[(0,a.jsx)(ta,{children:"Start Time"}),(0,a.jsx)(tr,{children:(0,a.jsx)("input",{type:"time",step:"60",...t,className:"w-full border rounded px-2 py-1",disabled:o})}),(0,a.jsx)(tl,{})]})}}),(0,a.jsx)(e7,{control:h.control,name:"endTime",render:e=>{let{field:t}=e;return(0,a.jsxs)(ts,{children:[(0,a.jsx)(ta,{children:"End Time"}),(0,a.jsx)(tr,{children:(0,a.jsx)("input",{type:"time",step:"60",...t,className:"w-full border rounded px-2 py-1",disabled:o})}),(0,a.jsx)(tl,{})]})}})]}),"Other"===x&&(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,a.jsx)(e7,{control:h.control,name:"eventDetails",render:e=>{let{field:t}=e;return(0,a.jsxs)(ts,{className:"md:col-span-1",children:[(0,a.jsx)(ta,{children:'Details for "Other"'}),(0,a.jsx)(tr,{children:(0,a.jsx)(e3.T,{placeholder:"Please specify the details for the 'Other' event...",...t,value:t.value||"",disabled:o,rows:3})}),(0,a.jsx)(tl,{})]})}})}),(0,a.jsxs)(P.wL,{className:(0,d.cn)("p-0 pt-4 flex gap-2",m?"justify-between":"justify-end"),children:[m&&(0,a.jsxs)(g.$,{type:"button",variant:"outline",onClick:n,disabled:o,children:[(0,a.jsx)(ti.A,{className:"mr-2 h-4 w-4"})," Cancel"]}),(0,a.jsxs)(g.$,{type:"submit",className:(0,d.cn)("bg-accent text-accent-foreground hover:bg-accent/90",m?"":"w-full"),disabled:0===t.length&&!m||o,children:[o?(0,a.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):m?(0,a.jsx)(to.A,{className:"mr-2 h-4 w-4"}):(0,a.jsx)(td.A,{className:"mr-2 h-4 w-4"}),o?m?"Saving...":"Logging...":m?"Save Changes":"Log Time"]})]}),0===t.length&&!m&&(0,a.jsx)("p",{className:"text-sm text-destructive text-center mt-2",children:"Please add an advisor before logging time."})]})})})]})}var th=s(8816),tx=s(1407),tp=s(4376),tf=s(408),tv=s.n(tf),tg=s(2699),ty=s.n(tg),tj=s(7489);let tb=r.forwardRef((e,t)=>{let{className:s,orientation:r="horizontal",decorative:l=!0,...n}=e;return(0,a.jsx)(tj.b,{ref:t,decorative:l,orientation:r,className:(0,d.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",s),...n})});tb.displayName=tj.b.displayName;var tN=s(6861),tw=s(8718),tC=s(4065),tT=s(2502);tT.t1.register(tT.PP,tT.kc,tT.E8,tT.hE,tT.m_,tT.s$,tT.Bs,tT.FN,tT.No,tT.dN);let tk=r.forwardRef((e,t)=>{let{advisorTimeData:s,advisorTimeBreakdownData:r,timeTrendData:l,currentFiltersText:n}=e,i={responsive:!0,maintainAspectRatio:!1,animation:{duration:0},plugins:{legend:{position:"top"},title:{display:!1}}};return(0,a.jsxs)("div",{ref:t,className:"bg-white text-black p-6 shadow-lg grid grid-cols-2 grid-rows-[auto_1fr_1fr] gap-6",style:{width:"".concat(1200,"px"),height:"".concat(750,"px")},children:[(0,a.jsxs)("div",{className:"col-span-2 border-b pb-4 mb-2",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-center mb-2",children:"Time Log Visualization"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 text-center",children:n})]}),(0,a.jsxs)("div",{className:"border rounded-lg p-4 flex flex-col",style:{height:"300px"},children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-center mb-2",children:"Time Logged Per Advisor"}),(0,a.jsx)("div",{className:"flex-grow relative",children:s&&s.datasets.length>0?(0,a.jsx)(tC.yP,{data:s,options:i}):(0,a.jsx)("p",{className:"text-center text-gray-500",children:"No data"})})]}),(0,a.jsxs)("div",{className:"border rounded-lg p-4 flex flex-col",style:{height:"300px"},children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-center mb-2",children:"Time Breakdown by Advisor"}),(0,a.jsx)("div",{className:"flex-grow relative flex justify-center items-center",children:r&&r.datasets.length>0?(0,a.jsx)("div",{className:"relative w-full h-full max-w-[250px] max-h-[250px]",children:(0,a.jsx)(tC.nu,{data:r,options:{...i,maintainAspectRatio:!0}})}):(0,a.jsx)("p",{className:"text-center text-gray-500",children:"No data"})})]}),(0,a.jsxs)("div",{className:"col-span-2 border rounded-lg p-4 flex flex-col",style:{height:"300px"},children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-center mb-2",children:"Daily Time Log Trend"}),(0,a.jsx)("div",{className:"flex-grow relative",children:l&&l.datasets.length>0?(0,a.jsx)(tC.N1,{data:l,options:i}):(0,a.jsx)("p",{className:"text-center text-gray-500",children:"No data"})})]})]})});tk.displayName="ExportVisualizationLayout";var tA=s(2834);tT.t1.register(tT.PP,tT.kc,tT.E8,tT.hE,tT.m_,tT.s$,tT.Bs,tT.FN,tT.No,tT.dN,tA.A);let tD=[{label:"Today",value:"day"},{label:"This Week",value:"week"},{label:"Last 7 Days",value:"last7"},{label:"Last 30 Days",value:"last30"},{label:"This Month",value:"month"},{label:"This Year",value:"year"},{label:"Custom",value:"custom"}],tP=e=>{let t=tD.find(t=>t.value===e);return t?t.label:"Unknown"},tE=e=>{if(!e||!e.from)return"Not Set";let t=(0,ex.GP)(e.from,"dd/MM/yyyy"),s=e.to?(0,ex.GP)(e.to,"dd/MM/yyyy"):t;return t===s?t:"".concat(t," - ").concat(s)},tR=e=>{if(e<0)return"0 min";let t=Math.floor(e/60),s=e%60,a="";return t>0?(a+="".concat(t,"h"),s>0&&(a+=" ".concat(s,"m"))):a+="".concat(s,"m"),"".concat(e," min").concat(t>0?" (".concat(a,")"):"")};function tS(e){let{loggedEvents:t,advisors:s}=e,l=(0,r.useRef)(null),[n,i]=(0,r.useState)("week"),[o,c]=(0,r.useState)(void 0),[m,u]=(0,r.useState)("all"),[h,x]=(0,r.useState)("all"),[p,f]=(0,r.useState)(!1),[y,j]=(0,r.useState)(!1),{resolvedTheme:b}=(0,v.D)(),N=(0,r.useMemo)(()=>s.reduce((e,t)=>(e[t.id]=t.name,e),{}),[s]),w=(0,r.useMemo)(()=>{let e=new Set;return t.forEach(t=>{t.eventType&&"string"==typeof t.eventType&&""!==t.eventType.trim()&&e.add(t.eventType.trim())}),Array.from(e).sort()},[t]),C=(0,r.useMemo)(()=>{let e,s=t,a=new Date,r=(0,eI.D)(a);return"day"===n?e=(0,ef.o)(a):"week"===n?(e=(0,eS.k)(a,{weekStartsOn:1}),r=(0,eO.$)(a,{weekStartsOn:1})):"last7"===n?e=(0,ef.o)((0,th.e)(a,6)):"last30"===n?e=(0,ef.o)((0,th.e)(a,29)):"month"===n?(e=(0,eL.w)(a),r=(0,eM.p)(a)):"year"===n?(e=(0,tx.D)(a),r=(0,tp.Q)(a)):"custom"===n&&(null==o?void 0:o.from)&&(e=(0,ef.o)(o.from),r=o.to?(0,eI.D)(o.to):(0,eI.D)(o.from)),e&&r&&(s=s.filter(t=>{try{let s=(0,ep.H)(t.date);if(isNaN(s.getTime()))return!1;return(0,ev.v)(s,{start:e,end:r})}catch(e){return console.error("Error parsing event date or checking interval:",t.date,e),!1}})),"all"!==m&&(s=s.filter(e=>e.advisorId===m)),"all"!==h&&(s=s.filter(e=>e.eventType===h)),s},[t,n,o,m,h]),T=(0,r.useMemo)(()=>{if(0===C.length)return{labels:[],datasets:[]};let e={};return C.forEach(t=>{e[t.advisorId]||(e[t.advisorId]=0),e[t.advisorId]+=t.loggedTime}),{labels:Object.keys(e).map(e=>N[e]||"Unknown Advisor"),datasets:[{label:"Time Logged (minutes)",data:Object.values(e),backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]}},[C,N]),k=(0,r.useMemo)(()=>{if(0===C.length)return{labels:[],datasets:[]};let e={};C.forEach(t=>{e[t.advisorId]||(e[t.advisorId]=0),e[t.advisorId]+=t.loggedTime});let t=Object.keys(e).map(e=>N[e]||"Unknown Advisor"),s=Object.values(e),a=["#a1c9f4","#ffb482","#8de5a1","#ff9f9b","#d0bbff","#fcfcd4","#c7ceff","#f9c0c0","#b5e8d8"],r=t.map((e,t)=>a[t%a.length]);return{labels:t,datasets:[{label:"Time Logged (minutes)",data:s,backgroundColor:r,borderColor:"transparent",borderWidth:2}]}},[C,N]),A=(0,r.useMemo)(()=>{if(0===C.length)return{labels:[],datasets:[]};let e={};[...C].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()).forEach(t=>{let s=t.date;e[s]||(e[s]=0),e[s]+=t.loggedTime});let t=Object.keys(e).sort((e,t)=>new Date(e).getTime()-new Date(t).getTime()),s=t.map(e=>(0,ex.GP)((0,ep.H)(e),"dd MMM"));return{labels:s,datasets:[{label:"Time Logged Daily (minutes)",data:t.map(t=>e[t]),borderColor:"dark"===b?"rgba(54, 162, 235, 0.8)":"rgba(54, 162, 235, 1)",backgroundColor:"dark"===b?"rgba(54, 162, 235, 0.3)":"rgba(54, 162, 235, 0.2)",fill:!0,tension:.1}]}},[C,b]),D=(0,r.useMemo)(()=>{let e=tP(n),t="custom"===n?tE(o):e,s="all"===m?"All Advisors":N[m]||"Unknown",a="all"===h?"All Event Types":h;return"Filters Active: Date Range: ".concat(t," | Advisor: ").concat(s," | Event Type: ").concat(a)},[n,o,m,h,N]),E="week"!==n||"all"!==m||"all"!==h,R=async()=>{p||(f(!0),j(!0),setTimeout(async()=>{if(l.current)try{let e=(await ty()(l.current,{scale:2,logging:!1,useCORS:!0,backgroundColor:"dark"===b?"#1a1a1a":"#ffffff",onclone:e=>{e.querySelectorAll("canvas").forEach(e=>{let t=tT.t1.getChart(e);if(t){var s;"bar"===t.config.type&&(null===(s=t.options.plugins)||void 0===s?void 0:s.datalabels)&&(t.options.plugins.datalabels.display=!1,t.update("none"))}})}})).toDataURL("image/png"),t=document.createElement("a");t.href=e;let s="all"===m?"all_advisors":(N[m]||"unknown").replace(/\s+/g,"_").toLowerCase(),a="all"===h?"all_events":"string"==typeof h?h.replace(/[^a-z0-9]/gi,"_").toLowerCase():"unknown_event",r=("custom"===n?tE(o).replace(/\s*-\s*/g,"_"):tP(n)).replace(/[^a-z0-9_]/gi,"_").toLowerCase();t.download="viz_".concat(s,"_").concat(a,"_").concat(r,"_").concat((0,ex.GP)(new Date,"yyyyMMddHHmm"),".png"),document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(e){console.error("Error exporting visualization:",e)}finally{j(!1),f(!1)}else console.error("Export layout ref not found."),j(!1),f(!1)},200))},S=(0,r.useMemo)(()=>{var e;return{responsive:!0,maintainAspectRatio:!0,animation:{duration:300},scales:{x:{ticks:{color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)"},grid:{color:"dark"===b?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}},y:{beginAtZero:!0,suggestedMax:1.25*Math.max(...(null===(e=T.datasets[0])||void 0===e?void 0:e.data)||[0]),ticks:{color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)"},grid:{color:"dark"===b?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}}},plugins:{legend:{display:!0,position:"top",labels:{color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)"}},tooltip:{enabled:!0},datalabels:{display:!0,anchor:"end",align:"top",color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)",font:{weight:"bold",size:12},formatter:e=>e<=0?null:tR(e),offset:4,padding:0}}}},[b,T]),I=(0,r.useMemo)(()=>({responsive:!0,maintainAspectRatio:!1,animation:{duration:300},plugins:{legend:{position:"top",labels:{color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)"}},tooltip:{enabled:!0}}}),[b]),O=(0,r.useMemo)(()=>({responsive:!0,maintainAspectRatio:!0,animation:{duration:300},scales:{x:{ticks:{color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)"},grid:{color:"dark"===b?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}},y:{ticks:{color:"dark"===b?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)"},grid:{color:"dark"===b?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}}},plugins:{legend:{display:!1},tooltip:{enabled:!0}}}),[b]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(P.Zp,{className:"w-full shadow-lg",children:[(0,a.jsxs)(P.aR,{className:"pb-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4",children:[(0,a.jsx)(P.ZB,{className:"text-xl font-semibold text-primary mb-2 sm:mb-0",children:"Visualizations"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 self-end sm:self-center",children:[(0,a.jsxs)(g.$,{variant:"ghost",size:"sm",onClick:()=>{i("week"),c(void 0),u("all"),x("all")},disabled:!E||p,"aria-label":"Clear Filters",className:(0,d.cn)(!E&&"text-muted-foreground"),children:[(0,a.jsx)(tN.A,{className:"mr-2 h-4 w-4"})," Clear"]}),(0,a.jsxs)(g.$,{variant:"outline",size:"sm",onClick:R,disabled:p||0===C.length,"aria-label":"Export Visualizations as PNG",children:[p?(0,a.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(tw.A,{className:"mr-2 h-4 w-4"})," Export PNG"]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Date Range"}),(0,a.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:tD.map(e=>(0,a.jsx)(g.$,{variant:n===e.value?"secondary":"outline",size:"sm",onClick:()=>i(e.value),className:(0,d.cn)("h-8","custom"===n&&"custom"===e.value&&"ring-2 ring-primary"),children:e.label},e.value))}),"custom"===n&&(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(eZ,{date:o,onDateChange:c})})]}),(0,a.jsx)("div",{className:"flex flex-col md:flex-row md:items-end gap-3",children:(0,a.jsxs)("div",{className:"flex-grow flex flex-col sm:flex-row gap-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-[160px]",children:[(0,a.jsx)("label",{htmlFor:"event-type-filter",className:"text-sm font-medium block mb-1.5",children:"Event Type"}),(0,a.jsxs)(e$.l6,{onValueChange:x,value:h,children:[(0,a.jsx)(e$.bq,{id:"event-type-filter",className:"w-full",children:(0,a.jsx)(e$.yv,{placeholder:"Filter by Event Type"})}),(0,a.jsxs)(e$.gC,{children:[(0,a.jsx)(e$.eb,{value:"all",children:"All Event Types"}),w.map(e=>(0,a.jsx)(e$.eb,{value:e,children:e},e))]})]})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-[160px]",children:[(0,a.jsx)("label",{htmlFor:"advisor-filter",className:"text-sm font-medium block mb-1.5",children:"Advisor"}),(0,a.jsxs)(e$.l6,{onValueChange:u,value:m,children:[(0,a.jsx)(e$.bq,{id:"advisor-filter",className:"w-full",children:(0,a.jsx)(e$.yv,{placeholder:"Filter by Advisor"})}),(0,a.jsxs)(e$.gC,{children:[(0,a.jsx)(e$.eb,{value:"all",children:"All Advisors"}),s.map(e=>(0,a.jsx)(e$.eb,{value:e.id,children:e.name},e.id))]})]})]})]})})]}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground pt-3 mt-4 border-t border-dashed",children:D})]}),(0,a.jsx)(P.Wu,{className:"space-y-8 pt-6",children:0===C.length?(0,a.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"No data available for the selected filters."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{id:"advisor-time-bar-chart",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-center mb-4",children:"Time Logged Per Advisor"}),(0,a.jsx)(tC.yP,{id:"advisor-time-bar-chart-canvas",data:T,options:S})]}),(0,a.jsx)(tb,{}),(0,a.jsxs)("div",{id:"advisor-time-doughnut-chart",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-center mb-4",children:"Advisor Time Distribution"}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("div",{className:"relative h-64 w-64 md:h-80 md:w-80",children:(0,a.jsx)(tC.nu,{data:k,options:I})})})]}),(0,a.jsx)(tb,{}),(0,a.jsxs)("div",{id:"daily-time-trend-line-chart",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-center mb-4",children:"Daily Time Log Trend"}),(0,a.jsx)(tC.N1,{data:A,options:O})]})]})})]}),y&&(0,a.jsx)("div",{style:{position:"absolute",top:"-9999px",left:"-9999px",zIndex:-10},children:(0,a.jsx)(tk,{ref:l,advisorTimeData:T,advisorTimeBreakdownData:k,timeTrendData:A,currentFiltersText:D})})]})}let tL=[{label:"Today",value:"day"},{label:"This Week",value:"week"},{label:"Last 7 Days",value:"last7"},{label:"Last 30 Days",value:"last30"},{label:"This Month",value:"month"},{label:"This Year",value:"year"},{label:"All Time",value:"all"},{label:"Custom",value:"custom"}],tI=e=>{let t=tL.find(t=>t.value===e);return t?t.label:"Unknown"},tO=e=>{if(!e||!e.from)return"Not Set";let t=(0,ex.GP)(e.from,"dd/MM/yyyy"),s=e.to?(0,ex.GP)(e.to,"dd/MM/yyyy"):t;return t===s?t:"".concat(t," - ").concat(s)},tM=["#a1c9f4","#ffb482","#8de5a1","#ff9f9b","#d0bbff","#fcfcd4","#c7ceff","#f9c0c0","#b5e8d8"],tF=e=>tM[e%tM.length];function tU(e){let{loggedEvents:t,advisors:s,advisorId:l}=e,[n,i]=(0,r.useState)("week"),[o,c]=(0,r.useState)(void 0),[m,u]=(0,r.useState)("all"),[h,x]=(0,r.useState)("all"),[p,f]=(0,r.useState)(!1),[y,j]=r.useState(!1),b=(0,r.useMemo)(()=>s.reduce((e,t)=>(e[t.id]=t.name,e),{}),[s]),N=(0,r.useMemo)(()=>{let e=new Set;return t.forEach(t=>{t.eventType&&"string"==typeof t.eventType&&""!==t.eventType.trim()&&e.add(t.eventType.trim())}),Array.from(e).sort()},[t]),w=(0,r.useMemo)(()=>{let e,s=t,a=new Date,r=(0,eI.D)(a);return"day"===n?e=(0,ef.o)(a):"week"===n?(e=(0,eS.k)(a,{weekStartsOn:1}),r=(0,eO.$)(a,{weekStartsOn:1})):"last7"===n?e=(0,ef.o)((0,th.e)(a,6)):"last30"===n?e=(0,ef.o)((0,th.e)(a,29)):"month"===n?(e=(0,eL.w)(a),r=(0,eM.p)(a)):"year"===n?(e=(0,tx.D)(a),r=(0,tp.Q)(a)):"custom"===n&&(null==o?void 0:o.from)?(e=(0,ef.o)(o.from),r=o.to?(0,eI.D)(o.to):(0,eI.D)(o.from)):"all"===n&&(e=void 0,r=void 0),e&&r&&(s=s.filter(t=>{try{let s=(0,ep.H)(t.date);if(isNaN(s.getTime()))return!1;return(0,ev.v)(s,{start:e,end:r})}catch(e){return console.error("Error parsing event date or checking interval:",t.date,e),!1}})),"all"!==m&&(s=s.filter(e=>e.advisorId===m)),"all"!==h&&(s=s.filter(e=>e.eventType===h)),s.sort((e,t)=>(0,ep.H)(t.date).getTime()-(0,ep.H)(e.date).getTime())},[t,n,o,m,h]),C="week"!==n||"all"!==m||"all"!==h,T=(0,r.useMemo)(()=>{let e=tI(n),t="custom"===n?tO(o):e,s="all"===m?"All Advisors":b[m]||"Unknown",a="all"===h?"All Event Types":h;return"Filters Active: Date: ".concat(t," | Advisor: ").concat(s," | Event Type: ").concat(a)},[n,o,m,h,b]),k=async e=>{if(!p&&0!==w.length){f(!0);try{let t={totalTimeLogged:w.reduce((e,t)=>e+t.loggedTime,0),averageTimePerEvent:0,mostCommonEventType:"",totalEvents:w.length,timeByEventType:{},timeByAdvisor:{}},s={};switch(w.forEach(e=>{t.timeByEventType[e.eventType]||(t.timeByEventType[e.eventType]=0),t.timeByEventType[e.eventType]+=e.loggedTime,t.timeByAdvisor[e.advisorId]||(t.timeByAdvisor[e.advisorId]=0),t.timeByAdvisor[e.advisorId]+=e.loggedTime,s[e.eventType]=(s[e.eventType]||0)+1}),t.averageTimePerEvent=t.totalTimeLogged/t.totalEvents,t.mostCommonEventType=Object.entries(s).sort((e,t)=>{let[,s]=e,[,a]=t;return a-s})[0][0],e){case"csv":!function(e,t){let s=e.map(e=>({Date:(0,ex.GP)((0,ep.H)(e.date),"yyyy-MM-dd"),Advisor:b[e.advisorId]||"Unknown",EventType:e.eventType||"N/A",LoggedTimeMinutes:e.loggedTime,Notes:e.eventDetails||""})),a=new Blob([tv().unparse(s,{header:!0})],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(a),r.setAttribute("download","report_export_".concat(Date.now(),".csv")),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href)}(w,0);break;case"json":!function(e,t){let s=new Blob([JSON.stringify({summary:t,events:e},null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(s),a.setAttribute("download","report_export_".concat(Date.now(),".json")),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href)}(w,t)}}catch(e){console.error("Error generating export:",e),(0,_.oR)({title:"Export Error",description:"Failed to generate export. Please try again.",variant:"destructive"})}finally{f(!1)}}},A=(0,r.useMemo)(()=>{var e;let t=w.reduce((e,t)=>e+t.loggedTime,0),s=w.length,a={},r={},l={};return w.forEach(e=>{a[e.eventType]=(a[e.eventType]||0)+1,r[e.eventType]=(r[e.eventType]||0)+e.loggedTime,l[e.advisorId]=(l[e.advisorId]||0)+e.loggedTime}),{totalTimeLogged:t,averageTimePerEvent:s>0?t/s:0,mostCommonEventType:(null===(e=Object.entries(a).sort((e,t)=>{let[,s]=e,[,a]=t;return a-s})[0])||void 0===e?void 0:e[0])||"N/A",totalEvents:s,timeByEventType:r,timeByAdvisor:l}},[w]),{resolvedTheme:D}=(0,v.D)(),E=Object.keys(A.timeByEventType),S=Object.values(A.timeByEventType),I=E.map((e,t)=>tF(t)),O=Object.keys(A.timeByAdvisor).map(e=>b[e]||e),M=Object.values(A.timeByAdvisor),F=O.map((e,t)=>tF(t)),U=(()=>{let e={};w.forEach(t=>{let s=(0,ex.GP)((0,ep.H)(t.date),"yyyy-MM-dd");e[s]=(e[s]||0)+t.loggedTime});let t=Object.entries(e).sort((e,t)=>e[0].localeCompare(t[0]));return{labels:t.map(e=>{let[t]=e;return t}),data:t.map(e=>{let[t,s]=e;return s})}})(),B="dark"===D?"hsl(210 20% 95%)":"hsl(222.2 84% 4.9%)",Y={responsive:!0,plugins:{legend:{display:!1},datalabels:{color:B,anchor:"end",align:"end",font:{weight:"bold",size:12},formatter:e=>e>0?tR(e):null,offset:4,padding:0}},scales:{x:{ticks:{color:B},grid:{color:"dark"===D?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}},y:{ticks:{color:B},grid:{color:"dark"===D?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}}}},z={responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0}},scales:{x:{ticks:{color:B},grid:{color:"dark"===D?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}},y:{ticks:{color:B},grid:{color:"dark"===D?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}}}},V=async()=>{j(!0);try{let e=document.getElementById("report-charts-section");if(!e)throw Error("Could not find chart section");let t=(await ty()(e,{backgroundColor:null,scale:2})).toDataURL("image/png"),s=document.createElement("a");s.href=t,s.download="advisor_report_charts.png",document.body.appendChild(s),s.click(),document.body.removeChild(s)}catch(e){(0,_.oR)({title:"Export failed",description:"Could not generate PNG. Please try again.",variant:"destructive"})}finally{j(!1)}};return(0,a.jsxs)(P.Zp,{className:"w-full shadow-lg",children:[(0,a.jsxs)(P.aR,{className:"pb-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4",children:[(0,a.jsx)(P.ZB,{className:"text-xl font-semibold text-primary mb-2 sm:mb-0",children:"Report Data"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 self-end sm:self-center",children:[(0,a.jsxs)(g.$,{variant:"ghost",size:"sm",onClick:()=>{i("week"),c(void 0),u("all"),x("all")},disabled:!C||p,"aria-label":"Clear Filters",className:(0,d.cn)(!C&&"text-muted-foreground"),children:[(0,a.jsx)(tN.A,{className:"mr-2 h-4 w-4"})," Clear"]}),(0,a.jsxs)(e$.l6,{onValueChange:e=>k(e),children:[(0,a.jsx)(e$.bq,{children:(0,a.jsx)(e$.yv,{placeholder:"Export Format"})}),(0,a.jsxs)(e$.gC,{children:[(0,a.jsx)(e$.eb,{value:"csv",children:"CSV"}),(0,a.jsx)(e$.eb,{value:"json",children:"JSON"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Date Range"}),(0,a.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:tL.map(e=>(0,a.jsx)(g.$,{variant:n===e.value?"secondary":"outline",size:"sm",onClick:()=>i(e.value),className:(0,d.cn)("h-8","custom"===n&&"custom"===e.value&&"ring-2 ring-primary"),children:e.label},e.value))}),"custom"===n&&(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(eZ,{date:o,onDateChange:c})})]}),(0,a.jsx)("div",{className:"flex flex-col md:flex-row md:items-end gap-3",children:(0,a.jsxs)("div",{className:"flex-grow flex flex-col sm:flex-row gap-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-[160px]",children:[(0,a.jsx)("label",{htmlFor:"report-event-type-filter",className:"text-sm font-medium block mb-1.5",children:"Event Type"}),(0,a.jsxs)(e$.l6,{onValueChange:x,value:h,children:[(0,a.jsx)(e$.bq,{id:"report-event-type-filter",className:"w-full",children:(0,a.jsx)(e$.yv,{placeholder:"Filter by Event Type"})}),(0,a.jsxs)(e$.gC,{children:[(0,a.jsx)(e$.eb,{value:"all",children:"All Event Types"}),N.map(e=>(0,a.jsx)(e$.eb,{value:e,children:e},e))]})]})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-[160px]",children:[(0,a.jsx)("label",{htmlFor:"report-advisor-filter",className:"text-sm font-medium block mb-1.5",children:"Advisor"}),(0,a.jsxs)(e$.l6,{onValueChange:u,value:m,children:[(0,a.jsx)(e$.bq,{id:"report-advisor-filter",className:"w-full",children:(0,a.jsx)(e$.yv,{placeholder:"Filter by Advisor"})}),(0,a.jsxs)(e$.gC,{children:[(0,a.jsx)(e$.eb,{value:"all",children:"All Advisors"}),s.map(e=>(0,a.jsx)(e$.eb,{value:e.id,children:e.name},e.id)),"\\"]})]})]})]})})]}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground pt-3 mt-4 border-t border-dashed",children:[T," - ",w.length," entries found."]})]}),(0,a.jsxs)(P.Wu,{className:"pt-4",children:[(0,a.jsx)("div",{className:"flex items-center gap-4 mb-6",children:(0,a.jsxs)(g.$,{onClick:V,disabled:y,variant:"outline",children:[y?(0,a.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(tw.A,{className:"mr-2 h-4 w-4"})," Export Charts as PNG"]})}),(0,a.jsxs)("div",{id:"report-charts-section",className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Visualizations"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-card rounded-lg p-4 shadow-sm border",children:[(0,a.jsx)("h3",{className:"font-medium mb-2",children:"Time by Event Type (Bar)"}),(0,a.jsx)(tC.yP,{data:{labels:E,datasets:[{label:"Minutes",data:S,backgroundColor:I}]},options:Y,plugins:[tA.A]})]}),(0,a.jsxs)("div",{className:"bg-card rounded-lg p-4 shadow-sm border",children:[(0,a.jsx)("h3",{className:"font-medium mb-2",children:"Time by Advisor (Bar)"}),(0,a.jsx)(tC.yP,{data:{labels:O,datasets:[{label:"Minutes",data:M,backgroundColor:F}]},options:Y,plugins:[tA.A]})]}),(0,a.jsxs)("div",{className:"bg-card rounded-lg p-4 shadow-sm border",children:[(0,a.jsx)("h3",{className:"font-medium mb-2",children:"Event Type Share (Pie)"}),(0,a.jsx)(tC.nu,{data:{labels:E,datasets:[{data:S,backgroundColor:I}]},options:{responsive:!0,plugins:{legend:{position:"top",labels:{color:B}},tooltip:{enabled:!0}}}})]}),(0,a.jsxs)("div",{className:"bg-card rounded-lg p-4 shadow-sm border",children:[(0,a.jsx)("h3",{className:"font-medium mb-2",children:"Time Trend (Line)"}),(0,a.jsx)(tC.N1,{data:{labels:U.labels,datasets:[{label:"Minutes",data:U.data,borderColor:"#3b82f6",backgroundColor:"rgba(59,130,246,0.2)",fill:!0}]},options:z})]})]})]}),(0,a.jsx)("div",{id:"report-summary-section",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)(P.Zp,{className:"bg-card border shadow-sm",children:[(0,a.jsxs)(P.aR,{className:"flex flex-row items-center gap-2 pb-2",children:[(0,a.jsx)("span",{className:"text-primary",children:(0,a.jsxs)("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,a.jsx)("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,a.jsx)(P.ZB,{className:"text-sm font-medium",children:"Total Time Logged"})]}),(0,a.jsx)(P.Wu,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:tR(A.totalTimeLogged)})})]}),(0,a.jsxs)(P.Zp,{className:"bg-card border shadow-sm",children:[(0,a.jsxs)(P.aR,{className:"flex flex-row items-center gap-2 pb-2",children:[(0,a.jsx)("span",{className:"text-primary",children:(0,a.jsxs)("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"4",stroke:"currentColor",strokeWidth:"2"}),(0,a.jsx)("path",{d:"M8 12h8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,a.jsx)(P.ZB,{className:"text-sm font-medium",children:"Average Time Per Event"})]}),(0,a.jsx)(P.Wu,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:tR(A.averageTimePerEvent)})})]}),(0,a.jsxs)(P.Zp,{className:"bg-card border shadow-sm",children:[(0,a.jsxs)(P.aR,{className:"flex flex-row items-center gap-2 pb-2",children:[(0,a.jsx)("span",{className:"text-primary",children:(0,a.jsxs)("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,a.jsx)("path",{d:"M9 12l2 2 4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,a.jsx)(P.ZB,{className:"text-sm font-medium",children:"Most Common Event Type"})]}),(0,a.jsx)(P.Wu,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:A.mostCommonEventType})})]}),(0,a.jsxs)(P.Zp,{className:"bg-card border shadow-sm",children:[(0,a.jsxs)(P.aR,{className:"flex flex-row items-center gap-2 pb-2",children:[(0,a.jsx)("span",{className:"text-primary",children:(0,a.jsxs)("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"4",stroke:"currentColor",strokeWidth:"2"}),(0,a.jsx)("path",{d:"M12 8v8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,a.jsx)(P.ZB,{className:"text-sm font-medium",children:"Total Events"})]}),(0,a.jsx)(P.Wu,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:A.totalEvents})})]})]})}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-md font-semibold mb-2",children:"Event Type Breakdown"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:Object.entries(A.timeByEventType).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"px-3 py-1 rounded-full text-xs font-semibold",style:{background:"#f3f4f6",border:"1px solid #e5e7eb"},children:[t,": ",tR(s)]},t)})})]}),(0,a.jsx)(R,{className:"h-[400px] md:h-[500px] border rounded-md",children:(0,a.jsxs)(ey,{children:[(0,a.jsx)(ej,{className:"sticky top-0 bg-background z-10",children:(0,a.jsxs)(eN,{children:[(0,a.jsx)(ew,{className:"w-[100px]",children:"Date"}),(0,a.jsx)(ew,{children:"Advisor"}),(0,a.jsx)(ew,{children:"Event Type"}),(0,a.jsx)(ew,{className:"text-right w-[120px]",children:"Time (mins)"}),(0,a.jsx)(ew,{children:"Notes"})]})}),(0,a.jsx)(eb,{children:w.length>0?w.map(e=>(0,a.jsxs)(eN,{children:[(0,a.jsx)(eC,{className:"font-medium",children:(0,ex.GP)((0,ep.H)(e.date),"dd MMM yyyy")}),(0,a.jsx)(eC,{children:b[e.advisorId]||"Unknown Advisor"}),(0,a.jsx)(eC,{children:e.eventType||"N/A"}),(0,a.jsx)(eC,{className:"text-right",children:e.loggedTime}),(0,a.jsx)(eC,{className:"text-sm text-muted-foreground truncate max-w-[200px] md:max-w-[300px]",children:e.eventDetails})]},e.id)):(0,a.jsx)(eN,{children:(0,a.jsx)(eC,{colSpan:5,className:"h-24 text-center",children:"No report data available for the selected filters."})})})]})}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground pt-2 text-right",children:["Total Logged Time: ",w.reduce((e,t)=>e+t.loggedTime,0)," minutes"]})]})]})}tT.t1.register(tT.PP,tT.kc,tT.E8,tT.hE,tT.m_,tT.s$,tT.Bs,tT.FN,tT.No,tT.dN,tA.A);var tB=s(5365),t_=s(5300),tY=s(1133),tz=s(8376),tV=s(9114),tW=s(8449),tG=s(763);function tZ(e){if(!e)return null;let t=e.split(" ")[0].split("/");if(3===t.length){let s=parseInt(t[0],10),a=parseInt(t[1],10),r=parseInt(t[2],10);if(!isNaN(s)&&!isNaN(a)&&!isNaN(r)&&a>=1&&a<=12&&s>=1&&s<=31&&r>=1900&&r<=2100)try{let t=new Date(Date.UTC(r,a-1,s));if(t.getUTCFullYear()===r&&t.getUTCMonth()===a-1&&t.getUTCDate()===s)return t;return console.warn("Invalid date components created invalid Date object:",e),null}catch(t){return console.error("Error parsing date:",e,t),null}else console.warn("Parsed date components seem invalid:",{day:s,month:a,year:r},"from",e)}return console.warn("Could not parse date string:",e),null}function t$(e){let{policyData:t,setPolicyData:s,fileName:l,setFileName:n,isLoading:i,setIsLoading:o,parseError:d,setParseError:c}=e,[m,u]=(0,r.useState)(""),[h,x]=(0,r.useState)(null),p="Policy Number",f="Policy Status",v="Due Date of 1st Arrear",y="Due Date of 2nd Arrear",j="Due Date of 3rd Arrear",b="Cancellation Reason",N="Current Gross Premium Per Frequency",w="Max. Next Premium Collection Date",C="Number Of Paid Premiums",T=(0,r.useCallback)(e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&(o(!0),c(null),s(new Map),x(null),n(a.name),tv().parse(a,{header:!0,skipEmptyLines:!0,complete:e=>{let t=new Map;if(e.errors.length>0){console.error("CSV Parsing Errors:",e.errors),c("Error parsing CSV: ".concat(e.errors[0].message," on row ").concat(e.errors[0].row)),o(!1),n(null);return}if(!e.data||0===e.data.length){c("CSV file is empty or has no data rows."),o(!1),n(null);return}let a=[p,f,v,y,j],r=Object.keys(e.data[0]||{}),l=a.filter(e=>!r.includes(e));if(l.length>0){let e="'".concat(a.join("', '"),"'"),t="'".concat(b,"', '").concat(N,"', '").concat(w,"', '").concat(C,"'");c("Missing required columns in CSV: ".concat(l.join(", "),". Expected: ").concat(e,". Optional: ").concat(t,".")),o(!1),n(null);return}let i=r.includes(b),d=r.includes(N),m=r.includes(w),u=r.includes(C);e.data.forEach(e=>{var s,a,r,l,n;let o=null===(s=e[p])||void 0===s?void 0:s.trim();if(o){let s,c,h,x,p;let g=[null===(a=e[v])||void 0===a?void 0:a.trim(),null===(r=e[y])||void 0===r?void 0:r.trim(),null===(l=e[j])||void 0===l?void 0:l.trim()].filter(e=>!!e&&""!==e.trim()),T=(null===(n=e[f])||void 0===n?void 0:n.trim())||"UNKNOWN";if(i){let t=e[b];if("string"==typeof t){let e=t.trim();e.length>0&&(s=e)}}if(d){let t=e[N];if("string"==typeof t||"number"==typeof t){let e=String(t).trim();e.length>0&&(c=e)}}if(m){let t=e[w];if("string"==typeof t){let e=t.trim();e.length>0&&(h=e.split(" ")[0])}}if(u){let t=e[C];if("string"==typeof t||"number"==typeof t){let e=String(t).trim();e.length>0&&(x=e)}}let k=T.toUpperCase();if(("ON_RISK"===k||"ON RISK"===k)&&3===g.length){let e=function(e){if(!e)return null;let t=e.split(" ")[0].split("/");if(3===t.length){let s=parseInt(t[0],10),a=parseInt(t[1],10),r=parseInt(t[2],10);if(!isNaN(s)&&!isNaN(a)&&!isNaN(r)&&a>=1&&a<=12&&s>=1&&s<=31){if(r<1900||r>2100)return console.warn("Unlikely year encountered during date parsing:",r),null;try{let t=new Date(r,a-1,s);if(t.getFullYear()!==r||t.getMonth()!==a-1||t.getDate()!==s)return console.warn("Invalid date components:",e),null;return t.setDate(t.getDate()+30),t.toLocaleDateString("en-GB")}catch(t){return console.error("Error calculating cancellation date for:",e,t),null}}else console.warn("Parsed date components seem invalid:",{day:s,month:a,year:r},"from",e)}return console.warn("Could not parse date for cancellation calculation:",e),null}(g[2]);e&&(p=e)}t.set(o,{policyNumber:o,status:T,missedPayments:g,cancellationReason:s,potentialCancellationDate:p,currentGrossPremiumPerFrequency:c,maxNextPremiumCollectionDate:h,numberOfPaidPremiums:x})}}),s(t),o(!1)},error:e=>{console.error("CSV Parsing Failed:",e),c("Failed to parse CSV: ".concat(e.message)),o(!1),n(null)}}))},[s,n,o,c]),k=(0,r.useCallback)(()=>{if(!m){x(null);return}x(t.get(m.trim())||"not_found")},[m,t]),A=e=>["LAPSED","TEMPORARILY_LAPSED","PERMANENTLY_LAPSED"].includes(e.toUpperCase());return(0,a.jsxs)(P.Zp,{children:[(0,a.jsxs)(P.aR,{children:[(0,a.jsxs)(P.ZB,{className:"flex items-center",children:[(0,a.jsx)(t_.A,{className:"mr-2 h-5 w-5"})," Policy Search"]}),(0,a.jsx)(P.BT,{children:"Upload a daily CSV policy sheet and search by policy number."})]}),(0,a.jsxs)(P.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{htmlFor:"policy-csv-upload",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Upload most recent dashboard"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(D,{id:"policy-csv-upload",type:"file",accept:".csv",onChange:T,disabled:i,className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/90 cursor-pointer"}),i&&(0,a.jsx)(L.A,{className:"h-5 w-5 animate-spin"})]}),l&&!i&&!d&&(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["✅ Loaded: ",l," (",t.size," policies)"]}),d&&(0,a.jsxs)(tB.Fc,{variant:"destructive",className:"mt-2",children:[(0,a.jsx)(tY.A,{className:"h-4 w-4"}),(0,a.jsx)(tB.XL,{children:"Upload Error"}),(0,a.jsx)(tB.TN,{children:d})]})]}),t.size>0&&!i&&!d&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{htmlFor:"policy-search-input",className:"text-sm font-medium",children:"Search Policy Number"}),(0,a.jsxs)("div",{className:"flex w-full max-w-sm items-center space-x-2",children:[(0,a.jsx)(D,{id:"policy-search-input",type:"text",placeholder:"Enter policy number...",value:m,onChange:e=>u(e.target.value),onKeyDown:e=>"Enter"===e.key&&k()}),(0,a.jsxs)(g.$,{type:"button",onClick:k,children:[(0,a.jsx)(eT.A,{className:"mr-2 h-4 w-4"})," Search"]})]})]}),h&&(0,a.jsxs)("div",{className:"pt-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Search Result"}),"not_found"===h?(0,a.jsxs)("p",{className:"text-muted-foreground",children:['Policy number "',m,'" not found in the uploaded data.']}):(0,a.jsx)(P.Zp,{className:"bg-secondary/50",children:(0,a.jsxs)(P.Wu,{className:"p-4 space-y-2",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Policy Number:"})," ",h.policyNumber]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Status:"})," ",(0,a.jsx)("span",{className:"font-semibold ".concat((e=>{let t=e.toUpperCase();return"ON_RISK"===t||"ON RISK"===t?"text-green-600":A(e)||"CANCELLED"===t?"text-red-600":"text-muted-foreground"})(h.status)),children:h.status.replace(/_/g," ").toUpperCase()})]}),function(e){if(!(e.missedPayments.length>0&&e.missedPayments.length<3))return!1;let t=e.missedPayments[e.missedPayments.length-1],s=tZ(t);if(!s)return console.warn("Could not parse lastMissedPaymentDate for 'cleared' check:",t),!1;let a=new Date(s);if(a.setUTCMonth(a.getUTCMonth()+1),!e.maxNextPremiumCollectionDate)return!1;let r=tZ(e.maxNextPremiumCollectionDate);if(!r)return console.warn("Could not parse maxNextPremiumCollectionDate for 'cleared' check:",e.maxNextPremiumCollectionDate),!1;if(r.getTime()<=a.getTime())return!1;let l=new Date;return Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate())>=a.getTime()+432e6}(h)&&(0,a.jsxs)("p",{className:"flex items-center text-green-600 font-semibold",children:[(0,a.jsx)(tz.A,{className:"mr-2 h-4 w-4"})," Next payment cleared"]}),h.currentGrossPremiumPerFrequency&&(0,a.jsxs)("p",{className:"flex items-center",children:[(0,a.jsx)(tV.A,{className:"mr-2 h-4 w-4 text-blue-600"}),(0,a.jsx)("strong",{children:"Monthly Premium:"}),(0,a.jsxs)("span",{className:"ml-1 font-semibold text-blue-700",children:["\xa3",h.currentGrossPremiumPerFrequency]})]}),void 0!==h.numberOfPaidPremiums&&null!==h.numberOfPaidPremiums&&""!==h.numberOfPaidPremiums.trim()&&(0,a.jsxs)("p",{className:"flex items-center",children:[(0,a.jsx)(tW.A,{className:"mr-2 h-4 w-4 text-indigo-600"}),(0,a.jsx)("strong",{children:"Payments Made:"}),(0,a.jsx)("span",{className:"ml-1",children:h.numberOfPaidPremiums})]}),!(A(h.status)||"CANCELLED"===h.status.toUpperCase())&&h.maxNextPremiumCollectionDate&&(0,a.jsxs)("p",{className:"flex items-center",children:[(0,a.jsx)(tG.A,{className:"mr-2 h-4 w-4 text-gray-600"}),(0,a.jsx)("strong",{children:"Next Premium Collection:"}),(0,a.jsx)("span",{className:"ml-1",children:h.maxNextPremiumCollectionDate})]}),(A(h.status)||"CANCELLED"===h.status.toUpperCase())&&h.cancellationReason&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Reason:"})," ",(0,a.jsx)("span",{className:"text-muted-foreground",children:h.cancellationReason})]}),h.potentialCancellationDate&&(0,a.jsxs)("p",{className:"flex items-center",children:[(0,a.jsx)(tG.A,{className:"mr-2 h-4 w-4 text-orange-600"}),(0,a.jsx)("strong",{children:"Potential Cancellation Date:"}),(0,a.jsx)("span",{className:"ml-1 text-orange-600 font-semibold",children:h.potentialCancellationDate})]}),(0,a.jsx)("p",{children:(0,a.jsxs)("strong",{children:["Missed Payments (",h.missedPayments.length,"):"]})}),h.missedPayments.length>0?(0,a.jsx)("ul",{className:"list-disc list-inside text-muted-foreground pl-4",children:h.missedPayments.map((e,t)=>(0,a.jsx)("li",{children:e},t))}):(0,a.jsx)("p",{className:"text-muted-foreground italic",children:"No missed payments recorded."})]})})]})]})]})}var tq=s(8214),tH=s(7326),tJ=s(3875),tK=s(5599),tX=s(594),tQ=s(3478);let t0=tQ.bL,t2=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(tQ.q7,{ref:t,className:(0,d.cn)("border-b",s),...r})});t2.displayName="AccordionItem";let t1=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsx)(tQ.Y9,{className:"flex",children:(0,a.jsxs)(tQ.l9,{ref:t,className:(0,d.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...l,children:[r,(0,a.jsx)(eE.A,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});t1.displayName=tQ.l9.displayName;let t4=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsx)(tQ.UC,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...l,children:(0,a.jsx)("div",{className:(0,d.cn)("pb-4 pt-0",s),children:r})})});t4.displayName=tQ.UC.displayName;let t5="Policy Number",t3="Policy Status",t6="Current Gross Premium Per Frequency",t9="Max. Next Premium Collection Date",t8="Starting Date",t7=["Distribution Partner","Product Name","Sales Channel","Broker ID","Sold Date","Exit Date","Cancellation Type","Policy Type","LOAP Consent","Premium Escalation Type","Benefit Escalation Type","Current Sum Sumassured","Current Gross Premium Annualized","Premium Frequency","Blank","Number Of Paid Premiums","Number Of Unpaid Premiums","Value Of Premiums Collected"];function se(e){if(!e)return null;let t=e.split(" ")[0].split("/");if(3===t.length){let s=parseInt(t[0],10),a=parseInt(t[1],10),r=parseInt(t[2],10);if(!isNaN(s)&&!isNaN(a)&&!isNaN(r)&&a>=1&&a<=12&&s>=1&&s<=31&&r>=1900&&r<=2100)try{let t=new Date(Date.UTC(r,a-1,s));if(t.getUTCFullYear()===r&&t.getUTCMonth()===a-1&&t.getUTCDate()===s)return t;return console.warn("Invalid date components created invalid Date object:",e),null}catch(t){return console.error("Error parsing date:",e,t),null}else console.warn("Parsed date components seem invalid:",{day:s,month:a,year:r},"from",e)}return console.warn("Could not parse date string:",e),null}function st(e){let t=e.match(/\d+$/);return t?parseInt(t[0],10):0}let ss=()=>{let{toast:e}=(0,_.dj)(),[t,s]=(0,r.useState)(null),[l,n]=(0,r.useState)(null),[i,o]=(0,r.useState)([]),[d,c]=(0,r.useState)(!1),[m,u]=(0,r.useState)([]),h=(0,r.useRef)(null),x=(0,r.useRef)(null),p=(0,r.useCallback)(async t=>{if(!navigator.clipboard){e({title:"Clipboard API Not Available",description:"Copying to clipboard is not supported or not allowed in this browser/context.",variant:"destructive"});return}try{await navigator.clipboard.writeText(t),e({title:"Copied!",description:"Policy number copied to clipboard."})}catch(s){console.error("Failed to copy text: ",s);let t="Could not copy policy number. Check browser console for details.";s instanceof DOMException&&"NotAllowedError"===s.name&&(t="Clipboard access was denied. This may be due to browser permissions or security settings in this environment."),e({title:"Copy Failed",description:t,variant:"destructive"})}},[e]),f=(0,r.useCallback)(()=>{s(null),n(null),o([]),u([]),h.current&&(h.current.value=""),x.current&&(x.current.value=""),e({title:"Inputs Cleared",description:"File inputs and results have been cleared."})},[e]),v=(0,r.useCallback)(t=>{var a;let r=null===(a=t.target.files)||void 0===a?void 0:a[0];r&&("text/csv"===r.type||r.name.endsWith(".csv")?(s(r),o([])):(e({title:"Invalid File Type",description:"Please upload a CSV file for the daily dashboard.",variant:"destructive"}),t.target.value=""))},[e]),y=(0,r.useCallback)(t=>{var s;let a=null===(s=t.target.files)||void 0===s?void 0:s[0];a&&("text/csv"===a.type||a.name.endsWith(".csv")||"text/plain"===a.type||a.name.endsWith(".txt")?(n(a),o([])):(e({title:"Invalid File Type",description:"Please upload a CSV or TXT file for the cleared batch.",variant:"destructive"}),t.target.value=""))},[e]),j=(0,r.useCallback)(async()=>{if(!t||!l){e({title:"Files Missing",description:"Please upload both the daily dashboard and cleared batch files.",variant:"destructive"});return}c(!0),o([]),u([]);try{let s=await t.text(),a=await l.text(),r=new Set;if(l.name.endsWith(".csv")?tv().parse(a,{header:!0,skipEmptyLines:!0,complete:e=>{var t;let s=null===(t=e.meta.fields)||void 0===t?void 0:t[0];e.data.forEach(e=>{let t=e[t5]||(s?e[s]:null);t&&String(t).trim()&&r.add(String(t).trim())})}}):r=new Set(a.split(/\r?\n/).map(e=>e.trim()).filter(e=>e&&e.length>0)),0===r.size){e({title:"No Policies in Batch",description:"The cleared batch file is empty or contains no policy numbers.",variant:"destructive"}),c(!1);return}tv().parse(s,{header:!0,skipEmptyLines:!0,complete:t=>{let s=t.meta.fields||[];u(s);let a=[];t.data.forEach(e=>{var t,l,n,i,o,d,c,m,u,h,x;let p=null===(t=e[t5])||void 0===t?void 0:t.trim();if(p&&r.has(p)){let t={policyNumber:p,status:(null===(l=e[t3])||void 0===l?void 0:l.trim())||"UNKNOWN",missedPayments:[null===(n=e["Due Date of 1st Arrear"])||void 0===n?void 0:n.trim(),null===(i=e["Due Date of 2nd Arrear"])||void 0===i?void 0:i.trim(),null===(o=e["Due Date of 3rd Arrear"])||void 0===o?void 0:o.trim()].filter(e=>!!e&&""!==e.trim()),cancellationReason:null===(d=e["Cancellation Reason"])||void 0===d?void 0:d.trim(),currentGrossPremiumPerFrequency:null===(c=e[t6])||void 0===c?void 0:c.trim(),maxNextPremiumCollectionDate:null===(u=e[t9])||void 0===u?void 0:null===(m=u.trim())||void 0===m?void 0:m.split(" ")[0],startingDate:null===(x=e[t8])||void 0===x?void 0:null===(h=x.trim())||void 0===h?void 0:h.split(" ")[0]};s.forEach(s=>{t.hasOwnProperty(s)||void 0===e[s]||(t[s]=String(e[s]))}),function(e){if(["LAPSED","TEMPORARILY_LAPSED","PERMANENTLY_LAPSED"].includes(e.status.toUpperCase())||!(e.missedPayments.length>0&&e.missedPayments.length<3))return!1;let t=e.missedPayments[e.missedPayments.length-1],s=se(t);if(!s)return console.warn("Could not parse lastMissedPaymentDate for 'cleared' check:",t),!1;let a=new Date(s);if(a.setUTCMonth(a.getUTCMonth()+1),!e.maxNextPremiumCollectionDate)return!1;let r=se(e.maxNextPremiumCollectionDate);if(!r)return console.warn("Could not parse maxNextPremiumCollectionDate for 'cleared' check:",e.maxNextPremiumCollectionDate),!1;if(r.getTime()<=a.getTime())return!1;let l=new Date;return Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate())>=a.getTime()+432e6}(t)&&a.push(t)}}),a.sort((e,t)=>{let s=st(e.policyNumber),a=st(t.policyNumber);return s-a}),o(a),a.length>0?e({title:"Processing Complete",description:"".concat(a.length," matching and cleared policies found.")}):e({title:"No Matches Found",description:"No policies from the dashboard matched the cleared batch OR met the 'next payment cleared' criteria.",variant:"default"})},transformHeader:e=>e.trim(),onError:t=>{console.error("Error parsing dashboard CSV:",t),e({title:"Parsing Error",description:"Failed to parse dashboard CSV: ".concat(t.message),variant:"destructive"})}})}catch(t){console.error("Error processing files:",t),e({title:"Processing Error",description:"An unexpected error occurred while processing the files.",variant:"destructive"})}finally{c(!1)}},[t,l,e]),b=(e,t)=>{let s="Next Cleared Batch Report\n";return s+="=====================================\n\n",e.forEach((e,a)=>{s+="Policy #".concat(a+1,"\n"),s+="-------------------------------------\n",t.filter(e=>!t7.includes(e)).forEach(t=>{if("missedPayments"===t)s+="Missed Payments: ".concat(e.missedPayments.length>0?e.missedPayments.join(", "):"None","\n");else{var a;let r=null!==(a=e[t])&&void 0!==a?a:"N/A";s+="".concat(t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()),": ").concat(r,"\n")}}),s+="\n"}),s},N=(0,r.useCallback)(t=>{let s,a,r;if(0===i.length){e({title:"No Data",description:"There is no data to download.",variant:"destructive"});return}let l=m.length>0?m:i.length>0?Object.keys(i[0]):[],n=[t5,t3,"missedPayments",t9,t6,t8].filter(e=>!t7.includes(e));switch(t){case"txt":s=b(i,n),a="text/plain;charset=utf-8;",r="next_cleared_batch_report.txt";break;case"pdf":case"csv":s=tv().unparse({fields:l,data:i.map(e=>l.map(t=>{let s=e[t];return Array.isArray(s)?s.join("; "):null!=s?s:""}))}),a="text/csv;charset=utf-8;",r="pdf"===t?"next_cleared_batch_report_for_sheets.csv":"next_cleared_batch_data.csv";break;default:e({title:"Error",description:"Invalid download format selected.",variant:"destructive"});return}let o=new Blob([s],{type:a}),d=document.createElement("a");d.href=URL.createObjectURL(o),d.setAttribute("download",r),document.body.appendChild(d),d.click(),document.body.removeChild(d),e({title:"Download Started",description:"The results file (".concat(r,") is being downloaded.")})},[i,m,e]),w=[t3,"missedPayments",t9,t8].filter(e=>!t7.includes(e));return(0,a.jsxs)(P.Zp,{className:"w-full max-w-2xl mx-auto",children:[(0,a.jsxs)(P.aR,{children:[(0,a.jsx)(P.ZB,{children:"Next Cleared Batch Processing"}),(0,a.jsx)(P.BT,{children:"Upload the daily dashboard CSV and the cleared batch file (CSV or TXT) to find policies that have their next payment cleared. Results are sorted by policy number."})]}),(0,a.jsxs)(P.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{htmlFor:"dashboard-file-next-cleared",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Daily Dashboard File (CSV)"}),(0,a.jsx)(D,{ref:h,id:"dashboard-file-next-cleared",type:"file",accept:".csv",onChange:v,className:"mt-1"}),t&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Selected: ",t.name]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{htmlFor:"cleared-batch-file-next-cleared",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Cleared Batch File (CSV or TXT with policy numbers)"}),(0,a.jsx)(D,{ref:x,id:"cleared-batch-file-next-cleared",type:"file",accept:".csv,.txt",onChange:y,className:"mt-1"}),l&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Selected: ",l.name]})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(g.$,{onClick:j,disabled:d||!t||!l,className:"flex-grow",children:[d?(0,a.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(tq.A,{className:"mr-2 h-4 w-4"}),"Process Files"]}),(0,a.jsxs)(g.$,{onClick:f,variant:"outline",disabled:d&&!t&&!l&&0===i.length,children:[(0,a.jsx)(tH.A,{className:"mr-2 h-4 w-4"}),"Clear"]})]}),i.length>0&&(0,a.jsxs)("div",{className:"space-y-4 pt-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium",children:["Processed Results (",i.length," Matching & Cleared)"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[(0,a.jsxs)(g.$,{onClick:()=>N("csv"),className:"w-full",variant:"outline",children:[(0,a.jsx)(tw.A,{className:"mr-2 h-4 w-4"}),"Download CSV"]}),(0,a.jsxs)(g.$,{onClick:()=>N("txt"),className:"w-full",variant:"outline",children:[(0,a.jsx)(t_.A,{className:"mr-2 h-4 w-4"}),"Download TXT"]}),(0,a.jsxs)(g.$,{onClick:()=>N("pdf"),className:"w-full",variant:"outline",children:[(0,a.jsx)(tJ.A,{className:"mr-2 h-4 w-4"}),"CSV for Sheets"]})]}),(0,a.jsx)(t0,{type:"single",collapsible:!0,className:"w-full",children:i.map(e=>(0,a.jsxs)(t2,{value:e.policyNumber,className:"border-b rounded-md mb-2",children:[(0,a.jsx)(t1,{className:"font-semibold hover:no-underline px-3 py-3 text-sm",children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsxs)("div",{className:"flex items-center min-w-0",children:[(0,a.jsx)(tz.A,{className:"mr-2 h-5 w-5 flex-shrink-0 text-green-600 dark:text-green-500"}),(0,a.jsx)("span",{className:"truncate",children:e.policyNumber}),e[t6]&&(0,a.jsxs)("span",{className:"ml-2 text-xs text-muted-foreground",children:["(\xa3",e[t6],")"]})]}),(0,a.jsx)(g.$,{variant:"ghost",size:"icon",className:"h-7 w-7 p-0 text-muted-foreground hover:text-foreground flex-shrink-0 ml-2",onClick:t=>{t.stopPropagation(),p(e.policyNumber)},"aria-label":"Copy policy number",children:(0,a.jsx)(tK.A,{className:"h-4 w-4"})})]})}),(0,a.jsx)(t4,{className:"pt-2 pb-3 px-3 text-sm text-foreground",children:(0,a.jsx)("div",{className:"space-y-1 pl-2 border-l-2 border-muted dark:border-muted-foreground/30 ml-2",children:w.map(t=>{if("missedPayments"===t)return(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Missed Payments:"}),e.missedPayments.length>0?e.missedPayments.join(", "):"None"]},t);let s=t.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,e=>e.toUpperCase());return void 0!==e[t]&&null!==e[t]&&""!==String(e[t]).trim()?(0,a.jsxs)("p",{children:[(0,a.jsxs)("strong",{children:[s,":"]})," ",e[t]]},t):null})})})]},e.policyNumber))})]}),(0,a.jsx)("div",{className:"pt-4",children:(0,a.jsx)(t0,{type:"single",collapsible:!0,className:"w-full",children:(0,a.jsxs)(t2,{value:"instructions",children:[(0,a.jsx)(t1,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(tX.A,{className:"mr-2 h-4 w-4"}),"How to use this feature"]})}),(0,a.jsx)(t4,{children:(0,a.jsxs)("div",{className:"space-y-2 text-sm text-muted-foreground",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Step 1:"})," Upload the Daily Dashboard as a .csv file in the first box."]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Step 2:"})," Filter your individual tracker (spreadsheet) to remove leads that are not back on risk, lapsed, TBL (To Be Lapsed), etc."]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Step 3:"})," In your filtered tracker, click on the top of the column containing policy numbers to select all policy numbers you are actively working. Copy this selection (Ctrl+C or Cmd+C)."]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Step 4:"})," Open a new spreadsheet (e.g., File > New > Spreadsheet in Google Sheets or Excel)."]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Step 5:"})," Paste (Ctrl+V or Cmd+V) all the active policy numbers into the first column of the newly created spreadsheet."]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Step 6:"}),' Export this new spreadsheet as a CSV file (e.g., File > Download > .csv). Name it something like "[Your Name] Policies to Check.csv".']}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Step 7:"})," Upload this newly created CSV file to the 'Cleared Batch File' input box on this page."]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Step 8:"}),' Press the "Process Files" button and wait a few seconds for the results.']}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Step 9:"})," You can then download the results as a TXT file (or CSV for Sheets). Save this file to your computer for easy access and work through the identified cases."]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"NOTE:"})," Always double-check the missed payments and other details to ensure you can actually work the lead and put it back on risk. The algorithm has high accuracy but may occasionally make mistakes."]})]})})]})})})]})]})},sa=[{insurer:"SOURCE HOME INSURANCE",contactInformation:"02920 105 400",autoRecollection:"",missedPaymentsToLapse:"",cancelOnBehalf:"",canReinstateDD:"",otherRetentionsInfo:"",emailPassword:"",bankDetails:""},{insurer:"Aegon (now Royal London)",contactInformation:"345 610 0037",autoRecollection:"Yes",missedPaymentsToLapse:"",cancelOnBehalf:"No",canReinstateDD:"Yes",otherRetentionsInfo:"▪ NO PORTAL\n ▪ Clearance - 7 working days\n▪ 4+ missed payments = Declaration of Health required\n▪ Customer can send bank transfer to make up payment\n▪ Can set up double/triple collection on behalf of client\n▪ 'Refer to payer' - currently attempting recollection. ",emailPassword:"UsL1PzrhI5-T",bankDetails:""},{insurer:"AIG Life",contactInformation:"345 600 6820",autoRecollection:"No",missedPaymentsToLapse:"3",cancelOnBehalf:"Yes - via portal",canReinstateDD:"Yes",otherRetentionsInfo:"▪ PORTAL\n ▪ Payment clearance - 4 working days\n▪ Portal - can reattempt 3-5 day collection on portal, can set up double collection, can change bank details & payment dates & reinstate policy if less than 3 payments missed.\n▪ AIG would have reattempted BEFORE sending notification to us",emailPassword:"",bankDetails:""},{insurer:"Aviva",contactInformation:"800 056 5499",autoRecollection:"Yes",missedPaymentsToLapse:"",cancelOnBehalf:"Yes - via portal",canReinstateDD:"Yes",otherRetentionsInfo:'▪ PORTAL\n ▪ Clearance - 5 working days\n▪ Lapses after - 60 days of 1st missed DD\n▪ Can cancel on portal/change bank details\n▪ Can reinstate DD on portal\n▪ "DD REJECTION" - currently recollecting. ',emailPassword:"",bankDetails:""},{insurer:"Canada Life",contactInformation:"3456060708",autoRecollection:"Yes",missedPaymentsToLapse:"",cancelOnBehalf:"No",canReinstateDD:"No",otherRetentionsInfo:'▪ NO PORTAL\n ▪ Clearance - 10 working days\n▪ Lapses after - 60 days of 1st missed DD\n▪ "1 missed payment" - currently recollecting.\n▪ Customer can bank transfer arrears.\n▪ Canada Life will attempt next month premium as normal even when 1 missed payment on the account - if this fails DD suspends.\n▪ We cannot set up anything on behalf of client- they have to call to do this. ',emailPassword:"",bankDetails:""},{insurer:"Cignpost Life",contactInformation:"330 123 3747",autoRecollection:"No",missedPaymentsToLapse:"4",cancelOnBehalf:"Yes - Cancellation form to IPTIQ",canReinstateDD:"No",otherRetentionsInfo:"▪ NO PORTAL\n ▪ Clearance - 4 working days\n▪ 4+ missed payments = Declaration of Health required & all arrears to be cleared.\n▪ Can miss up to 2 payments\n▪ iptiq_serviceops@swissre.com for any cancellations/adhoc recollection/payment link.",emailPassword:"",bankDetails:""},{insurer:"ESMI",contactInformation:"330 123 10 30",autoRecollection:"Yes",missedPaymentsToLapse:"3",cancelOnBehalf:"Yes - Email Isobel",canReinstateDD:"Yes",otherRetentionsInfo:'▪ NO PORTAL\n ▪ Clearance - 5 working days\n▪ smith@getesmi.co.uk to check on payments/cancel policy/reinstate DD.\n▪ Customer can send bank transfer to ESMI to make up arrears.\n▪  "0213  -  REFER TO PAYER" Automatic double collection when DD is active\n▪ 3 missed payments - policy lapse',emailPassword:"",bankDetails:""},{insurer:"Guardian",contactInformation:"808 133 1821",autoRecollection:"Yes",missedPaymentsToLapse:"3",cancelOnBehalf:"No",canReinstateDD:"Yes",otherRetentionsInfo:"▪ NO PORTAL\n ▪ Clearance - 5 working days\n▪  Automatic double collection when DD is active & reattempt 7 days after missed premium.\n▪  We can reinstate DD for customer - can't do manual payments.\n▪ 3 missed payments - policy lapse",emailPassword:"",bankDetails:""},{insurer:"HSBC",contactInformation:"333 207 5563",autoRecollection:"Yes",missedPaymentsToLapse:"",cancelOnBehalf:"Yes",canReinstateDD:"Yes",otherRetentionsInfo:"▪ NO PORTAL\n ▪ Check with HSBC before calling customer for the status of the policy\n▪ Clearance - 7-10 working days\n▪ Lapse 90 days after missed payment.\n▪ Can reinstate DD and set up double collection or recollection. Can also cancel policy on behalf of customer.\n▪ Sometimes recollecting when 'Policy in arrears' - call HSBC to check. They keep recollecting until DD suspends.\n▪Customer can bank transfer arrears\n▪ HSBC sometimes recollect premium which causes next month to skip - they will then take a premium as normal the month after if the DD is still active.  - ▪ Can cancel on behalf ",emailPassword:"x=f=Alpha40",bankDetails:""},{insurer:"Legal & General",contactInformation:"370 010 4080",autoRecollection:"Yes",missedPaymentsToLapse:"3+",cancelOnBehalf:"No",canReinstateDD:"Yes",otherRetentionsInfo:"▪ PORTAL\n ▪ Clearance - 11 working days\n▪ 3+ missed payments = Lapse\n▪ Can reinstate DD and set up double on portal if you get clients bank details.\n▪ Alternatively, customer can call to make up payment manually/set up a recollection.\n▪'Reinstatement not required' - L&G recollecting, no need to call. Wait for payment clearance. If it fails the DD auto-cancels.\n▪ Can't cancel on behalf of client.",emailPassword:"Candidinsuranceservices1!",bankDetails:""},{insurer:"LV=",contactInformation:"800 678 1906",autoRecollection:"Yes",missedPaymentsToLapse:"3+",cancelOnBehalf:"No",canReinstateDD:"Yes",otherRetentionsInfo:'▪ NO PORTAL\n ▪ Payment clearance - 5 working days\n▪ 3+ missed payments = Declaration of Health required\n▪ Can set up double/triple collection on behalf of client\n▪ Can set up 3-5 working day collection on behalf of client\n ▪ "DD Reject/ Refer to payer" - currently reattempting',emailPassword:"wNP!TpRv",bankDetails:""},{insurer:"Polly/Tom/Winston",contactInformation:"800 048 8866",autoRecollection:"No",missedPaymentsToLapse:"Claims number: 800 031 8672 (option 2)",cancelOnBehalf:"Yes - Cancellation form to IPTIQ",canReinstateDD:"Yes",otherRetentionsInfo:"▪ NO PORTAL\n▪ Clearance - 8 working days\n▪ Cancellation 30 days after 3rd miss payment\n▪ Can miss 2 payments and retain cover. \n▪ iptiq_serviceops@swissre.com - email for any payment queries/cancellations/NT forms/dd reinstatements etc. ",emailPassword:"",bankDetails:""},{insurer:"Royal London",contactInformation:"345 609 4500",autoRecollection:"Yes",missedPaymentsToLapse:"3",cancelOnBehalf:"No",canReinstateDD:"No",otherRetentionsInfo:'▪ NO PORTAL\n ▪ Clearance - 5 working days\n▪ Can\'t cancel policy on behalf of client\n▪ "1 missed" -  Automatic double collection when 1 missed payment.\n▪ 3 missed payments - policy lapse\n▪ Customer has to call to make payments.',emailPassword:"Candid123",bankDetails:""},{insurer:"Scottish Widows",contactInformation:"345 030 6240",autoRecollection:"Yes",missedPaymentsToLapse:"",cancelOnBehalf:"Yes - Call Insurer Directly",canReinstateDD:"Yes",otherRetentionsInfo:'▪ NO PORTAL\n ▪ Clearance - 5 working days\n▪  "DD OPEN - 2 PAYMENTS DUE NEXT PAYMENT" Automatic double/triple collection when DD is active depending on how many payments missed.\n▪ Can set up a 14 day recollection ',emailPassword:"ON962Y",bankDetails:""},{insurer:"Shepherd's Friendly",contactInformation:"161 495 6495",autoRecollection:"No",missedPaymentsToLapse:"3",cancelOnBehalf:"No",canReinstateDD:"Yes",otherRetentionsInfo:"▪ NO PORTAL\n▪ Clearance - 5 working days\n▪  Can do payment links, manual payments and we can set up double collection\n▪ Lapses after 3 missed payments. ",emailPassword:"C&*d1dSf!",bankDetails:""},{insurer:"The Exeter",contactInformation:"300 123 3203",autoRecollection:"Yes",missedPaymentsToLapse:"3",cancelOnBehalf:"No",canReinstateDD:"No",otherRetentionsInfo:"▪ NO PORTAL\n▪ Clearance - 4 working days\n▪ 3 missed payments - lapses the policy\n▪ Can set up 7 working day recollection/double collection on behalf of client. \n▪ Can cancel on behalf of the client.\n▪ Customer can be transferred to make manual payment \n▪ Automatic 9 working day recollection is in place when 'Refer to payer' ",emailPassword:"",bankDetails:""},{insurer:"Vitality",contactInformation:"345 602 3523",autoRecollection:"Yes",missedPaymentsToLapse:"3",cancelOnBehalf:"Yes",canReinstateDD:"Yes",otherRetentionsInfo:'▪ NO PORTAL\n ▪ Clearance - 5 working days\n ▪ "1 missing"-  Auto-recollection 14 days after missed premium.\n▪  Customer needs to call to make up premium over the phone\n ▪ Lapses after 3 missed payments. ',emailPassword:"VitalityEWR2022",bankDetails:""},{insurer:"Zurich",contactInformation:"370 850 4419",autoRecollection:"Yes",missedPaymentsToLapse:"2",cancelOnBehalf:"No",canReinstateDD:"No",otherRetentionsInfo:"▪ NO PORTAL\n▪ Clearance - 5 working days\n▪  Customer needs to call to make up premium\n▪ Lapses after 2 missed payments. ",emailPassword:"",bankDetails:""},{insurer:"Square Health",contactInformation:"3451403000",autoRecollection:"",missedPaymentsToLapse:"",cancelOnBehalf:"",canReinstateDD:"",otherRetentionsInfo:"CM can only amend the clients email address (Square Health will need to do everything else)",emailPassword:"",bankDetails:""},{insurer:"Metlife",contactInformation:"2077152000",autoRecollection:"?",missedPaymentsToLapse:"?",cancelOnBehalf:"No",canReinstateDD:"?",otherRetentionsInfo:"?",emailPassword:"?",bankDetails:"?"}],sr=e=>{let t=e.toLowerCase();return"yes"===t?(0,a.jsx)(eH,{variant:"default",className:"bg-green-500 hover:bg-green-600",children:"Yes"}):"no"===t?(0,a.jsx)(eH,{variant:"destructive",children:"No"}):"?"===t?(0,a.jsx)(eH,{variant:"secondary",children:"?"}):e||"-"};function sl(){let[e,t]=r.useState(""),s=sa.filter(t=>t.insurer.toLowerCase().includes(e.toLowerCase()));return(0,a.jsxs)(P.Zp,{className:"w-full shadow-lg",children:[(0,a.jsxs)(P.aR,{children:[(0,a.jsx)(P.ZB,{className:"text-xl font-semibold text-primary",children:"Whole of Market Insurer Information"}),(0,a.jsx)(P.BT,{children:"Quick reference for insurer contact details, recollection options, and retention information."}),(0,a.jsx)(D,{type:"text",placeholder:"Search by insurer name...",value:e,onChange:e=>t(e.target.value),className:"mt-4"})]}),(0,a.jsx)(P.Wu,{children:(0,a.jsx)("div",{className:"h-[65vh] w-full overflow-auto border rounded-md",children:(0,a.jsxs)("table",{className:(0,d.cn)("w-full caption-bottom text-sm"),children:[(0,a.jsx)(ej,{className:"sticky top-0 bg-background z-10",children:(0,a.jsxs)(eN,{children:[(0,a.jsx)(ew,{className:"min-w-[150px] sticky left-0 bg-background z-20",children:"Insurer"}),(0,a.jsx)(ew,{className:"min-w-[130px]",children:"Contact Info"}),(0,a.jsx)(ew,{className:"min-w-[100px] text-center",children:"Auto Recollect?"}),(0,a.jsx)(ew,{className:"min-w-[150px]",children:"Lapse (Missed Pmts)"}),(0,a.jsx)(ew,{className:"min-w-[120px] text-center",children:"Cancel for Cust.?"}),(0,a.jsx)(ew,{className:"min-w-[100px] text-center",children:"Reinstate DD?"}),(0,a.jsx)(ew,{className:"min-w-[300px]",children:"Retentions Notes"}),(0,a.jsx)(ew,{className:"min-w-[150px]",children:"Login Details"}),(0,a.jsx)(ew,{className:"min-w-[150px]",children:"Bank Details (DD)"})]})}),(0,a.jsx)(eb,{children:s.map(e=>(0,a.jsxs)(eN,{children:[(0,a.jsx)(eC,{className:"font-medium sticky left-0 bg-background z-5",children:e.insurer}),(0,a.jsx)(eC,{children:e.contactInformation||"-"}),(0,a.jsx)(eC,{className:"text-center",children:sr(e.autoRecollection)}),(0,a.jsx)(eC,{children:e.missedPaymentsToLapse||"-"}),(0,a.jsx)(eC,{className:"text-center",children:sr(e.cancelOnBehalf)}),(0,a.jsx)(eC,{className:"text-center",children:sr(e.canReinstateDD)}),(0,a.jsx)(eC,{className:"whitespace-pre-line text-xs",children:e.otherRetentionsInfo||"-"}),(0,a.jsx)(eC,{children:e.emailPassword||"-"}),(0,a.jsx)(eC,{children:e.bankDetails||"-"})]},e.insurer))})]})})})]})}let sn=e4.Ik({email:e4.Yj().email({message:"Invalid email address."}),password:e4.Yj().min(6,{message:"Password must be at least 6 characters."})});function si(){let{toast:e}=(0,_.dj)(),t=(0,e2.mN)({resolver:(0,e1.u)(sn),defaultValues:{email:"",password:""}});async function s(t){try{await (0,l.x9)(n.j,t.email,t.password),e({title:"Login Successful",description:"You have been successfully logged in."})}catch(s){console.error("Login Error:",s);let t="An error occurred during login.";s instanceof e5.g?t=s.message:s instanceof Error&&(t=s.message),e({title:"Login Failed",description:t,variant:"destructive"})}}return(0,a.jsxs)(P.Zp,{className:"w-full max-w-sm mx-auto",children:[(0,a.jsx)(P.aR,{children:(0,a.jsx)(P.ZB,{className:"text-2xl font-bold text-center",children:"Login"})}),(0,a.jsx)(P.Wu,{children:(0,a.jsx)(e9,{...t,children:(0,a.jsxs)("form",{onSubmit:t.handleSubmit(s),className:"space-y-4",children:[(0,a.jsx)(e7,{control:t.control,name:"email",render:e=>{let{field:t}=e;return(0,a.jsxs)(ts,{children:[(0,a.jsx)(ta,{children:"Email"}),(0,a.jsx)(tr,{children:(0,a.jsx)(D,{type:"email",placeholder:"m@example.com",...t})}),(0,a.jsx)(tl,{})]})}}),(0,a.jsx)(e7,{control:t.control,name:"password",render:e=>{let{field:t}=e;return(0,a.jsxs)(ts,{children:[(0,a.jsx)(ta,{children:"Password"}),(0,a.jsx)(tr,{children:(0,a.jsx)(D,{type:"password",placeholder:"Password",...t})}),(0,a.jsx)(tl,{})]})}}),(0,a.jsx)(g.$,{type:"submit",className:"w-full",children:"Login"})]})})})]})}let so="advisors",sd=new RegExp(/^(?=.*[A-Z])(?=.*\d).{6,}$/),sc=e4.Ik({email:e4.Yj().email({message:"Invalid email address."}).refine(e=>e.toLowerCase().endsWith("@clark.io"),{message:"Sign up requires a @clark.io email address."}),password:e4.Yj().min(6,{message:"Password must be at least 6 characters."}).regex(sd,{message:"Password must contain at least one uppercase letter and one number."})});function sm(){let{toast:e}=(0,_.dj)(),[t,s]=r.useState(!1),o=(0,e2.mN)({resolver:(0,e1.u)(sc),defaultValues:{email:"",password:""}});async function d(t){s(!0);let a=t.email.toLowerCase();try{let r;let d=(0,i.rJ)(n.db,so),c=(0,i.P)(d,(0,i._M)("email","==",a),(0,i._M)("status","==","pending")),m=await (0,i.GG)(c);if(m.empty){e({title:"Sign Up Failed",description:"This email address is not authorized for sign-up or has already been activated. Please contact an administrator.",variant:"destructive"}),s(!1);return}let u=m.docs[0];try{r=await (0,l.eJ)(n.j,a,t.password)}catch(a){console.error("Firebase Auth Error:",a);let t="An error occurred during sign up with Firebase Authentication.";a instanceof e5.g?t="auth/email-already-in-use"===a.code?"This email is already registered in Firebase Authentication. If you believe this is an error, contact an administrator.":a.message:a instanceof Error&&(t=a.message),e({title:"Sign Up Failed",description:t,variant:"destructive"}),s(!1);return}let h=(0,i.H9)(n.db,so,u.id);await (0,i.mZ)(h,{status:"active",firebaseUid:r.user.uid}),e({title:"Sign Up Successful",description:"Your account has been created and activated. Please log in."}),o.reset()}catch(s){console.error("Sign Up Process Error:",s);let t="An unexpected error occurred during sign up.";s instanceof e5.g?t=s.message:s instanceof Error&&(t=s.message),e({title:"Sign Up Failed",description:t,variant:"destructive"})}finally{s(!1)}}return(0,a.jsxs)(P.Zp,{className:"w-full max-w-sm mx-auto",children:[(0,a.jsx)(P.aR,{children:(0,a.jsx)(P.ZB,{className:"text-2xl font-bold text-center",children:"Sign Up"})}),(0,a.jsx)(P.Wu,{children:(0,a.jsx)(e9,{...o,children:(0,a.jsxs)("form",{onSubmit:o.handleSubmit(d),className:"space-y-4",children:[(0,a.jsx)(e7,{control:o.control,name:"email",render:e=>{let{field:s}=e;return(0,a.jsxs)(ts,{children:[(0,a.jsx)(ta,{children:"Email (@clark.io only)"}),(0,a.jsx)(tr,{children:(0,a.jsx)(D,{type:"email",placeholder:"advisor@clark.io",...s,disabled:t})}),(0,a.jsx)(tl,{})]})}}),(0,a.jsx)(e7,{control:o.control,name:"password",render:e=>{let{field:s}=e;return(0,a.jsxs)(ts,{children:[(0,a.jsx)(ta,{children:"Password"}),(0,a.jsx)(tr,{children:(0,a.jsx)(D,{type:"password",placeholder:"Min. 6 chars, 1 uppercase, 1 number",...s,disabled:t})}),(0,a.jsx)(tl,{})]})}}),(0,a.jsxs)(g.$,{type:"submit",className:"w-full",disabled:t,children:[t?(0,a.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,t?"Signing Up...":"Sign Up"]})]})})})]})}var su=s(3349),sh=s(7648),sx=s(5380),sp=s(1487),sf=s(3173),sv=s(5554),sg=s(286),sy=s(6677),sj=s(4806);let sb="advisors",sN="loggedEvents",sw=["lauren.jackson@clark.io","james.smith@clark.io","daniel.hillman@clark.io","danielhillman94@hotmail.co.uk"];function sC(){let{toast:e}=(0,_.dj)(),[t,s]=(0,r.useState)(null),[o,d]=(0,r.useState)(!0),[p,f]=(0,r.useState)(!0),[v,y]=(0,r.useState)([]),[j,b]=(0,r.useState)([]),[N,w]=(0,r.useState)(!0),[C,T]=(0,r.useState)(!0),[k,D]=(0,r.useState)(null),[P,E]=(0,r.useState)("time-log"),[R,S]=(0,r.useState)(null),[I,O]=(0,r.useState)(!1),[F,U]=(0,r.useState)(null),[B,Y]=(0,r.useState)(new Map),[z,V]=(0,r.useState)(null),[W,G]=(0,r.useState)(!1),[Z,$]=(0,r.useState)(null),q=(null==k?void 0:k.hasTopAccess)||(null==t?void 0:t.email)&&sw.includes(t.email)||!1,H=j.find(e=>e.firebaseUid===(null==t?void 0:t.uid)),J=(null==H?void 0:H.id)||"";(0,r.useEffect)(()=>{let t=(0,l.hg)(n.j,async t=>{if(s(t),d(!1),t){T(!0);try{let e=(0,i.P)((0,i.rJ)(n.db,sb),(0,i._M)("firebaseUid","==",t.uid)),s=await (0,i.GG)(e),a=null;if(s.empty){if(t.email&&sw.includes(t.email)){let e=(0,sy.Ur)();Object.keys(e).forEach(t=>e[t]=!0),e.hasTopAccess=!0,D(e)}else D((0,sy.Ur)())}else{let e=s.docs[0].data().permissions||{};D({...(0,sy.Ur)(),...e})}}catch(t){console.error("Error fetching user permissions:",t),e({variant:"destructive",title:"Permissions Error",description:"Could not load user permissions. Applying default access."}),D((0,sy.Ur)())}finally{T(!1)}}else s(null),w(!1),T(!1),D(null),b([]),y([]),S(null),Y(new Map),V(null)});return()=>t()},[e]),(0,r.useEffect)(()=>{let s;if(!t||!k){b([]),y([]),w(!1);return}w(!0);let a=!1,r=!1,l=()=>{a&&r&&w(!1)},o=(0,i.P)((0,i.rJ)(n.db,sb)),d=(0,i.aQ)(o,e=>{b(e.docs.map(e=>({id:e.id,...e.data()}))),a=!0,l()},t=>{console.error("Error fetching advisors: ",t),e({variant:"destructive",title:"Error",description:"Could not fetch advisors."}),a=!0,l()});s=k.canViewAllEvents||q?(0,i.P)((0,i.rJ)(n.db,sN)):(0,i.P)((0,i.rJ)(n.db,sN),(0,i._M)("userId","==",t.uid));let c=(0,i.aQ)(s,e=>{y(e.docs.map(e=>{var t,s;let a=e.data(),r={id:e.id,...a,timestamp:null!==(s=null===(t=a.timestamp)||void 0===t?void 0:t.toDate().toISOString())&&void 0!==s?s:new Date().toISOString(),date:a.date};return r.eventType&&e0.includes(r.eventType)||(r.eventType="Other"),r})),r=!0,l()},t=>{console.error("Error fetching logged events: ",t),e({variant:"destructive",title:"Error",description:"Could not fetch time logs."}),r=!0,l()});return()=>{d(),c()}},[t,k,e]);let K=(0,r.useCallback)(s=>{var a;if(!(s.userId===(null==t?void 0:t.uid)||q)){e({variant:"destructive",title:"Permission Denied",description:"You cannot edit this log entry."});return}"string"==typeof s.eventType&&e0.includes(s.eventType)?S(s):S({...s,eventType:"Other"}),E("time-log"),null===(a=document.getElementById("time-log-form-card"))||void 0===a||a.scrollIntoView({behavior:"smooth",block:"center"})},[t,q,e]),X=(0,r.useCallback)(()=>{S(null)},[]),Q=(0,r.useCallback)(async s=>{if(!t){e({variant:"destructive",title:"Error",description:"You must be logged in."});return}let a=v.find(e=>e.id===s);if(!((null==a?void 0:a.userId)===t.uid||q)){e({variant:"destructive",title:"Permission Denied",description:"You cannot delete this log entry."});return}U(s);try{await (0,i.kd)((0,i.H9)(n.db,sN,s)),e({title:"Success",description:"Log entry deleted."})}catch(t){console.error("Error deleting log entry: ",t),e({variant:"destructive",title:"Error",description:"Failed to delete log entry."})}finally{U(null)}},[t,v,q,e]),ee=(0,r.useCallback)(async s=>{if(!t||!(null==k?void 0:k.canAccessTimeLog)){e({variant:"destructive",title:"Permission Denied",description:"You do not have permission to log time."});return}O(!0);try{let a={...s,userId:t.uid,timestamp:i.Dc.fromDate(new Date)};await (0,i.gS)((0,i.rJ)(n.db,sN),a),e({title:"Success",description:"Time logged successfully."}),S(null)}catch(t){console.error("Error adding time log: ",t),e({variant:"destructive",title:"Error",description:"Failed to log time."})}finally{O(!1)}},[t,k,e]),et=(0,r.useCallback)(async s=>{if(!t){e({variant:"destructive",title:"Error",description:"You must be logged in."});return}if(!(s.userId===t.uid||q)){e({variant:"destructive",title:"Permission Denied",description:"You cannot edit this log entry."});return}if(!s.id){e({variant:"destructive",title:"Error",description:"Cannot update event without an ID."});return}O(!0);try{let t=(0,i.H9)(n.db,sN,s.id),a={advisorId:s.advisorId,date:s.date,eventType:s.eventType,eventDetails:s.eventDetails,loggedTime:s.loggedTime,timestamp:i.Dc.fromDate(new Date)};Object.keys(a).forEach(e=>{void 0===a[e]&&delete a[e]}),"Other"!==a.eventType&&a.hasOwnProperty("eventDetails")&&(a.eventDetails=null),await (0,i.mZ)(t,a),e({title:"Success",description:"Event updated successfully."}),S(null)}catch(t){console.error("Error editing log entry: ",t),e({variant:"destructive",title:"Error",description:"Failed to update event."})}finally{O(!1)}},[t,q,e]),es=(0,r.useCallback)(async(s,a)=>{if(!t||!((null==k?void 0:k.canManageAdvisors)||(null==k?void 0:k.hasTopAccess)))throw e({variant:"destructive",title:"Permission Denied",description:"You do not have permission to add advisors."}),Error("Permission Denied");let r=s.trim(),l=a.trim().toLowerCase();if(!l.endsWith("@clark.io"))throw e({variant:"destructive",title:"Invalid Email",description:"Email must end with @clark.io."}),Error("Invalid email domain");let o=(0,i.P)((0,i.rJ)(n.db,sb),(0,i._M)("email","==",l));if(!(await (0,i.GG)(o)).empty)throw e({variant:"destructive",title:"Duplicate Email",description:"An advisor with this email already exists."}),Error("Duplicate email");let d=(0,i.P)((0,i.rJ)(n.db,sb),(0,i._M)("name","==",r));if(!(await (0,i.GG)(d)).empty)throw e({variant:"destructive",title:"Duplicate Name",description:"An advisor with this name already exists."}),Error("Duplicate name");try{await (0,sy.Gs)({name:r,email:l,addedByAdminUid:t.uid}),e({title:"Success",description:"Advisor '".concat(r,"' added with email '").concat(l,"'. They can now sign up.")})}catch(t){throw console.error("Error in addAdvisor try block:",t),e({variant:"destructive",title:"Error Adding Advisor",description:t.message||"Failed to add advisor."}),t}},[t,k,e]),ea=(0,r.useCallback)(async s=>{if(!t||!((null==k?void 0:k.canManageAdvisors)||(null==k?void 0:k.hasTopAccess)))throw e({variant:"destructive",title:"Permission Denied",description:"You do not have permission to remove advisors."}),Error("Permission Denied");let a=j.find(e=>e.id===s);if(!a)throw e({variant:"destructive",title:"Not Found",description:"Advisor not found."}),Error("Advisor not found");if("active"===a.status&&v.some(e=>e.advisorId===s))throw e({variant:"destructive",title:"Deletion Failed",description:"Cannot remove active advisor '".concat(a.name,"' as they have logged time entries. Please reassign or delete the logs first."),duration:7e3}),Error("Active advisor has logged events");"active"!==a.status||v.some(e=>e.advisorId===s)||console.warn("Admin ".concat(t.email," is removing active advisor ").concat(a.name," (").concat(a.email,") who has no logged events."));try{await (0,i.kd)((0,i.H9)(n.db,sb,s)),e({title:"Success",description:"Advisor '".concat(a.name,"' removed.")})}catch(t){throw console.error("Error removing advisor: ",t),e({variant:"destructive",title:"Error",description:"Failed to remove advisor."}),t}},[j,v,t,k,e]),er=(0,r.useCallback)(async(s,a,r)=>{if(!t||!((null==k?void 0:k.canManageAdvisors)||(null==k?void 0:k.hasTopAccess)))throw e({variant:"destructive",title:"Permission Denied",description:"You do not have permission to edit advisors."}),Error("Permission Denied");let l=a.trim(),o=null==r?void 0:r.trim().toLowerCase(),d=j.find(e=>e.id===s);if(!d)throw e({variant:"destructive",title:"Not Found",description:"Advisor not found."}),Error("Advisor not found");let c={};if(l!==d.name){let t=(0,i.P)((0,i.rJ)(n.db,sb),(0,i._M)("name","==",l),(0,i._M)("id","!=",s));if(!(await (0,i.GG)(t)).empty)throw e({variant:"destructive",title:"Duplicate Name",description:"An advisor with the name '".concat(l,"' already exists.")}),Error("Duplicate name");c.name=l}if(o&&o!==d.email){if("active"===d.status)throw e({variant:"destructive",title:"Update Denied",description:"Email cannot be changed for an active advisor."}),Error("Cannot change email for active advisor");if(!o.endsWith("@clark.io"))throw e({variant:"destructive",title:"Invalid Email",description:"Email must end with @clark.io."}),Error("Invalid email domain");let t=(0,i.P)((0,i.rJ)(n.db,sb),(0,i._M)("email","==",o),(0,i._M)("id","!=",s));if(!(await (0,i.GG)(t)).empty)throw e({variant:"destructive",title:"Duplicate Email",description:"An advisor with the email '".concat(o,"' already exists.")}),Error("Duplicate email");c.email=o}if(0===Object.keys(c).length){e({title:"No Changes",description:"No changes detected."});return}try{let t=(0,i.H9)(n.db,sb,s);await (0,i.mZ)(t,c);let a="Advisor details updated.";c.name&&c.email?a="Advisor '".concat(d.name,"' renamed to '").concat(c.name,"' and email updated to '").concat(c.email,"'."):c.name?a="Advisor '".concat(d.name,"' renamed to '").concat(c.name,"'."):c.email&&(a="Advisor '".concat(d.name,"' email updated to '").concat(c.email,"'.")),e({title:"Success",description:a})}catch(t){throw console.error("Error editing advisor: ",t),e({variant:"destructive",title:"Error",description:"Failed to update advisor."}),t}},[j,t,k,e]),el=(0,r.useCallback)(async(s,a)=>{if(!t||!((null==k?void 0:k.canManageAdvisors)||(null==k?void 0:k.hasTopAccess)))throw e({variant:"destructive",title:"Permission Denied",description:"You do not have permission to update advisor permissions."}),Error("Permission Denied");try{await (0,sy.cj)(s,a),e({title:"Permissions Updated",description:"Advisor permissions have been successfully updated."})}catch(t){throw console.error("Error updating advisor permissions from page.tsx: ",t),e({variant:"destructive",title:"Update Failed",description:t.message||"Failed to update advisor permissions."}),t}},[t,k,e]);(0,r.useCallback)(async()=>{if(!t||!q){e({variant:"destructive",title:"Permission Denied",description:"You do not have permission to clear all logs."});return}if(0===v.length){e({variant:"default",title:"Info",description:"There are no time logs to clear."});return}try{let t=(0,i.wP)(n.db);v.forEach(e=>{let s=(0,i.H9)(n.db,sN,e.id);t.delete(s)}),await t.commit(),e({title:"Success",description:"All time log entries cleared."})}catch(t){console.error("Error clearing all logs: ",t),e({variant:"destructive",title:"Error",description:"Failed to clear all time logs."})}},[v,t,q,e]);let en=async()=>{try{await (0,l.CI)(n.j),D(null),e({title:"Logged Out",description:"You have been successfully logged out."})}catch(t){console.error("Logout Error:",t),e({variant:"destructive",title:"Logout Failed",description:"An error occurred during logout."})}};return o||t&&C?(0,a.jsxs)("div",{className:"flex justify-center items-center min-h-screen",children:[(0,a.jsx)(L.A,{className:"h-8 w-8 animate-spin mr-2"}),o?"Loading Authentication...":"Loading User Permissions..."]}):t?C?(0,a.jsxs)("div",{className:"flex justify-center items-center min-h-screen",children:[(0,a.jsx)(L.A,{className:"h-8 w-8 animate-spin mr-2"}),"Loading User Permissions..."]}):(0,a.jsx)(x.ThemeProvider,{attribute:"class",defaultTheme:"system",enableSystem:!0,children:(0,a.jsx)("div",{className:"min-h-screen bg-background text-foreground",children:(0,a.jsxs)("div",{className:"container mx-auto p-4 md:p-8",children:[(0,a.jsxs)("header",{className:"flex justify-center items-center relative mb-8 pb-4 border-b",children:[(0,a.jsx)("div",{className:"text-5xl font-designer font-bold text-blue-500",children:"Tempo"}),(0,a.jsxs)("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 flex items-center space-x-2",children:[t.email&&(0,a.jsx)("span",{className:"text-sm text-muted-foreground hidden md:inline",children:t.email}),(0,a.jsx)(A,{}),(0,a.jsx)(g.$,{variant:"outline",size:"icon",onClick:en,title:"Logout",children:(0,a.jsx)(su.A,{className:"h-5 w-5"})})]})]}),N?(0,a.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,a.jsx)(L.A,{className:"h-6 w-6 animate-spin mr-3"}),"Loading App Data..."]}):(0,a.jsxs)(c,{value:P,onValueChange:E,className:"w-full",children:[(0,a.jsxs)(m,{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:flex lg:flex-wrap justify-center gap-2 mb-12 p-1 h-auto",children:[(null==k?void 0:k.canAccessTimeLog)&&(0,a.jsxs)(u,{value:"time-log",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground flex-grow sm:flex-grow-0",children:[(0,a.jsx)(sh.A,{className:"mr-2 h-4 w-4"})," Time Log"]}),((null==k?void 0:k.canAccessSummary)||q)&&(0,a.jsxs)(u,{value:"summary",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground flex-grow sm:flex-grow-0",children:[(0,a.jsx)(eU.A,{className:"mr-2 h-4 w-4"})," Summary"]}),((null==k?void 0:k.canAccessReports)||q)&&(0,a.jsxs)(u,{value:"reports",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground flex-grow sm:flex-grow-0",children:[(0,a.jsx)(sx.A,{className:"mr-2 h-4 w-4"})," Reports"]}),((null==k?void 0:k.canAccessVisualisations)||q)&&(0,a.jsxs)(u,{value:"visualizations",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground flex-grow sm:flex-grow-0",children:[(0,a.jsx)(sx.A,{className:"mr-2 h-4 w-4"})," Visualizations"]}),(null==k?void 0:k.canAccessPolicySearch)&&(0,a.jsxs)(u,{value:"policy-search",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground flex-grow sm:flex-grow-0",children:[(0,a.jsx)(sp.A,{className:"mr-2 h-4 w-4"})," Policy Search"]}),(null==k?void 0:k.canAccessNextClearedBatch)&&(0,a.jsxs)(u,{value:"next-cleared-batch",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground flex-grow sm:flex-grow-0",children:[(0,a.jsx)(tq.A,{className:"mr-2 h-4 w-4"})," Next Cleared Batch"]}),(null==k?void 0:k.canAccessWholeOfMarket)&&(0,a.jsxs)(u,{value:"whole-of-market",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground flex-grow sm:flex-grow-0",children:[(0,a.jsx)(sf.A,{className:"mr-2 h-4 w-4"})," Whole Of Market"]}),(null==k?void 0:k.canAccessAgentTools)&&(0,a.jsxs)(u,{value:"agent",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground flex-grow sm:flex-grow-0",children:[(0,a.jsx)(sv.A,{className:"mr-2 h-4 w-4"})," Agent Tools"]}),((null==k?void 0:k.canManageAdvisors)||q)&&(0,a.jsxs)(u,{value:"manage-advisors",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground flex-grow sm:flex-grow-0",children:[(0,a.jsx)(sg.A,{className:"mr-2 h-4 w-4"})," Manage Advisors"]})]}),(null==k?void 0:k.canAccessTimeLog)?(0,a.jsx)(h,{value:"time-log",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsx)(tu,{advisors:j.filter(e=>"active"===e.status),onLogEvent:ee,onUpdateEvent:(e,t)=>{et({...t,id:e})},onCancelEdit:X,eventToEdit:R,isSubmitting:I})}),(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsx)(eQ,{events:v,advisors:j,onDeleteEvent:Q,onEditEvent:K,deletingId:F,currentUser:t,currentUserIsAdmin:q})})]})}):(0,a.jsx)(h,{value:"time-log",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,a.jsx)(M.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to view Time Logs."})]})}),(null==k?void 0:k.canAccessSummary)||q?(0,a.jsx)(h,{value:"summary",children:(0,a.jsx)(eF,{loggedEvents:v,advisors:j})}):(0,a.jsx)(h,{value:"summary",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,a.jsx)(M.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to view the Summary."})]})}),(null==k?void 0:k.canAccessReports)||q?(0,a.jsx)(h,{value:"reports",children:(0,a.jsx)(tU,{loggedEvents:v,advisors:j,advisorId:J})}):(0,a.jsx)(h,{value:"reports",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,a.jsx)(M.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to view Reports."})]})}),(null==k?void 0:k.canAccessVisualisations)||q?(0,a.jsx)(h,{value:"visualizations",children:(0,a.jsx)(tS,{loggedEvents:v,advisors:j})}):(0,a.jsx)(h,{value:"visualizations",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,a.jsx)(M.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to view Visualizations."})]})}),(null==k?void 0:k.canAccessPolicySearch)?(0,a.jsx)(h,{value:"policy-search",children:(0,a.jsx)(t$,{policyData:B,setPolicyData:Y,fileName:z,setFileName:V,isLoading:W,setIsLoading:G,parseError:Z,setParseError:$})}):(0,a.jsx)(h,{value:"policy-search",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,a.jsx)(M.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to use Policy Search."})]})}),(null==k?void 0:k.canAccessNextClearedBatch)?(0,a.jsx)(h,{value:"next-cleared-batch",children:(0,a.jsx)(ss,{})}):(0,a.jsx)(h,{value:"next-cleared-batch",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,a.jsx)(M.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to use Next Cleared Batch."})]})}),(null==k?void 0:k.canAccessWholeOfMarket)?(0,a.jsx)(h,{value:"whole-of-market",children:(0,a.jsx)(sl,{})}):(0,a.jsx)(h,{value:"whole-of-market",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,a.jsx)(M.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to view Whole of Market."})]})}),(null==k?void 0:k.canAccessAgentTools)?(0,a.jsx)(h,{value:"agent",children:(0,a.jsx)(sj.default,{})}):(0,a.jsx)(h,{value:"agent",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,a.jsx)(M.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to use Agent Tools."})]})}),(null==k?void 0:k.canManageAdvisors)||q?(0,a.jsx)(h,{value:"manage-advisors",children:(0,a.jsx)(eh,{advisors:j,onAddAdvisor:es,onRemoveAdvisor:ea,onEditAdvisor:er,onUpdateAdvisorPermissions:el})}):(0,a.jsx)(h,{value:"manage-advisors",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border rounded-md",children:[(0,a.jsx)(M.A,{className:"h-12 w-12 text-yellow-500 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to Manage Advisors."})]})})]})]})})}):(0,a.jsx)(x.ThemeProvider,{attribute:"class",defaultTheme:"system",enableSystem:!0,children:(0,a.jsxs)("div",{className:"min-h-screen bg-background text-foreground flex flex-col items-center justify-center p-4",children:[(0,a.jsxs)("header",{className:"flex justify-center items-center relative mb-8 pb-4 border-b w-full max-w-4xl",children:[(0,a.jsx)("div",{className:"text-5xl font-designer font-bold text-blue-500",children:"Tempo"}),(0,a.jsx)("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2",children:(0,a.jsx)(A,{})})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-4 w-full",children:[p?(0,a.jsx)(si,{}):(0,a.jsx)(sm,{}),(0,a.jsx)(g.$,{variant:"link",onClick:()=>f(!p),children:p?"Need an account? Sign Up":"Already have an account? Login"})]})]})})}},2751:(e,t,s)=>{Promise.resolve().then(s.bind(s,1554))}},e=>{var t=t=>e(e.s=t);e.O(0,[992,156,647,316,112,496,825,806,441,684,358],()=>t(2751)),_N_E=e.O()}]);